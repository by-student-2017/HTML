　ここではPWscfを用いた基本的な計算からXANESの計算までを解説する<br />
------------------------------------------------------------------------------<br />
■ QuantumNerd (Projects: Quantum Espresso Tutorial 2019) (English)<br />
&nbsp;&nbsp;https://www.youtube.com/channel/UCgQPek4ZSo_yL7wEjIhxvfA<br />
※ 非常によく出来ています。もっと早く出会いたかった。動画作るの大変なので。<br />
※ この動画の再生数が少ないのが非常に残念。私の動画よりも英語の音声付きで上位版の部分が多いのに。<br />
------------------------------------------------------------------------------<br />
■ GUI<br />
・QuantumVITAS (<a href="https://www.quantumvitas.org/">https://www.quantumvitas.org/</a>)<br />
------------------------------------------------------------------------------<br />
■ Youtube動画（全てクリエイティブコモンにしています）
<div><iframe allow="autoplay; encrypted-media" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/videoseries?list=PL9r3BfacS1mH1z-2dihnAEkEadMXRaa6h" width="560"></iframe></div>
・PWscf: <a href="https://www.youtube.com/playlist?list=PL9r3BfacS1mH1z-2dihnAEkEadMXRaa6h">https://www.youtube.com/playlist?list=PL9r3BfacS1mH1z-2dihnAEkEadMXRaa6h</a> &nbsp;<br />
・インストール方法： <a href="https://www.youtube.com/playlist?list=PL9r3BfacS1mFif0-qGV_mTVVqcNIlB9TW">https://www.youtube.com/playlist?list=PL9r3BfacS1mFif0-qGV_mTVVqcNIlB9TW</a> &nbsp;<br />
・再生リスト: <a href="https://www.youtube.com/channel/UCcyHw8UcdB8ppBHYLUAdklw/playlists">https://www.youtube.com/channel/UCcyHw8UcdB8ppBHYLUAdklw/playlists</a><br />
・関連動画: <a href="https://www.youtube.com/channel/UCh922UHWEPD1FqGSp-Cvn7Q/playlists">https://www.youtube.com/channel/UCh922UHWEPD1FqGSp-Cvn7Q/playlists</a><br />
-------------------------------------------------------------------------------<br />
■ 私の記述を見るよりも、下記のHPを見るのがよいだろう<br />
（私の必要性はもう何年も前から無い）<br />
・ <a href="https://qiita.com/xa_member/items/727c1a62930611babaf7">https://qiita.com/xa_member/items/727c1a62930611babaf7</a><br />
&uarr; このシリーズが特にオススメ<br />
・ <a href="http://flex.phys.tohoku.ac.jp/QE/workshop_QE_2016/DFT-hands-on-nguyen.pdf">http://flex.phys.tohoku.ac.jp/QE/workshop_QE_2016/DFT-hands-on-nguyen.pdf</a>　<br />
&uarr;のスライドも良い<br />
<br />
◇ LDA+DMFTが計算できる時代になりました。モット絶縁体関係やハバードモデルにおける[t?U]に近い系の材料で計算してみてください。<br />
・ <a href="https://issp-center-dev.github.io/DCore/tutorial/qe.html">https://issp-center-dev.github.io/DCore/tutorial/qe.html</a><br />
<br />
・ <a href="http://www.cmpt.phys.tohoku.ac.jp/~koretsune/SATL_qe_tutorial/">http://www.cmpt.phys.tohoku.ac.jp/~koretsune/SATL_qe_tutorial/</a> &nbsp;(Japanese)<br />
・ <a href="http://www.misasa.okayama-u.ac.jp/~masami/pukiwiki/index.php?QE%A4%F2Mac%A1%DC%A5%A4%A5%F3%A5%C6%A5%EB%A5%B3%A5%F3%A5%D1%A5%A4%A5%E9%A4%C7">http://www.misasa.okayama-u.ac.jp/~masami/pukiwiki/index.php?QE%A4%F2Mac%A1%DC%A5%A4%A5%F3%A5%C6%A5%EB%A5%B3%A5%F3%A5%D1%A5%A4%A5%E9%A4%C7</a>&nbsp;(Japanese)<br />
・<a href="http://www.stat.phys.titech.ac.jp/SATL_qe_tutorial/index.html">http://www.stat.phys.titech.ac.jp/SATL_qe_tutorial/index.html</a> (Japanese)<br />
<br />
■<span style="font-weight: bold;"> </span>PWscf forum（困ったときは下記を参考にしてみると良いだろう）<br />
・The PW_forum: <a href="http://qe-forge.org/pipermail/pw_forum/">http://qe-forge.org/pipermail/pw_forum/</a><br />
・pf_forum: <a href="https://www.google.com/cse/home?cx=000217952118062629757:xew9tb5yarq">https://www.google.com/cse/home?cx=000217952118062629757:xew9tb5yarq</a><br />
・FAQ: <a href="http://www.quantum-espresso.org/faq/">http://www.quantum-espresso.org/faq/</a><br />
・Input Data Description: <a href="http://www.quantum-espresso.org/users-manual/input-data-description/">http://www.quantum-espresso.org/users-manual/input-data-description/</a><br />
・Pesudopotential naming: <a href="http://www.quantum-espresso.org/pseudopotentials/naming-convention/">http://www.quantum-espresso.org/pseudopotentials/naming-convention/</a>, <a href="http://www.quantum-espresso.org/pseudopotentials/unified-pseudopotential-format/">http://www.quantum-espresso.org/pseudopotentials/unified-pseudopotential-format/</a><br />
<br />
■ 利用方法<br />
&nbsp; 基本的には下記のHPやexamplesを参考にするとよい。<br />
<a href="http://institute.loni.org/dft2011/documents/NarasimhanLec2.pdf">http://institute.loni.org/dft2011/documents/NarasimhanLec2.pdf</a><br />
PWscf のHP &rarr; LEARN &rarr; Tutorials
<ul>
	<li>Hands-on Tutorial of Quantum Espresso:&nbsp;</li>
</ul>
&nbsp;&nbsp;&nbsp;&nbsp; <a href="http://www.fisica.uniud.it/~giannozz/QE-Tutorial/">http://www.fisica.uniud.it/~giannozz/QE-Tutorial/</a>

<ul>
	<li>Hands-on Tutorial on Electronic Strucutre&nbsp;Computations, ICTP Trieste</li>
</ul>
&nbsp;&nbsp;&nbsp;&nbsp; <a href="http://cdsagenda5.ictp.it/full_display.php?email=0&amp;ida=a10125">http://cdsagenda5.ictp.it/full_display.php?email=0&amp;ida=a10125</a>

<ul>
	<li>NSF/Democritos Summer School on Materials Modeling form First-Principles:</li>
</ul>
&nbsp;&nbsp;&nbsp;&nbsp; <a href="http://www.quantum-espresso.org/wiki/index.php/QESB09">http://www.quantum-espresso.org/wiki/index.php/QESB09</a><br />
&nbsp; PWgui でHelpを押すと説明が出力されるので、それの利用も勧めたい。<br />
その他
<ul>
	<li>参考PDF：<a href="http://www.physics.metu.edu.tr/~hande/pwscf-talk.pdf">http://www.physics.metu.edu.tr/~hande/pwscf-talk.pdf</a>　</li>
	<li>Troubleshooting: <a href="http://www.quantum-espresso.org/user_guide/node51.html">http://www.quantum-espresso.org/user_guide/node51.html</a>, <a href="http://nanodft09.iyte.edu.tr/pdf/HT-L3.pdf">http://nanodft09.iyte.edu.tr/pdf/HT-L3.pdf</a>　</li>
	<li>Compiling: <a href="http://www.democritos.it/pipermail/pw_forum/2011-February/019440.html">http://www.democritos.it/pipermail/pw_forum/2011-February/019440.html</a>&nbsp;</li>
</ul>
※ 下記にPWguiを用いた場合での利用方法を説明する。（PWguiは基本的にコマンドで入力していた時代の利用者が使いやすいように作られている｛印象を受ける｝。PWguiの利用は慣れれば入力ファイル作成やコマンド入力の時間を省くことができ有用性は高い。しかし、PWguiのヴァージョンが異なるとファイルの読み取りができなかったり、計算が可能な種類が減少？されていたりと良い意味で枯れていないのが残念。慣れてきたら入力ファイルをテキストで作成し、コマンドで計算させるようにするのがよい）<br />
<br />
□ ファイル（データ）の格納場所について<br />
&nbsp; Prefix for I/O&nbsp;filenames(prefix): 'case'<br />
&nbsp;&nbsp;Temporary directory (outdir): './tmp'<br />
&nbsp; 上記のように指定すると、PWguiを起動させたディレクトリ（カレントディレクトリ）に tmpファイルが作成され、その中に出力されたファイルがcase.saveとともに格納される。つまり、 PWscfを起動させたディレクトリ/tmp/case.saveとなる。前回のデータを利用する場合は、上記と同じように設定すればデータが受け継がれる。何も入力しないとPWguiを起動させたディレクトリ上にpwscf.saveが作成される。<br />
<br />
□ 文字と数値の入力について<br />
&nbsp; 文字や数値の設定は、文字での入力は' 'で文字を挟み、数値は' 'で挟まない。<br />
<br />
□ 擬ポテンシャルや交換相関項の設定について<br />
&nbsp; pbeと付いたものを選択すれば良いです。ファンデスワールス力が関係する場合はvdWを設定して下さい（収束には時間が掛かります。もし計算時間が掛かりすぎる場合はpzを指定して下さい）。pzはLDAの分類に入ります。
<ul>
	<li>PWscf: <a href="http://www.quantum-espresso.org/pseudopotentials/">http://www.quantum-espresso.org/pseudopotentials/</a></li>
	<li>PSLibrary 0.3.1: <a href="http://theossrv1.epfl.ch/Main/Pseudopotentials">http://theossrv1.epfl.ch/Main/Pseudopotentials</a>, <a href="http://www.qe-forge.org/gf/project/pslibrary/frs/?action=FrsReleaseBrowse&amp;frs_package_id=41">http://www.qe-forge.org/gf/project/pslibrary/frs/?action=FrsReleaseBrowse&amp;frs_package_id=41</a> (PSLibrary 1.0.0)</li>
	<li>GBRV: <a href="http://www.physics.rutgers.edu/gbrv/">http://www.physics.rutgers.edu/gbrv/</a></li>
</ul>
&nbsp; Frequently Asked Questions (FAQ) : <a href="http://www.quantum-espresso.org/user_guide/node57.html">http://www.quantum-espresso.org/user_guide/node57.html</a><br />
上記のHPによるとNCPP, USPP, PAW は混ぜて使っても問題ないようです。しかし、NCPPはカットオフが多く必要になります。可能であれば、「NCPPのみ」か「USPPとPAW」の組み合わせで構成しましょう。<br />
※ スーパーセルを用いたXANESの計算をする場合は（<a href="http://www.quantum-espresso.org/pseudopotentials/">http://www.quantum-espresso.org/pseudopotentials/</a>）にて、HALF or ONE CORE-HOLE &gt; Apply Filter でのものを用います。Fe, Co, Ni, Cu, C, N, O, Si, Be 以外がありませんので、代表的なMgOでのMgに対する吸収構造を計算する場合には自作する必要があります。<br />
※ <a href="http://www.impmc.upmc.fr/~cabaret/Xspectra/Intro/intro.htm">http://www.impmc.upmc.fr/~cabaret/Xspectra/Intro/intro.htm</a> のHPの擬ポテンシャルを用いるのも良いでしょう。<br />
<br />
□ ブロードニング<br />
・ Methfessel-Paxton method: <a href="http://www.hector.ac.uk/cse/distributedcse/reports/conquest/conquest/node6.html">http://www.hector.ac.uk/cse/distributedcse/reports/conquest/conquest/node6.html</a>　<br />
　フェルミディラック分布よりも精度良く幅を広くできるのでより安定である。0-th order は フェルミディラック分布と同じ。<br />
<br />
□ PWguiのリンクの張り方<br />
.bashrc にて下記を書き込む。<br />
export PWGUI=$HOME/espresso-4.3.2 &larr;PWguiの実行ファイルのあるディレクトリを書き込む。<br />
PATH=&quot;$PATH:$PWGUI&quot;　&larr; PATH へのパスの追加。<br />
以上を行うとTerminal で pwgui と入力するだけで起動する。<br />
<br />
□ PWscf のリンクの張り方（調査中）<br />
.bashrc にて下記を書き込む。<br />
export espresso=$HOME/espresso-4.3.2<br />
export PWSCF=$HOME/espresso-4.3.2/bin &larr;PWscfの実行ファイルのあるディレクトリを書き込む。<br />
PATH=&quot;$PATH:$PWSCF&quot;　&larr; PATH へのパスの追加。<br />
以上を行うとTerminal で コマンドを入力するだけで動作する。<br />
<br />
□ Phonon 分散の計算について<br />
下記の結果を見ると商用のVASPとよい勝負が出来ている。計算速度も速い。<br />
<a href="http://unam.bilkent.edu.tr/mt2/SIESTA-PHON/PHON/analysis.pdf">http://unam.bilkent.edu.tr/mt2/SIESTA-PHON/PHON/analysis.pdf</a><br />
下記の論文を読むと良く分かる。Linear response を用いるとスーパーセルを用いなくても単位胞の計算で比較的精度の良い結果が得られる。PWscfはもっと誇っても良いと私は思う。<br />
<a href="http://www.mcc.uiuc.edu/summerschool/2007/qmc/tutorials/Tutorial_phonons_alfe.pdf">http://www.mcc.uiuc.edu/summerschool/2007/qmc/tutorials/Tutorial_phonons_alfe.pdf</a><br />
<br />
<br />
■ 擬ポテンシャル ( under constraction)<br />
-----<br />
◆ ノルム保存型擬ポテンシャル（主にフォノンの計算で2014年現在でも用いられている）<br />
（2014年の現在でもフォノンを扱った計算では論文にその記述を見つけることができる）
<ul>
	<li>PWscf: <a href="http://www.quantum-espresso.org/pseudopotentials/">http://www.quantum-espresso.org/pseudopotentials/</a></li>
</ul>
-----<br />
◆ ウルトラソフト擬ポテンシャル<br />
　必要なカットオフがノルム保存型擬ポテンシャルよりも小さく済むと言われている。カットオフはノルム保存型擬ポテンシャルの1/8から1/4程度で良いと聞く。
<ul>
	<li>GBRV: <a href="http://www.physics.rutgers.edu/gbrv/">http://www.physics.rutgers.edu/gbrv/</a></li>
</ul>

<div style="margin-left: 20px;">・PBE<br />
mkdir all_pbe_uspp<br />
cd all_pbe_uspp<br />
tar zxvf all_pbe_uspp.tar.gz<br />
---<br />
・LDA<br />
mkdir all_lda_uspp<br />
cd all_lda_uspp<br />
tar zxvf all_lda_uspp.tar.gz</div>

<ul>
	<li>Legacy Library: <a href="http://www.physics.rutgers.edu/~dhv/uspp/">http://www.physics.rutgers.edu/~dhv/uspp/</a></li>
</ul>

<div style="margin-left: 20px;">gunzip uspp-736-0.tgz<br />
tar xf uspp-736-0.tar<br />
rm uspp-736-0.tar<br />
USpp2Abinitを用いて非常に有名なヴァンデルビート（Vanderbilt）のUSPPをAbinitのPAWフォーマットに変換する。しかし、下記で示すように既にPAWが整備されているので、下記のPAWを用いることをオススメする。</div>
-----<br />
◆ PAW擬ポテンシャル<br />
　必要なカットオフ（ecut）がノルム保存型擬ポテンシャルよりも小さく済むと言われている。形式的にはウルトラソフト擬ポテンシャルに近い。
<ul>
	<li>PSLibrary 0.3.1: <a href="http://theossrv1.epfl.ch/Main/Pseudopotentials">http://theossrv1.epfl.ch/Main/Pseudopotentials</a></li>
</ul>

<div style="margin-left: 20px;">・GGA (pbe, pw91)<br />
&nbsp;&nbsp;&nbsp; mkdir pbe.0.3.1<br />
&nbsp;&nbsp;&nbsp; cd pbe.0.3.0<br />
&nbsp;&nbsp;&nbsp; tar zxvf pbe.0.3.1.tgz<br />
・LDA (pz)<br />
&nbsp;&nbsp;&nbsp; mkdir pz.0.3.1<br />
&nbsp;&nbsp;&nbsp; cd pz.0.3.0<br />
&nbsp;&nbsp;&nbsp; tar zxvf pz.0.3.1.tgz<br />
rel = relativistic</div>

<ul>
	<li>PSLibrary 1.0.0 : <a href="http://www.qe-forge.org/gf/project/pslibrary/">http://www.qe-forge.org/gf/project/pslibrary/</a>　 -&gt; <a href="http://people.sissa.it/~dalcorso/pslibrary_help.html">http://people.sissa.it/~dalcorso/pslibrary_help.html</a>　 -&gt; <a href="http://www.qe-forge.org/gf/project/pslibrary/frs/?action=FrsReleaseBrowse&amp;frs_package_id=41">http://www.qe-forge.org/gf/project/pslibrary/frs/?action=FrsReleaseBrowse&amp;frs_package_id=41</a>　</li>
	<li>PWscf: <a href="http://www.quantum-espresso.org/pseudopotentials/">http://www.quantum-espresso.org/pseudopotentials/</a></li>
</ul>
-----<br />
※ 上手くいかないときは、SCF計算とDOS計算の入力ファイルで格子定数が同じかどうかを確認する。当然ながらSCFとDOSで格子定数が異なると正しい値は出力されない。<br />
<br />
-------------------------------------------------------------------------------<br />
■ PWguiのセットアップ：<br />
PWgui :&nbsp;<a href="http://www-k3.ijs.si/kokalj/pwgui/pwgui.html">http://www-k3.ijs.si/kokalj/pwgui/pwgui.html</a>&nbsp;<br />
Download&nbsp;&rarr; Self-containted&nbsp;standalone executables :&nbsp;から取得し、<br />
tar&nbsp;xvf pwgui-4.2-linux-x87.tgz と入力。64bitではx86_64のものにする。<br />
1) ./PWgui でPWguiを起動させる<br />
2) Edit &rarr; Settings &rarr; Specify the path for QE binaries にコンパイルした実行ファイルが入っているespresso-4.2.1/binを指定<br />
3) 計算に必要な擬ポテンシャルをHPのpseudoからDownload the full archive で一括してダウンロードし、解凍したら、$HOME/espressoの中へ入れる<br />
4) Lattice &amp; Atomic data &rarr; Enter atomic types: &rarr; Pseudopotential-file でPseudopotential ...で$HOME/espresso &rarr; pseudo の中で対応するものを選択<br />
&nbsp; ＊ Directory containing pseudopotential files (pseudo_dir) :&nbsp;において、<br />
&nbsp;&nbsp; '/root/home/espresso-4.2.1/espresso/pseudo/'<br />
と指定すれば解凍したファイルの中に擬ポテンシャルファイルを入れればよい。<br />
<br />
■ 基本的な使用方法<br />
-----------------------------<br />
□ SCF計算：<br />
1) PWgui を起動させて、File &rarr; New PW.X Input<br />
2) Control<br />
&nbsp; Optional variables<br />
&nbsp; Type calculation (calculation):&nbsp;Self-Consistent- Field <scf> を選択<br />
3) SYSTEM<br />
&nbsp; a) Required variales は入力が必要<br />
&nbsp; b) Optional variables<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; OccupationsでOccupation of statesをsmearing、<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Gaussian spreading for BZ integraion を0.02 などにする<br />
&nbsp; c) Lattice &amp; Atomic data は入力が必要<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 複数の原子の擬ポテンシャルを用いる場合は、<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; atom.xxx-???.UPF でxxxが同じものを選択する。<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; atom は元素名<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xxx は交換相関項の種類<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ??? は擬ポテンシャルのタイプで、さらに_gipawがあるものはPAW<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ※ xxx では、種類が同じにならないと計算時にエラーが示される。<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Line : Atomic corrdinate unit ではInternal cystal coordinateがお勧め。<br />
&nbsp;&nbsp; d) K-point data<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Automatic generation にして、下にあるnk1, nk2, nk3の値を入力する。<br />
4) PWgui &rarr; Wiew &rarr; Structure with XCrySDen で構造を確認<br />
5) PWgui &rarr; Run で計算<br />
<br />
-----------------------------<br />
□ DOS計算：<br />
※ 注意すべき点としては、テトラヘドロン法はdos.xにしか対応しておらず、ProjWFCには対応していない。dos.x で行う場合は、SCFでoccupations='tetrahedra'とし、dosでdegaussは記述しない。<br />
1) PWgui &rarr;&nbsp;File &rarr; New ProjWFC.X Input<br />
2)&nbsp;PDOS ploting Options<br />
&nbsp;&nbsp;&nbsp; Type of gaussian brodening をSimple Gaussian などに<br />
&nbsp;&nbsp;&nbsp; Gaussian broadening を 0.01 ? 0.025 などに<br />
&nbsp;&nbsp;&nbsp; Resolution of PDOS plot を 0.01などに<br />
&nbsp;&nbsp;&nbsp; Enegy window for PDOS に値を入れると計算される範囲が変えられる<br />
3) DOSの図の表示は<br />
&nbsp;&nbsp;&nbsp; xmgrace xxxx.pdos （&larr; などの名前の付いたファイルを選択）　　<br />
4) フェルミ準位はSCF計算で得られたcase.out に書かれている。<br />
※ データは Total, 磁気量子数の順で出力されている。<br />
s軌道：Eの欄も入れて全部で3列(1+1+1), スピンを考慮した場合は5列(1+2+2)<br />
p軌道：Eの欄も入れて全部で5列(1+1+3), スピンを考慮した場合は9列(1+2+6)<br />
d軌道：Eの欄も入れて全部で7列(1+1+5), スピンを考慮した場合は13列(1+2+10)<br />
<br />
-----------------------------<br />
□ バンド分散：<br />
1) ./PWgui &rarr; View&nbsp;&rarr;&nbsp;Structure with XCrySDen<br />
2) XCrySDen でFile Display .......とある欄で Tools &rarr; k-path&nbsp;を選択<br />
&nbsp;&nbsp;&nbsp; Files of type で PWscf K_POINTS Filesを選択し、case.pwscf で保存<br />
&nbsp;&nbsp;&nbsp; WIEN2kの場合：R&rarr;&Lambda;&rarr;&Gamma;&rarr;&Delta;&rarr;X&rarr;Z&rarr;M&rarr;&Sigma;&rarr;&Gamma;<br />
&nbsp;&nbsp;&nbsp; 論文[1]：&Gamma;&rarr;X&rarr;M&rarr;R&rarr;&Gamma;&nbsp;<br />
&nbsp;&nbsp;&nbsp; ※ Total number of k-points along the... は（labelの数-1)*10 。(調査中)<br />
3)&nbsp;case.pwscf を開いて、K_POINTS crystal の前の空白（スペース）を削除<br />
4) PWgui&nbsp; -&gt; K-point -&gt; Manual specification in CRYSTAL units <crystal> -&gt; Load K-point coordinates from file ... -&gt;&nbsp; case.pwscf<br />
&nbsp;&nbsp;&nbsp;&nbsp; Control -&gt; Verbosity of output (verbosity): high<br />
5)&nbsp;下記の二通りの方法が考えられる。<br />
&nbsp; A) Control &rarr; Non-selfconsistent calculation にチェックを入れて計算。<br />
&nbsp; B) Control &rarr;&nbsp;Band structure&nbsp;calculation にチェックを入れて計算。<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Bの手法を選択し、「分散表示変換プログラム」を用いると、下記を続けなくてもバンド分散の結果を得ることが出来る。<br />
6) bands.in というテキストファイルを作り下記のように入力する。<br />
&nbsp;&nbsp;&nbsp; ----------------------------<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &amp;inputpp<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; prefix = 'pwscf'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; filband = 'bands.dat'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /<br />
&nbsp;&nbsp;&nbsp; ----------------------------<br />
&nbsp;&nbsp;&nbsp; 上記のpwscfはデフォルト指定だとpwscf.saveに対応する<br />
7) $HOME/espresso-4.2.1/bin/bands.x' &lt; bands.in &gt; bands.out<br />
8)&nbsp;$HOME/espresso-4.2.1/bin/plotband.x<br />
&nbsp;&nbsp;&nbsp; input file &gt; bands.dat<br />
&nbsp;&nbsp;&nbsp; Range (Emin, Emax)を聞かれるので左記の範囲内で空白で区切って入力<br />
&nbsp;&nbsp;&nbsp; outpu file (xmgr) &gt; bands.xmgr<br />
&nbsp;&nbsp;&nbsp; outpu file (ps) &gt; bands.ps<br />
&nbsp;&nbsp;&nbsp; Efermi &gt; 14.886<br />
&nbsp;&nbsp;&nbsp; deltaE, reference E(for tics) 1.0, 6.337<br />
9) 以上でバンド分散がpsファイルとして出力される<br />
&nbsp;&nbsp;&nbsp; xmgrace bands.xmgr としてもよい<br />
[1] F. Li et al., Mater. Sci. Eng. B 172 (2010) 136.<br />
※ reference E は 点線を表示する場所。EFの値を入力しておけばよい。<br />
※ spinを分けて表示したい場合は、spin_componet をbands.inに書き入れる。1がupで2がdown。 <a href="http://users.aims.ac.za/~daniel/hands_on/tutorial_postproc.pdf">http://users.aims.ac.za/~daniel/hands_on/tutorial_postproc.pdf</a><br />
※ 構造最適化をした場合は、case.out を読み取って、Current Slide を最後のものにして、Save WIEN2k Struct File にした後に、VESTAで cif にして左欄にある「入力ファイルの変換」で新しい座標の入力ファイルを作る。<br />
※ case.pw.out から バンド図をプロットするプログラムをFortran 77で作成中です。コードを最下段に掲載します。<br />
<br />
-----------------------------<br />
□ 電荷密度分布：<br />
1)&nbsp;PWgui &rarr; File &rarr; New PP.X Input<br />
2) Specify property to calculate<br />
&nbsp;&nbsp;&nbsp; What to calculate (plot_num): charge density&nbsp;を選択<br />
3) Specify Plot<br />
&nbsp;&nbsp;&nbsp; Namelist:PLOT<br />
&nbsp;&nbsp;&nbsp; Number of data files (nfiles): 1<br />
&nbsp;&nbsp;&nbsp; Weighting factors: 1.0<br />
&nbsp;&nbsp;&nbsp; Plot infor<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Name of output file (fileout): 'case_chr.dat'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dimensionality of plot (iflag): 2D plot<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Format of the output (output_format): format suitable for plotrho<br />
&nbsp;&nbsp;&nbsp; Spanning vectros &amp; origin<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 st spanning vector: e1(1): 1.0 e1(2): 1.0 e1(3): 0.0<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2nd spanning vector: e1(1): 0.0 e1(2): 0.0 e1(3): 1.0<br />
&nbsp;&nbsp;&nbsp; Number of points in each direction<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; nx: 56 ny:40<br />
4) Run<br />
5) $HOME/espresso-4.2.1/bin/plotchr.x<br />
&nbsp;&nbsp;&nbsp; input file &gt; case_chr.dat<br />
&nbsp;&nbsp;&nbsp; outpu file &gt; case_chr.ps<br />
&nbsp;&nbsp;&nbsp; Logarithmic scale (y.n)? &gt; n<br />
&nbsp;&nbsp;&nbsp; min, max, # of lovels &gt; 0 0.09 6　(原子単位か？　調査中）<br />
6) 以上で電荷密度分布がpsファイルとして出力される<br />
<br />
-----------------------------<br />
□ STMシミュレーション：<br />
1) PWgui &rarr; File &rarr; New PP.X Input<br />
2) Specify property to calculate<br />
&nbsp;&nbsp;&nbsp; What to calculate (plot_num):&nbsp;STM images&nbsp;を選択<br />
&nbsp;&nbsp;&nbsp; Options for STM images<br />
&nbsp;&nbsp;&nbsp; For STM: the bias of&nbsp;the sample [in Ryd]&nbsp;in ......(sample_bias):&nbsp;EF近傍値<br />
3) Specify Plot<br />
&nbsp;&nbsp;&nbsp; Namelist:PLOT<br />
&nbsp;&nbsp;&nbsp; Number of data files (nfiles): 1<br />
&nbsp;&nbsp;&nbsp; Weighting factors: 1.0<br />
&nbsp;&nbsp;&nbsp; Plot infor<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Name of output file (fileout): 'case_stm.xsf'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dimensionality of plot (iflag): 2D plot<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Format of the output (output_format): XCRYSDEN's XSF format<br />
&nbsp;&nbsp;&nbsp; Spanning vectros &amp; origin<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1st &nbsp;spanning vector: e1(1): 1.0 e1(2): 1.0 e1(3): 0.0<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2nd spanning vector: e1(1): 0.0 e1(2): 0.0 e1(3): 1.0<br />
&nbsp;&nbsp;&nbsp; Number of points in each direction<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; nx: 56 ny:40<br />
4) Run<br />
5) xcrysden --xsf case.xsf<br />
以上でSTM像が出力される<br />
<br />
-----------------------------<br />
□ フォノン分散：<br />
1) PWgui &rarr; New &rarr; New PH.X input<br />
2) INPUTPH<br />
&nbsp;&nbsp;&nbsp; Files/Diretories<br />
&nbsp;&nbsp;&nbsp; File containing the dynamical ......(fildyn): 'case.dyn'<br />
&nbsp;&nbsp;&nbsp; What to Compute<br />
&nbsp;&nbsp;&nbsp; Compute phonon dispersion (ldisp): Yesにチェック<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; nq#1: 4 nq#2:&nbsp;4 nq#3: 4<br />
&nbsp;&nbsp;&nbsp; Control option<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Atomic Masses<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Number of types of atoms in ......(ntyp): 原子の種類分けの数<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; amass : 原子の質量<br />
3) Run<br />
4) q2r.in というテキストファイルを作り下記のように入力する。<br />
&nbsp;&nbsp;&nbsp; ----------------------------<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &amp;input<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fildyn = 'case.dyn'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;zasr='simple'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; flfrc='case444.fc'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/<br />
&nbsp;&nbsp;&nbsp; ----------------------------<br />
5) $HOME/espresso-4.2.1/bin/q2r.x &lt; q2r.in<br />
6) case_matdyn.in というテキストファイルを作り下記のように入力する。<br />
&nbsp;&nbsp;&nbsp; ----------------------------<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &amp;input<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;zasr='simple',<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; amass(1)=&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ...<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; flfrc='case444.fc',<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; flfrq='case.freq'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;k点の数<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kx ky kz&nbsp;kdifferent<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ...<br />
&nbsp;&nbsp;&nbsp; ----------------------------<br />
&nbsp;&nbsp;&nbsp; k点の部分はXCrySDenから出力したcase.pwscfをコピー&amp;ペーストしてもよい。<br />
7) $HOME/espresso-4.2.1/bin/matdyn.x&nbsp;&lt; case_matdyn.in<br />
8) $HOME/espresso-4.2.1/bin/plotband.x case.freq<br />
&nbsp; 加えて、フォノンの状態密度分布は<br />
9)&nbsp;case.phdos.in というテキストファイルを作り下記のように入力する。<br />
&nbsp;&nbsp;&nbsp; ----------------------------<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &amp;input<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; asr='simple',<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amas(1)= ,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ...<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; flfrc='case444.fc',<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; flfrq='case.freq'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dos=.true.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fldos='case_ph.dos'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nk1=4, nk2=4, nk3=4<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /<br />
&nbsp;&nbsp;&nbsp; ----------------------------<br />
10) $HOME/espresso-4.2.1/bin/matdyn.x &lt; case.phdos.in &gt; case.phdos.out<br />
11) xmgrace case_ph.dos<br />
<br />
-----------------------------<br />
□ IR &amp; Raman 計算：<br />
<br />
Infrared and Raman&nbsp;Cross Section<br />
1)&nbsp;PWgui &rarr;&nbsp;Open&nbsp;&rarr; Open PW.X Input<br />
2) SFC計算での入力で下記の変更を行う<br />
&nbsp;&nbsp;&nbsp; Control<br />
&nbsp;&nbsp;&nbsp; Calculate forces (tpronfor):&nbsp;Yes<br />
3) Run<br />
4) PWgui &rarr; New &rarr; PH.X&nbsp;Input<br />
5)&nbsp;INPUTPH<br />
&nbsp;&nbsp;&nbsp; Files/Diretories<br />
&nbsp;&nbsp;&nbsp; File containing the dynamical matrix (fildyn): 'case.dyn'<br />
&nbsp;&nbsp;&nbsp; What to&nbsp;Compute<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Compute phonon dispersions (ldisp):&nbsp;No<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Compute the macroscopic ...... (epsil): Yes<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Compute electron-phonon ...... (elph): No<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Compute dynamic&nbsp;polarizabilities (fpol): No<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Compute Raman coefficients (lraman): No<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Control options<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Restart from an&nbsp;...... (recover): No<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Number of types of atoms ......&nbsp;(ntyp): 原子の種類分けの数<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; amass(1)&nbsp;:&nbsp;原子の質量<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Suffix cards<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xq(1): 0.0&nbsp;xq(2):&nbsp;0.0 xq(3): 0.0<br />
6) Run<br />
7)&nbsp;case.ir.in&nbsp;というテキストファイルを作り下記のように入力する。<br />
&nbsp;&nbsp;&nbsp; ----------------------------<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &amp;input<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fildyn='case.dyn',<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; asr='zero-dim'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /<br />
&nbsp;&nbsp;&nbsp; ----------------------------<br />
8)&nbsp;$HOME/espresso-4.2.1/bin/dynmat.x &lt; case.ir.in &gt; case.ir.out<br />
9)&nbsp;xcrysden --axsf&nbsp;dynmat.axsf<br />
&nbsp;&nbsp;&nbsp; XCrySDen &rarr; Forces にチェックを入れると変化が分かる<br />
<br />
Normal Modes<br />
1)&nbsp;上記2)でK-pointをGammaにしてRun<br />
&nbsp;&nbsp;&nbsp; 対応する擬ポテンシャルがないとエラーが出る。vbcと付いたものが良さそう。<br />
2) 上記6)でRunせずに、case.nm.in名でsaveして、下記を実行<br />
&nbsp;&nbsp;&nbsp; $HOME/espresso-4.2.1/bin/phcg.x &lt; case.nm.in &gt; case.nm.out<br />
3) case.ir.in を case.cs.in という名前にして下記を実行<br />
4)&nbsp;$HOME/espresso-4.2.1/bin/dynmat.x &lt; case.cs.in &gt; case.cs.out<br />
5)&nbsp;xcrysden --axsf dynmat.axsf<br />
&nbsp;&nbsp;&nbsp; XCrySDen &rarr; Forces にチェックを入れると変化が分かる<br />
<br />
Electron-Phonon Interaction Coefficients（調査中）<br />
1) SCF計算の入力ファイル(case.in)で、$System&nbsp;内に&nbsp;la2F =&nbsp;.true., を追加<br />
2)&nbsp;$HOME/espresso-4.2.1/bin/pw.x &lt; case.in &gt; case.out<br />
3) case.elph.in を下記のように作成<br />
&nbsp;&nbsp;&nbsp; ----------------------------<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &amp;inputph<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fildvscf='aldv',<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; amass(1)= ,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ......<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; outdir='./tmp/',<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fildyn='al.dyn',<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; elph=.true.,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; trans=.true.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.0 0.0 1.0<br />
&nbsp;&nbsp;&nbsp; ----------------------------<br />
4)&nbsp;$HOME/espresso-4.2.1/bin/ph.x &lt; case.elph.in &gt; case.elph.out<br />
メモ: denseと付いたファイルでは trans=.true. &rarr; trans=.false.としている。<br />
<br />
-----------------------------<br />
□ 電気伝導度の計算：<br />
PWcond.x を用いる方法 : 下記のHPを参照すれば良い。<br />
&nbsp;&nbsp;<a href="http://people.sissa.it/~smogunov/PWCOND/pwcond.html">http://people.sissa.it/~smogunov/PWCOND/pwcond.html</a>&nbsp;<br />
&nbsp;&nbsp;<a href="http://people.sissa.it/~smogunov/PWCOND/lectures.pdf">http://people.sissa.it/~smogunov/PWCOND/lectures.pdf</a>　<br />
&nbsp;&nbsp;<a href="http://people.sissa.it/~smogunov/PWCOND/examples.html">http://people.sissa.it/~smogunov/PWCOND/examples.html</a><br />
1) case.cond.in を下記のように作成する。（編集中）<br />
2)&nbsp;$HOME/espresso-4.2.1/bin/pwcond.x&nbsp;&lt; case.cond.in<br />
<br />
WanT を用いる方法 :&nbsp;下記のHPでコードが得られる。<br />
&nbsp;&nbsp;<a href="http://www.wannier-transport.org/download.html">http://www.wannier-transport.org/download.html</a><br />
<br />
-----------------------------<br />
□ XANES：<br />
（下記にはCでの例を示す。Core-holeを導入しない場合は下記の5)から行えばよい）<br />
1)&nbsp; case.ld1.in に下記を書き込む（config で 1s1はCore-holeのため）。<br />
　----------------------------------<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &amp;INPUT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; iswitch = 3 ,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; zed = 6.0 ,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; config = '1s1 2s2 2p1.5 3s0 3p0' ,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rel = 1 ,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dft = 'PBE' ,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &amp;InputP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pseudotype = 2 ,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; file_pseudopw = 'C.pbe-cv1s-mt_gipaw.UPF' ,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lloc = 1 ,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tm = .true. ,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lgipaw_reconstruction = .true. ,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2S 2 0 2.000 0.000 1.50 1.50<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2P 2 1 1.500 0.000 1.50 1.50&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&amp;TEST<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; /<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2S 2 0 2.000 0.000 1.50 1.50<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;3S 3 0 0.000 0.000 1.50 1.50<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2P 2 1 1.500 0.000 1.50 1.50&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3P 3 1 0.000 0.000 1.50 1.50&nbsp;<br />
&nbsp;&nbsp; ----------------------------------<br />
&nbsp;&nbsp; 上記の file_pseudopw&nbsp;では利用に便利な名前を入力する。<br />
&nbsp;&nbsp; ./$HOME/espresso-4.2.1/bin/ld1.x&nbsp;<case.ld1.in> case.ld1.out<br />
&nbsp;&nbsp; 上記のコマンドで擬ポテンシャルが作成される。<br />
2)&nbsp;PWgui &rarr;　Open &rarr; Open PW.X input<br />
&nbsp;&nbsp;&nbsp; Control<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Type of calculation (calculation): Self-Consistent-Field <scf><br />
&nbsp;&nbsp;&nbsp; System をscfのときと同じように入力<br />
&nbsp;&nbsp;&nbsp;&nbsp; （構造はスーパーセルが望ましい。ecutwfcは通常より大きな値に）<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Required variables<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Kinteic energy cutoff&nbsp;for&nbsp;...... (ecutwfc): 40.0<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Optional variables<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Total system charge (tot_charge): 1.0<br />
&nbsp;&nbsp;&nbsp; Lattice&nbsp;&amp; Atoms<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; XANESを得たい原子に対して、作成した擬ポテンシャルを選択<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;K-point&nbsp;をscfのときと同じように入力<br />
4)&nbsp;Run<br />
&nbsp;&nbsp; 上記で、XANESでの終状態の波動関数を得る<br />
5)&nbsp;$HOME/espresso-4.2.1/bin/XSpectra/upf2plotcore.sh C.pbe-mt_gipaw.UPF&nbsp;&gt; C.wfc<br />
&nbsp;&nbsp; この手順で始状態の波動関数を得る<br />
6)&nbsp;prefix.xspectra.in&nbsp;を作成する<br />
&nbsp; ----------------------------------<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &amp;input_xspectra<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; calculation='xanes_dipole',<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; prefix='pwscf',<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xonly_plot=.false.,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xniter=1000,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xcheck_conv=50,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xerror=0.001,<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; x_save_file='prefix.xspectra.sav',<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ef_r=${FERMI_LEVEL},<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xiabs=1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xepsilon(1)=1.0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xepsilon(2)=0.0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xepsilon(3)=0.0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &amp;plot<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xgamma=0.8,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xnepoint=1000,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xemin=-10.0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xemax=30.0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; terminator=.true.,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cut_occ_states=.true.,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &amp;pseudos<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; filecore='C.wfc',<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; r_paw(1)=3.2,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &amp;cut_occ<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cut_desmooth=0.1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cut_stepl=0.01,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4 4 4 1 1 1<br />
&nbsp; ----------------------------------<br />
最後の数値はK-pointである。SCF計算の時に入力したファイルを参考に値を入力すればよい。各入力データの意味は「X-ray absorption lecture note : 」を参照して下さい。時間があれば意味をここに書き加えます。<br />
7) $HOME/espresso-4.2.1/bin/xspectra.x &lt; prefix.xspectra.in &gt; prefix.xspectra.out<br />
8) xmgrace xanes.dat<br />
<br />
-------------<br />
（所有しているPCではLD1.X input で上手く動作しなかった。調査中）<br />
1) PWgui &rarr; New &rarr; New LD1.X input<br />
2) General<br />
&nbsp;&nbsp;&nbsp; Required varibles<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Type of calculation (iswitch): PseudoPotential Generationを選択<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Nuclear charge (zed):&nbsp;6.0<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Electronic&nbsp;configuration (config): '1s2 2s2 2p1.5 3s0 3p0'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 内殻を空孔を作る場合は2を1にする。例えば1s2&nbsp;&rarr; 1s1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Relativistic Effects (rel): Scalar Relativistic<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Exchange-Correlation (dft): Predew-Becke-Ernzerhof (PBE)<br />
3) PsudoPotential Generation<br />
&nbsp;&nbsp;&nbsp; Required varibles<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Type of PsudoPotential (pseudotype): Norm Conserving, more than ......<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Name of the ...... (file_pseudopw): 'C.pbe-cv1s-mt_gipaw.UPF'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Local Potential channel (lloc): L=1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Type of pseudization procedure (tm): Troullier-Martins<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Generate all-electron data for GIPAW (lgipaw_reconstruction): Yes<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; All-electron cards<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Number of states: 2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Label N L Occupancy Energy Rcut USRcut<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2S&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp; 0&nbsp; 2.00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.00&nbsp;&nbsp;&nbsp;&nbsp; 1.5&nbsp;&nbsp; 1.5<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2P&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp; 1&nbsp; 1.50&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.00&nbsp;&nbsp;&nbsp;&nbsp; 1.5&nbsp;&nbsp; 1.5<br />
4) PseudoPotential Test<br />
&nbsp;&nbsp;&nbsp; Number of testing configureations&nbsp;(nconf): 1<br />
&nbsp;&nbsp;&nbsp; Testing&nbsp;configuration&nbsp;#.1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Number of states: 4<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Label N L Occupancy Energy Rcut USRcut<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2S&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 &nbsp;0&nbsp; 2.00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.00&nbsp;&nbsp;&nbsp;&nbsp; 1.5&nbsp;&nbsp; 1.5<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3S&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;0&nbsp; 0.00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.00&nbsp;&nbsp;&nbsp;&nbsp; 1.5&nbsp;&nbsp; 1.5<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2P&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp; 1&nbsp;&nbsp;1.50&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.00&nbsp;&nbsp;&nbsp;&nbsp; 1.5&nbsp;&nbsp; 1.5<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3P&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp; 1&nbsp; 0.00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.00&nbsp;&nbsp;&nbsp;&nbsp; 1.5&nbsp;&nbsp; 1.5<br />
5) Run<br />
X-ray absorption lecture note :<br />
<a href="http://cdsagenda5.ictp.it/askArchive.php?base=agenda&amp;categ=a10125&amp;id=a10125s1t6/lecture_notes">http://cdsagenda5.ictp.it/askArchive.php?base=agenda&amp;categ=a10125&amp;id=a10125s1t6/lecture_notes</a><br />
-----------------------------<br />
□ 時間依存密度汎関数法（TDDFT）：<br />
（PWscf-4.3以降から&beta;版として利用が可能となっている。心が折れた&hellip;&hellip;）（編集中）<br />
<br />
-----------------------------<br />
□ 分子動力学法：（SCF計算の例を参考に入力ファイルを作って下さい）<br />
1) PWguiを起動させて、File &rarr; Open &rarr; open PW.X Input<br />
2) Control<br />
&nbsp;&nbsp;&nbsp; Optional variables<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Type calculation (calculation):&nbsp;Molecular dynamics&nbsp;<md> を選択<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 格子定数も変えたい場合はMolecular ......<vc-md>を選択<br />
&nbsp;&nbsp;&nbsp; Miscellaneous control parameters<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Number of ionic steps (nstep): 50<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Molecular-Dynamics time step (dt): 20.0<br />
3) Ions<br />
&nbsp;&nbsp;&nbsp; Type of extrapolation (pot_extrapolation):&nbsp;extrapolate ...... <atomic><br />
&nbsp;&nbsp;&nbsp; Type of extrapolation (wfc_extrapolation): no extrapolation <none><br />
&nbsp;&nbsp;&nbsp; Molecular Dynamics<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Starting temperature in MD runs (tempw): 300<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Tolerance for velocity rescaling (tolp): 0.001<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Temperature rescaling (delta_t): 1.0<br />
4) Run<br />
5) xcrysden --pwo case.out<br />
&nbsp;&nbsp;&nbsp; do not reduce dimensionality<br />
&nbsp;&nbsp;&nbsp; Display All Coordinates as Animation<br />
&nbsp;&nbsp;&nbsp; &rarr;　&rarr;　で動画を見ることができる<br />
<br />
-----------------------------<br />
□ 構造最適化：（SCF計算の例を参考に入力ファイルを作って下さい）<br />
(Quasi-Newton ionic relaxation)<br />
1) PWguiを起動させて、File &rarr; Open &rarr; open PW.X Input<br />
2) Control<br />
&nbsp;&nbsp;&nbsp; Optional variables<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Type calculation (calculation):&nbsp;Ionic relaxation&nbsp;<relax> を選択<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 格子定数も変えたい場合はIonic ......<vc-relax>を選択<br />
&nbsp;&nbsp;&nbsp; Miscellaneous control parameters<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Number of ionic steps (nstep): 50<br />
3) Ions<br />
&nbsp;&nbsp;&nbsp; Type of ionic dynamics (ion_dynamics): BFGS......<bfgs><br />
&nbsp;&nbsp;&nbsp; Type of extrapolation (pot_extrapolation): extrapolate ...... <atomic><br />
&nbsp;&nbsp;&nbsp; Type of extrapolation (wfc_extrapolation): no extrapolation <none><br />
&nbsp;&nbsp;&nbsp; BFGS Structure Optimization<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Max. reduction&nbsp;factor&nbsp;(upscale):&nbsp;10.D0<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Maximum ionic displacement&nbsp;in the ......(trust_radius_max): 0.5<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Minimum ionic displacement in the ......&nbsp;(trust_radius_min):&nbsp;0.001<br />
&nbsp;&nbsp;&nbsp; Parameters used in line search based on the Wolfe conditions:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; w_1: 0.01<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; w_2: 0.5<br />
4) Run<br />
5) xcrysden --pwo case.out<br />
&nbsp;&nbsp;&nbsp; 構造最適化の結果を見ることができる。xcrysdenでは、PWscfのcase.outを「Display All Coordinates as Animation」で開くとエラーが出にくい。<br />
<br />
特定の原子を固定したいときは、原子座標の記述の後に 0 0 0 と記述する。<br />
-----------------------------<br />
□ 各点でのフォノン：<br />
1)&nbsp;PWscf &rarr; New &rarr; New PH.X input<br />
2) INPUTPH<br />
&nbsp;&nbsp;&nbsp; Files/Diretories<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; File containing the&nbsp;dynamical ......(fildyn): 'case.dynE'<br />
&nbsp;&nbsp;&nbsp; Control option<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Atomic&nbsp;Masses<br />
&nbsp; &nbsp;&nbsp;&nbsp; Number of types of atoms in ......(ntyp):&nbsp;原子の種類分けの数<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; amass : 原子の質量<br />
3) Suffix cards<br />
&nbsp;&nbsp;&nbsp; Line : The phonon wavevector<br />
&nbsp;&nbsp;&nbsp; xq(1) : 0.0 xq(2): 0.0 xq(3):0.0 &larr; 得たい点の座標<br />
4) Run<br />
5) case_dynmat.in というテキストファイルを作り下記のように入力する。<br />
&nbsp;&nbsp;----------------------------<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &amp;input<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fildyn = 'case.dynE'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /<br />
&nbsp;&nbsp;----------------------------<br />
6)&nbsp;$HOME/espresso-4.2.1/bin/dynmat.x <case_dynmat.in> dynmat.axsf<br />
7) xcrysden --axsf dynmat.axsf<br />
8) XCrySDen &rarr; Forces<br />
-----------------------------<br />
□ 擬ポテンシャルの変換<br />
&nbsp;<br />
CPMD タイプの場合<br />
1) <a href="http://people.web.psi.ch/krack/potentials.html">http://people.web.psi.ch/krack/potentials.html</a><br />
2) 交換相関項を選択。例えば、PBEなど<br />
3) ファイル形式を選択。例えば、CPMDなど<br />
4) Show all matching files から欲しい擬ポテンシャルをダウンロードする<br />
5) cd espresso-4.3.2/upftools<br />
6) cpmd2upf.x Sb-q5<br />
7) 以上でPWscf用の非相対論の擬ポテンシャルが作成される。<br />
<br />
Fritz Haber タイプの場合（調査中）<br />
1)&nbsp;<a href="http://www.quantum-espresso.org/pseudo-notes.php">http://www.quantum-espresso.org/pseudo-notes.php</a>&nbsp;<br />
2)&nbsp;<a href="http://www.abinit.org/downloads/psp-links/pseudopotentials">http://www.abinit.org/downloads/psp-links/pseudopotentials</a>&nbsp;<br />
3)&nbsp;GGA (PBE) pseudopotential files :&nbsp;<br />
&nbsp; Fritz-Haber-Institute (FHI) pseudopotentials for selected elements (Troullier-Martins scheme)<br />
4)&nbsp;上記のHPから欲しい擬ポテンシャルのファイルをダウンロード<br />
5) cd espresso-4.3.2/upftools<br />
6)&nbsp;fhi2upf.x&nbsp;51-Sb.GGA.fhi<br />
7) Confirm or modify l max, l loc (read:3&nbsp; 0)&gt; 3,0<br />
8) 次に、擬ポテンシャルをダウンロードしたHPの下にある&nbsp;ini ファイルを参考にして入力。<br />
&nbsp;&nbsp;&nbsp; n l&nbsp;f が並んでいるところの一番したから入力していく。<br />
&nbsp;&nbsp;&nbsp; Wavefunction #1: lavel (e.g. 4s), occupancy &gt;5p, 3&nbsp;<br />
&nbsp;&nbsp; &nbsp;Wavefunction #2: lavel (e.g. 4s), occupancy &gt;5s,&nbsp;2<br />
&nbsp;&nbsp; &nbsp;Wavefunction #3: lavel (e.g. 4s), occupancy &gt;4d,&nbsp;10<br />
&nbsp;&nbsp;&nbsp; Wavefunction #4: lavel (e.g. 4s), occupancy &gt;4p,&nbsp;6<br />
9) 以上でPWscf用の非相対論の擬ポテンシャルが作成される。<br />
<br />
-----------------------------<br />
□ 擬ポテンシャルの作り方 （調査中）<br />
※1 作成した擬ポテンシャルは、構造最適化を行って格子定数が実験値と2-3%内であり、体積弾性率が実験値や他の信頼できる擬ポテンシャルと似ていること。そして、バンド分散を描いてゴーストバンドが存在していないことを確認する。<br />
※2 全エネルギーはCore / Semi-core / valence を区切る範囲やコア半径の大きさによって変わる為、他の擬ポテンシャルを用いた場合と絶対値が異なっていてもよい。<br />
<br />
1) Sb.pbe-tm.UPFの場合<br />
&nbsp; -----------------------------<br />
&nbsp; &amp;INPUT<br />
&nbsp; iswitch = 3 ,<br />
&nbsp; zed = 51.0 ,<br />
&nbsp; config = '1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 5s2 5p3' ,<br />
&nbsp; rel = 1 ,<br />
&nbsp; dft = 'PBE' ,<br />
&nbsp; /<br />
&nbsp; &amp;InputP<br />
&nbsp; pseudotype = 3 ,<br />
&nbsp; file_pseudopw = 'Sb.pbe-tm.UPF' ,<br />
&nbsp; lloc = 1 ,<br />
&nbsp; tm = .true. ,<br />
&nbsp; /<br />
&nbsp; 3<br />
&nbsp; 4D 4 2 10.00 0.00 2.00 2.20<br />
&nbsp; 5S 5 0 2.00 0.00 2.00 2.20<br />
&nbsp; 5P 5 1 3.00 0.00 2.00 2.20<br />
<br />
&nbsp; &amp;TEST<br />
&nbsp; /<br />
&nbsp; 3<br />
&nbsp; 4D 4 2 10.00 0.00 2.00 2.20<br />
&nbsp; 5S 5 0 2.00 0.00 2.00 2.20<br />
&nbsp; 5P 5 1 3.00 0.00 2.00 2.20<br />
&nbsp; -----------------------------<br />
<br />
1) Sb.pbe-rrkjus.UPFの場合<br />
&nbsp; -----------------------------<br />
&nbsp; &amp;INPUT<br />
&nbsp; iswitch = 3 ,<br />
&nbsp; zed = 51.0 ,<br />
&nbsp; config = '1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 5s2 5p3' ,<br />
&nbsp; rel = 1 ,<br />
&nbsp; dft = 'PBE' ,<br />
&nbsp; /<br />
&nbsp; &amp;InputP<br />
&nbsp; pseudotype = 3 ,<br />
&nbsp; file_pseudopw = 'Sb.pbe-rrkjus.UPF' ,<br />
&nbsp; lloc = 1 ,<br />
&nbsp; tm = .false.<br />
&nbsp; /<br />
&nbsp; 3<br />
&nbsp; 4D 4 2 10.00 0.00 3.40 3.40<br />
&nbsp; 5S 5 0 2.00 0.00 4.00 4.00<br />
&nbsp; 5P 5 1 3.00 0.00 4.60 4.60<br />
&nbsp; &amp;TEST<br />
&nbsp;&nbsp;/<br />
&nbsp; 3<br />
&nbsp; 4D 4 2 10.00 0.00 3.40 3.40<br />
&nbsp; 5S 5 0 2.00 0.00 4.00 4.00<br />
&nbsp; 5P 5 1 3.00 0.00 4.60 4.60<br />
&nbsp; -----------------------------<br />
&nbsp; ※ 上記の条件だと cut-off 22 Ry 程度とcase.ld1.outに出力される。<br />
&nbsp; ※ [Kr] 410 5s2 5p3 という表記方法では動作しなかった。<br />
&nbsp; ※ Rcut と US Rcut の値が良いものだと、Errors in PS-KS equation のエラーが消えて、擬ポテンシャルが作成される。Rcut と US Rcut が小さすぎると n is too large と出る。<br />
2) ld1.x のコマンドを用いて擬ポテンシャルを作成する。<br />
&nbsp; ./$HOME/espresso-4.2.1/bin/ld1.x <case.ld1.in> case.ld1.out<br />
<br />
References<br />
[1] <a href="http://www.democritos.it/pipermail/pw_forum/2011-September/021827.html">http://www.democritos.it/pipermail/pw_forum/2011-September/021827.html</a><br />
[2] <a href="http://www.democritos.it/pipermail/pw_forum/2008-December/010960.html">http://www.democritos.it/pipermail/pw_forum/2008-December/010960.html</a><br />
[3] <a href="http://www.quantum-espresso.org/wiki/index.php/Naming_convention_for_the_pseudopotential">http://www.quantum-espresso.org/wiki/index.php/Naming_convention_for_the_pseudopotential</a><br />
[4] <a href="http://www.quantum-espresso.org/pseudo.php">http://www.quantum-espresso.org/pseudo.php</a><br />
[5] <a href="http://www.pwscf.org/pseudo.htm">http://www.pwscf.org/pseudo.htm</a><br />
-----------------------------<br />
<br />
-------------------------------------------------------------------------------<br />
□ PAW<br />
1) download: <a href="http://www.wfu.edu/~natalie/papers/pwpaw/man.html">http://www.wfu.edu/~natalie/papers/pwpaw/man.html</a><br />
2) tar zxvf atompaw-3.0.1.3.tar.gz<br />
3) cd atompaw-3.0.1.3<br />
4) ./configure CC=icc LIBS=&quot;-L/opt/intel/Compiler/11.0/084/mkl/lib/em64t -lmkl_intel_lp64 -lmkl_intel_thread -lmkl_core -liomp5 -lpthread&quot; --prefix=/home/ubuntu11/atompaw-3.0.1.3<br />
5) make<br />
6) make check<br />
7) make install<br />
<br />
使い方（調査中）<br />
Examples<br />
-----------------------------<br />
A &ldquo;minimal&rdquo; input file<br />
Boron [1s2] 2s2 2p1<br />
4 partial-waves in basis<br />
-----------------------------<br />
B 5. # atome name # Z番号<br />
LDA-PW&nbsp;! XC_function. LDA-PW or GGA-PBE<br />
2 2 0 0 0&nbsp;! s, p, d, f, g の最大値,&nbsp;例えば Nickel 4 3 3 0 0<br />
2 1 1.0 ! 2p1 (n=2, l=1, occupation=1), 埋まっていない軌道だけ記述でもよい<br />
0 0 0<br />
c&nbsp;! 1s core<br />
v&nbsp;! 2s valence<br />
v&nbsp;! 2p valence<br />
1&nbsp;! Basis contains s and p partial-waves<br />
1.7&nbsp;! Rasius (atomic units), rpaw=1.7<br />
y&nbsp;! additional s partial-wave &larr; 2s ？<br />
3.! at Eref=3.0 Ry&nbsp;<br />
n<br />
y ! additional&nbsp;p partial-wave &larr; 2p ？<br />
3.! at Eref=3.0 Ry<br />
n<br />
vanderbilt ! projector_keyword<br />
2 0. ! l=2, Eref=0.0 Ry<br />
1.5 ! Matching radius for Phi1 (l=0) &larr; 2s up？<br />
1.5 ! Matching radius for Phi2 (l=0) &larr; 2s down？<br />
1.7 ! Matching radius for Phi3 (l=1) &larr; 2p up？<br />
1.7 ! Matching radius for Phi4 (l=1) &larr; 2p down？<br />
2&nbsp;! 2=abinit, 3=PWscf<br />
default&nbsp;! PWscf の場合、pufdx, upfxmin upfzmesh の入力が必要<br />
0 ! END<br />
-----------------------------<br />
<br />
A &ldquo;complete&rdquo; input file<br />
Nickel [1s2 2s2 2s6 3s2 3p6] 3d9 4s1 4p0<br />
6 partial-waves in basis<br />
-----------------------------<br />
Nickel 28.<br />
GGA-PBE<br />
scalarrelativistic<br />
point-nucleus<br />
loggrid 1500 80. 2.3 loggderivrange -10. 10. 300<br />
4 4 3 0 0　! Up to 4s, 4p and 3d9 4s2 4p0<br />
1 0 2.0　! Electronic configuration 3d 4s 4p<br />
2 0 2.0<br />
2 1 6.0<br />
3 0 2.0<br />
3 1 6.0<br />
3 2 9.0<br />
4 0 1.0<br />
4 1 0.0<br />
0 0 0<br />
c ! 1s<br />
c ! 2s<br />
c ! 3s<br />
v ! 4s valence<br />
c ! 2p<br />
c ! 3p<br />
v ! 4p valence<br />
v ! 3d valence<br />
2 ! Basis contains s, p and d partial-waves<br />
2.3 2.3 1.1 2.2 ! rpaw=2.3, rshape=2.3, rveff=1.1, rcore=2.2<br />
y ! Additional s partial-wave<br />
4. ! at Eref=4.0 Ry<br />
n<br />
y ! Additional p partial-wave<br />
4. ! at Eref=4.0 Ry<br />
n<br />
y ! Additional d partial-wave<br />
2.5 ! at Eref=2.5 Ry<br />
n<br />
custom rrkj gramschmidtortho sinc ! RRKJ PW + sinc shape func.<br />
Bessel ! Simple Bessel Vloc<br />
2.3 ! Matching radius for Phi1 (l=0)<br />
2.3 ! Matching radius for Phi2 (l=0)<br />
2.3 ! Matching radius for Phi3 (l=1)<br />
2.3 ! Matching radius for Phi4 (l=1)<br />
2.3 ! Matching radius for Phi5 (l=2)<br />
2.3 ! Matching radius for Phi6 (l=2)<br />
1<br />
1 0 2.0 ! Test configuration 3d 4s<br />
2 0 2.0<br />
2 1 6.0<br />
3 0 2.0<br />
3 1 6.0<br />
3 2 8.0<br />
4 0 2.0<br />
0 0 0<br />
2 ! Output for abinit<br />
prtcorewf noxcnhat rsoptim 12. 2. 0.00001 logspline 500 0.03 ! abinit options<br />
3 ! Outpu for PWscf<br />
upfdx 0.005 upfxmin -9.0 upfzmesh 1.0 ! PWscf options<br />
0 ! END<br />
<br />
-------------------------------------------------------------------------------<br />
-------------------------------------------------------------------------------<br />
※ 「espresso-4.3.2」&rarr;「Doc」&rarr;「user_guide.pdf」 P.29 などを見ておくとよい。<br />
□ 並列化1（業者様向け） ＜gfortranでのコンパイル＞<br />
&nbsp; 下記を実行前に、andLinuxにあるsudo apt-get install を全て入れておく。<br />
&nbsp; tar zxvf espresso-4.3.2.tar.gz<br />
&nbsp; cd espresso-4.3.2<br />
&nbsp; ./configure<br />
&nbsp; make all<br />
<br />
□ 並列化2（業者様向け） ＜gfortranでのコンパイル＞<br />
&nbsp;&nbsp;下記を実行前に、andLinuxにあるsudo apt-get install を全て入れておく。<br />
&nbsp; Intel fortranなどGNU系以外のものをインストールした後で、GNUを用いたい場合は、下記のようにしてもよい。<br />
&nbsp; MPIF90=mpif90<br />
&nbsp; FC=gfortran<br />
&nbsp; F77=gfortran<br />
&nbsp; F90=gfortran<br />
&nbsp; CC=gcc<br />
&nbsp; CXX=g++<br />
&nbsp; export MPIF90 FC F77 F90 CC CXX<br />
&nbsp; FFLAGS='-O2'<br />
&nbsp; CFLAGS='-O2'<br />
&nbsp; export FFLAGS CFLAGS<br />
&nbsp; BLAS_LIBS='-lblas'<br />
&nbsp; LAPACK_LIBS='-llapack'<br />
&nbsp; FFT_LIBS='-lfftw3'<br />
&nbsp; export BLAS_LIBS LAPACK_LIBS FFT_LIBS<br />
&nbsp; tar zxvf espresso-4.3.2.tar.gz<br />
&nbsp; cd espresso-4.3.2<br />
&nbsp; ./configure<br />
&nbsp; make all&nbsp;<br />
<br />
□ 並列化1（学生様向け）＜Intel Compiler + MPICH でのコンパイル＞<br />
&nbsp; 下記を実行前に、&nbsp;ライブラリの設定 を参考にMPICH, FFTW3を導入する。<br />
&nbsp; MPIF90=/usr/local/mpich/bin/mpif90<br />
&nbsp; FC=ifort<br />
&nbsp; F77=ifort<br />
&nbsp; F90=ifort<br />
&nbsp; CC=gcc<br />
&nbsp;&nbsp;CXX=g++<br />
&nbsp; export MPIF90 FC F77 F90 CC CXX<br />
&nbsp;&nbsp;FFLAGS='-O2 -assume byterecl'<br />
&nbsp; CFLAGS='-O2'<br />
&nbsp;&nbsp;DFLAGS='-D__INTEL'<br />
&nbsp; export&nbsp;FFLAGS&nbsp;CFLAGS&nbsp;DFLAGS<br />
&nbsp; BLAS_LIBS='-L/opt/intel/Compiler/11.1/080/mkl/lib/32 -lmkl_blas95 -lmkl_intel -lmkl_intel_thread -lmkl_core -lifcore -lguide -lpthread -lsvml'<br />
&nbsp; LAPACK_LIBS='-L/opt/intel/Compiler/11.1/080/mkl/lib/32 -lmkl_lapack95'<br />
&nbsp; FFT_LIBS='-L/usr/local/lib -lfftw3'<br />
&nbsp; export BLAS_LIBS LAPACK_LIBS FFT_LIBS<br />
&nbsp; tar zxvf espresso-4.3.2.tar.gz<br />
&nbsp; cd espresso-4.3.2<br />
&nbsp; ./configure<br />
&nbsp; make all<br />
※上手くいかない場合は、再度ターミナル（コンソール）を初めから開いて行う。<br />
参考文献：<a href="http://nitrogen14.blog51.fc2.com/blog-entry-36.html">http://nitrogen14.blog51.fc2.com/blog-entry-36.html</a><br />
<br />
□ 並列化2（学生様向け）＜Intel Compiler + MPICH でのコンパイル＞<br />
下記を実行前に、 ライブラリの設定 を参考にMPICH, FFTW3を導入する。<br />
&nbsp; MPIF90=/usr/local/mpich/bin/mpif90<br />
&nbsp; FC=ifort<br />
&nbsp; F77=ifort<br />
&nbsp; F90=ifort<br />
&nbsp; CC=gcc<br />
&nbsp; CXX=g++<br />
&nbsp; export MPIF90 FC F77 F90 CC CXX<br />
&nbsp; FFLAGS='-O2 -assume byterecl'<br />
&nbsp; CFLAGS='-O2'<br />
&nbsp; DFLAGS='-D__INTEL'<br />
&nbsp; export FFLAGS CFLAGS DFLAGS<br />
&nbsp; BLAS_LIBS='-L/opt/intel/Compiler/11.1/080/mkl/lib/32 -lmkl_blas95 -lmkl_blacs -lmkl_intel -lmkl_intel_thread -lmkl_core -lifcore -lguide -lpthread -lsvml'<br />
&nbsp; LAPACK_LIBS='-L/opt/intel/Compiler/11.1/080/mkl/lib/32 -lmkl_lapack95 -lmkl_scalapack_core'<br />
&nbsp; FFT_LIBS='-L/usr/local/lib -lfftw3 -lfftw3_mpi'<br />
&nbsp; export BLAS_LIBS LAPACK_LIBS FFT_LIBS<br />
&nbsp; tar zxvf espresso-4.3.2.tar.gz<br />
&nbsp; cd espresso-4.3.2<br />
&nbsp; ./configure<br />
&nbsp; make all<br />
参考文献：<a href="http://nitrogen14.blog51.fc2.com/blog-entry-36.html">http://nitrogen14.blog51.fc2.com/blog-entry-36.html</a><br />
※上手くいかない場合は、再度ターミナル（コンソール）を開いて初めから行う。<br />
<br />
□ 並列化3（学生様向け）（調査中）＜Intel Compilerでのコンパイル＞<br />
下記を実行前に、 ライブラリの設定 を参考にMPICH, OPENMP, LAM, インテルのFFTW3を導入する（導入の仕方はPhaseのインストールマニュアルや下記の参考文献に記載がある）。<br />
&nbsp; MPIF90=mpif90<br />
&nbsp; FC=ifort<br />
&nbsp; F77=ifort<br />
&nbsp; F90=ifort<br />
&nbsp; CC=icc<br />
&nbsp; CXX=icpc<br />
&nbsp; export MPIF90 FC F77 F90 CC CXX<br />
&nbsp; FFLAGS='-O2 -assume byterecl'<br />
&nbsp; CFLAGS='-O2'<br />
&nbsp; DFLAGS='-D__INTEL -D__FFTW3'<br />
&nbsp; export FFLAGS CFLAGS DFLAGS<br />
&nbsp; BLAS_LIBS='-L/opt/intel/Compiler/11.1/080/mkl/lib/32 -lmkl_blas95 -lmkl_intel -lmkl_intel_thread -lmkl_core -lifcore -lguide -lpthread -lsvml'<br />
&nbsp; LAPACK_LIBS='-L/opt/intel/Compiler/11.1/080/mkl/lib/32 -lmkl_lapack95'<br />
&nbsp; FFT_LIBS='-L/opt/intel/Compiler/11.1/080/mkl/lib/32 -lfftw3xf_intel'<br />
&nbsp; export BLAS_LIBS LAPACK_LIBS FFT_LIBS<br />
&nbsp; tar zxvf espresso-4.3.2.tar.gz<br />
&nbsp; cd espresso-4.3.2<br />
&nbsp; ./configure<br />
&nbsp; make all<br />
参考文献：<a href="http://nitrogen14.blog51.fc2.com/blog-entry-36.html">http://nitrogen14.blog51.fc2.com/blog-entry-36.html</a><br />
<a href="http://nitrogen14.blog51.fc2.com/blog-entry-14.html">http://nitrogen14.blog51.fc2.com/blog-entry-14.html</a><br />
<br />
-------------------------------------------------------------------------------<br />
-------------------------------------------------------------------------------<br />
□ 附録：graceのインストール（ubuntu-ja-8.04 on VMwarePlayer)<br />
&nbsp; sudo dpkg -i fftw2_2.1.3-16.2_i386.deb<br />
&nbsp; sudo dpkg -i lesstif2_0.94.4-1_i386.deb<br />
&nbsp; sudo dpkg -i libnetcdf3_3.6.0+3.6.1-beta3-0ubuntu1_i386.deb<br />
&nbsp; sudo dpkg -i libt1-5_5.1.0-2ubuntu0.6.06.1_i386.deb<br />
&nbsp; sudo dpkg -i xmhtml1_1.1.7-14_i386.deb<br />
&nbsp; sudo dpkg -i grace_5.1.18-4ubuntu1_i386.deb<br />
-------------------------------------------------------------------------------<br />
□ 大規模な系ではIntel Fortran &amp; C Compiler +&nbsp;MKL またはATLASが望まれる（64bitタイプ及び並列化も重要）。<br />
Intel Fortran Compiler +&nbsp;MKL (並列化無し）の場合<br />
PWscf : <a href="http://www.quantum-espresso.org/">http://www.quantum-espresso.org/</a><br />
&nbsp; Intel Fotran Compiler + MKL<br />
&nbsp;&nbsp;&nbsp;&nbsp; tar zxvf espresso-4.2.1.tar.gz<br />
&nbsp;&nbsp;&nbsp;&nbsp; cd espresso-4.2.1<br />
&nbsp;&nbsp;&nbsp;&nbsp; ./configure BLAS_LIBS='-lmkl_blas95 -lmkl_intel -lmkl_intel_thread -lmkl_core -lifcore -lguide -lpthread -lsvml' LAPACK_LIBS='-lmkl_lapack95'<br />
make all xspectra<br />
<br />
-------------------------------------------------------------------------------<br />
□ 下記はSpin を入れた系に対するバンド図プロット用 Fortran77コードの例です。<br />
<br />
コンパイルの仕方<br />
1. テキストファイルに下記のプログラムをコピー&amp;ペーストし、例えば pwscf_band2plot.f という名称でSAVEします。<br />
2. 6100 continue などど 数値と continue のある行の最初に空白を入れてください。<br />
3. Terminal を開いて、cd で pwscf_band2plot.f のあるディレクトリをカレントディレクトにします。<br />
4. gfortran pwscf_band2plot.f -o pwscf_band2plot と入力します。そうすると、実行ファイルが作成されます。<br />
<br />
使い方<br />
1. case.pw.out をコピーしてf01というファイル名にします。<br />
2. 上記でコンパイルして作成された実行ファイル pwscf_band2plot を実行します。<br />
3. 出力されたf10とf20がそれぞれupとdownの結果になります（non spinの場合 f10に結果が出力される）。プロットはWIEN2kと同じように、最後の2列をxとyに指定すれば良いです。<br />
※ case.pw.outの結果を並べ替えただけですので、EFを0としたい場合はご自身で計算してください。<br />
c=======================================================================<br />
c&nbsp; pwscf_band2plot.f<br />
c&nbsp;&nbsp;&nbsp; 2012. 7. 8&nbsp; Version 1.00&nbsp; written by ***<br />
c=======================================================================<br />
c&nbsp; process<br />
c --------------------------------------------------------------------<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IMPLICIT NONE<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; integer*4 kpoint_num_para<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; parameter (kpoint_num_para = 999)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; integer*4 eigen_num_para<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; parameter (eigen_num_para = 9999)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; character*130 READOR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
c spin<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; integer*4 spin<br />
c do loop<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; integer*4 i, j, m, n<br />
c number of kpoint<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; integer*4 num_kpoint<br />
c number of eigen<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; integer*4 num_eigen<br />
c read_eigen_line<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; integer*4 read_eigen_line<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
c EF_eV<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; real*8 EF_eV<br />
c kpoint, h, k, l<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; real*8 h(kpoint_num_para), k(kpoint_num_para), l(kpoint_num_para)<br />
c temp_delta_kpoint<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; real*8 temp_delta_kpoint<br />
c deltal_kpoint_length = sqrt( temp_delta_kpoint)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; real*8 delta_kpoint_length(kpoint_num_para)<br />
c total_kpoint_length<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; real*8 total_kpoint_length(kpoint_num_para)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
c up spin<br />
c eigenvalue(eigenvalue, kpoint, spin)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; real*8 eigenvalue_up(eigen_num_para, kpoint_num_para)<br />
c eigenvalue_ef = eigenvalue - EF<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; real*8 eigenvalue_up_sub_ef(eigen_num_para, kpoint_num_para)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
c down spin<br />
c eigenvalue(eigenvalue, kpoint, spin)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; real*8 eigenvalue_down(eigen_num_para, kpoint_num_para)<br />
c eigenvalue_ef = eigenvalue - EF<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; real*8 eigenvalue_down_sub_ef(eigen_num_para, kpoint_num_para)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
c read line start number<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; integer*4 num_eigen_line<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; integer*4 num_kpoint_line<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; spin = 2<br />
<br />
c f01 : read *.pw.out data<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; open( 1, file = 'f01' )<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
c read basic data<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rewind(01)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; i = 0<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; do<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; i = i + 1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; read( 1,'( a130 )' ) READOR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if( READOR(1:32) .eq. '&nbsp;&nbsp;&nbsp;&nbsp; number of Kohn-Sham states=' ) then<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; num_eigen_line = i<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end if<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if( READOR(1:24) .eq. '&nbsp;&nbsp;&nbsp;&nbsp; number of k points=' ) then<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; num_kpoint_line = i - 1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; goto 6100<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end if<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end do<br />
6100 continue<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rewind(01)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; i = 0<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; do<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; i = i + 1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if( num_eigen_line .eq. i ) then<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; read( 1,'( 32x,i13 )' ) num_eigen<br />
c&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; write( 6,'( 32x,i13 )' ) num_eigen<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; read( 1,'( a130 )' ) READOR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end if<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if( num_kpoint_line .eq. i ) then<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; read( 1,'( 24x,i8 )' ) num_kpoint<br />
c&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; write( 6,'( 24x,i8 )' ) num_kpoint<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; goto 6200<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end if<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end do<br />
6200 continue<br />
<br />
c read eigenvalue data<br />
c&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; write(6,*) 'OK'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; do<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if( READOR(1:28) .eq. ' ------ SPIN UP ------------' ) then<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; spin = 2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; j = 0<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; total_kpoint_length(1) = 0.0<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; read( 1,'( a130 )' ) READOR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; read( 1,'( a130 )' ) READOR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; do<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; j = j + 1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; read( 1,'( 13x, 3f7.4 )' ) h(j), k(j), l(j)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if( j .ge. 2 ) then<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; temp_delta_kpoint =<br />
&nbsp;&nbsp;&nbsp;&nbsp; &amp; (h(j) - h(j-1))**2 + (k(j) - k(j-1))**2 + (l(j) -l(j-1))**2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; delta_kpoint_length(j) = sqrt(temp_delta_kpoint)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; total_kpoint_length(j) = total_kpoint_length(j-1) +<br />
&nbsp;&nbsp;&nbsp;&nbsp; &amp; delta_kpoint_length(j)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end if<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; read( 1,'( a130 )' ) READOR<br />
c ----<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if( mod(num_eigen,8) .gt. 0)then<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; read_eigen_line = int(num_eigen / 8) + 1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; read_eigen_line = int(num_eigen / 8)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end if<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; do n = 1, read_eigen_line<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; read( 1, '( 2x, 8(1x,f8.4) )' )<br />
&nbsp;&nbsp;&nbsp;&nbsp; &amp; ( eigenvalue_up((m+(n-1)*8), j), m=1, 8)<br />
c&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; write( 6, '( 2x, 8(1x,f8.4) )' )<br />
c&nbsp;&nbsp;&nbsp;&nbsp; &amp; ( eigenvalue_up((m+(n-1)*8), j), m=1, 8)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end do<br />
c ----<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; read( 1,'( a130 )' ) READOR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if( j .ge. (num_kpoint/spin) ) then<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; goto 6300<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end if<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end do<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; write(6, *) 'SPIN UP OK'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end if<br />
6300 continue<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if( READOR(1:28) .eq. ' ------ SPIN DOWN ----------' ) then<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; spin = 2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; j = 0<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; total_kpoint_length(1) = 0.0<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; read( 1,'( a130 )' ) READOR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; read( 1,'( a130 )' ) READOR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; do<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; j = j + 1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; read( 1,'( 13x, 3f7.4 )' ) h(j), k(j), l(j)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if( j .ge. 2 ) then<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; temp_delta_kpoint =<br />
&nbsp;&nbsp;&nbsp;&nbsp; &amp; (h(j) - h(j-1))**2 + (k(j) - k(j-1))**2 + (l(j) -l(j-1))**2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; delta_kpoint_length(j) = sqrt(temp_delta_kpoint)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; total_kpoint_length(j) = total_kpoint_length(j-1) +<br />
&nbsp;&nbsp;&nbsp;&nbsp; &amp; delta_kpoint_length(j)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end if<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; read( 1,'( a130 )' ) READOR<br />
c ----<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if( mod(num_eigen,8) .gt. 0)then<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; read_eigen_line = int(num_eigen / 8) + 1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; read_eigen_line = int(num_eigen / 8)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end if<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; do n = 1, read_eigen_line<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; read( 1, '( 2x, 8(1x,f8.4) )' )<br />
&nbsp;&nbsp;&nbsp;&nbsp; &amp; ( eigenvalue_down((m+(n-1)*8), j), m=1, 8)<br />
c&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; write( 6, '( 2x, 8(1x,f8.4) )' )<br />
c&nbsp;&nbsp;&nbsp;&nbsp; &amp; ( eigenvalue_down((m+(n-1)*8), j), m=1, 8)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end do<br />
c ----<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; read( 1,'( a130 )' ) READOR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if( j .ge. (num_kpoint/spin) ) then<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; goto 6400<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end if<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end do<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; write(6, *) 'SPIN DOWN OK'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end if<br />
6400 continue<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if( READOR(1:12) .eq. '&nbsp;&nbsp; JOB DONE.' ) then<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; goto 6500<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end if<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; read( 1,'( a130 )' ) READOR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end do<br />
6500 continue<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; close(01)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
c write output data<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
c f05 : band2igor up spin output<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; open(10, file = 'f10' )<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; do i = 1, num_eigen<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; write( 10, '( i6 )' ) i<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; do j = 1, (num_kpoint/spin)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; write( 10, '( 6(1x,f8.4) )' ) h(j),k(j),l(j),<br />
&nbsp;&nbsp;&nbsp;&nbsp; &amp; delta_kpoint_length(j), total_kpoint_length(j),<br />
&nbsp;&nbsp;&nbsp;&nbsp; &amp; eigenvalue_up(i, j)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end do<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end do<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; close(10)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
c f06 : band2igor down spin output<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; open(20, file = 'f20' )<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; do i = 1, num_eigen<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; write( 20, '( i6 )' ) i<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; do j = 1, (num_kpoint/spin)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; write( 20, '( 6(1x,f8.4) )' ) h(j),k(j),l(j),<br />
&nbsp;&nbsp;&nbsp;&nbsp; &amp; delta_kpoint_length(j), total_kpoint_length(j),<br />
&nbsp;&nbsp;&nbsp;&nbsp; &amp; eigenvalue_down(i, j)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end do<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end do<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; close(20)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stop<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end<br />
-------------------------------------------------------------------------------</case.ld1.in></case_dynmat.in></none></atomic></bfgs></vc-relax></relax></none></atomic></vc-md></md></scf></case.ld1.in></crystal></scf>