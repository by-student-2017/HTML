QSTEM (https://lammps.sandia.gov/)<br />
------------------------------------------------------------------------------<br />
■ 各種の解析ソフト [1-3]<br />
<br />
・QSTEM<br />
&nbsp; TEM/STEMの像シミュレーション<br />
&nbsp; https://www.physics.hu-berlin.de/en/sem/software/software_qstem<br />
&nbsp; https://github.com/QSTEM/QSTEM<br />
・PyQSTEM<br />
&nbsp; https://github.com/jacobjma/PyQSTEM<br />
・Dr. Probe<br />
&nbsp; TEM/STEMの像シミュレーション<br />
&nbsp; http://www.er-c.org/barthel/drprobe/<br />
・Prismatic<br />
&nbsp; http://prism-em.com/<br />
・EELSMODEL<br />
&nbsp; http://www.eelsmodel.ua.ac.be/<br />
<br />
・ ReciPro<br />
&nbsp; 電子回折パターンのシミュレーション<br />
&nbsp; http://pmsl.planet.sci.kobe-u.ac.jp/~seto/?page_id=19&amp;lang=ja<br />
・ EDA<br />
&nbsp; 電子回折パターンのシミュレーション<br />
&nbsp; http://www-gbs.eps.s.u-tokyo.ac.jp/kogure/EDANA/EDA/EDANA_E.htm<br />
<br />
・ VESTA<br />
&nbsp; 結晶構造のモデリングと可視化<br />
&nbsp; http://jp-minerals.org/vesta/jp/<br />
・ ImageJ (Win, Linux, Mac)<br />
&nbsp; NIHが公開している画像と解析ソフト。DMファイルも扱える<br />
・ GMS (Gatan Microscopy Suite) (Win)<br />
&nbsp; Free-offline版<br />
<br />
[1] 便利なフリーウェア<br />
&nbsp; https://aem-www.imr.tohoku.ac.jp/便利なフリーウェア/<br />
[2] Advanced Data Processing and Simulations<br />
&nbsp; https://www.superstem.org/learn/resources<br />
[3] Electron Microscopy Software<br />
&nbsp; http://jiam.utk.edu/facilities/microscopy/software.php<br />
------------------------------------------------------------------------------<br />
■ QSTEM (Windows 10 (64 bit))<br />
(https://www.physics.hu-berlin.de/en/sem/software/qstem-download)<br />
<br />
□ Install<br />
・Matlab Component Runtime Library<br />
0. MCRInstaller.exe<br />
・qstem2.51_Win64_setup.exe)<br />
1. qstem2.51_Win64_setup.exe<br />
2. All [Next&gt;]<br />
3. [check] Create a destop icon<br />
4. [Next&gt;]<br />
5. [Install]<br />
6. [Finish]<br />
s<br />
□ Examples and script<br />
・Examples.zip<br />
1. Examples.zip を解凍<br />
2. [click] *.cfg or *.qsc<br />
・Scripts.zip<br />
<br />
□ 原子配置の読み取りで問題が発生した場合<br />
・MSVCR100.dll<br />
※ このファイルをsystem32に置く<br />
------------------------------------------------------------------------------<br />
■ QSTEM (Ubuntu 18.04 LTS (64 bit))<br />
(https://www.physics.hu-berlin.de/en/sem/software/qstem-download)<br />
<br />
□ Install<br />
(https://github.com/QSTEM/QSTEM)<br />
0. sudo apt-get install libboost-all-dev<br />
1. git clone https://github.com/QSTEM/QSTEM.git<br />
2. cd QSTEM<br />
3. cmake .<br />
4. make<br />
<br />
□ [&lsquo;cin&rsquo; is not a member of &lsquo;std&rsquo;] case<br />
3.1. sed -i &#39;1s/^/#include &lt;iostream&gt;\n/&#39; $HOME/QSTEM/stem3/stem3.cpp<br />
3.2. make clean<br />
[1] QSTEM ? Problems building from source<br />
&nbsp; https://groups.google.com/forum/#!topic/qstem/h9INEuvjNLY<br />
<br />
□ Test<br />
1. ~/QSTEM/test_bin/test_libs<br />
<br />
□ Usage (underconstructing)<br />
1. ~/QSTEM/bin/stem3 tem_gb_Sigma17_4.qsc<br />
&nbsp; (~/QSTEM/bin/stem3 tem_gb_Sigma17_4.qsc &gt; qstem.log)<br />
2. ./gb_Sigma17<br />
3. (you can get image data) wave.img<br />
------------------------------------------------------------------------------<br />
■ *.cif &gt; *.cfg<br />
<br />
1. VESTA<br />
&nbsp; File &gt; Open... &gt; *.cif (※ *は好きなファイル名)<br />
&nbsp; File &gt; Export Data... &gt; *.xtl<br />
2. shift + right click &gt; Powercellウインドウをここに開く<br />
3. Convert2CFG<br />
&nbsp; *.xtl &gt; 開く &gt; OK &gt; *.cfg<br />
<br />
[1] How to convert crystal structure files to the CFG format&nbsp;<br />
&nbsp; https://www.physics.hu-berlin.de/en/sem/software/software_convert_cfg<br />
------------------------------------------------------------------------------<br />
■ Usage<br />
<br />
◇ TEM image<br />
1. Load Model &gt; *.cfg<br />
&nbsp; (※ *は好きなファイル名)<br />
2. Unit cells: Nx:1 Ny:1 Nz:2 &gt; Update View<br />
&nbsp; (&gt; 3D)<br />
&nbsp; (&gt; Model Properties &gt; Show: [Avg. Z number] &gt; Update View &gt; x (close))<br />
3. Simulation mode<br />
&nbsp; STEM &gt; TEM<br />
4. Slicing<br />
&nbsp; Number of slices per sub-slab: 3<br />
&nbsp; (※ Slice thickness: 2 - 5 Aとなるように[Number of slices per sub-slab]の値を調整する)<br />
5. Save config<br />
&nbsp; turn TDS off &gt; *.qsc<br />
&nbsp; (TDS runs: [uncheck] TDS)<br />
&nbsp; (STEM case recommend [check] TDS)<br />
6. Start Simulation &gt; *.qsc &gt; Open<br />
7. Simulate images from wave function<br />
&nbsp; wave.img<br />
&nbsp; or<br />
&nbsp; wave_X.img (X: number of slice (thickness))<br />
&nbsp; or<br />
&nbsp; wave_YY_X.img<br />
8. change [Defocus, Cs, etc]<br />
&nbsp; (e.g. JEM-2100 (200 kV, LaB6, High Resolution))<br />
&nbsp; Acc. Voltage: 200 kV<br />
&nbsp; Cs: 1.0 mm<br />
&nbsp; Focal Spread: 3 nm<br />
&nbsp; Conv. Angle: 20 mrad<br />
&nbsp; Vibration: 2 pm<br />
&nbsp; Defocus: この値を幾つか変える<br />
&nbsp; ※ シェルツァーフォーカスの値が知りたい場合は(click) [Scherzer] (Csの値に連動して変わる）<br />
9. Save Img (on the bottom right) &gt; *_tem.img<br />
10. Display Results<br />
&nbsp; *_tem.img<br />
11. Replicate: 2 x 2<br />
<br />
◇ Examples (TEM mode, interface of SrTiO3 )<br />
1. qstem &gt; Load Config &gt; tem_gb_Sigma17_4.qsc<br />
&nbsp; (gb_Sigma17.cfg)<br />
2. Start Simulation &gt; tem_gb_Sigma17_4.qsc<br />
3. Simulate images from wave function &gt; wave.img<br />
&nbsp; Microscope parameters にまずは合わせてみる<br />
&nbsp; 200 kV<br />
&nbsp; Cs: 1.0 nm (=C3)<br />
&nbsp; (click) [Scherzer) &gt; Defocus:&nbsp;<br />
&nbsp; Conv. Angl: 0.1 mrad (=Convergence angle:)<br />
4. Save Img &gt; test.img<br />
5. Display Results<br />
<br />
◇ qstem FAQsには固溶体（占有率が100%でない場合）の計算方法についても記述されている<br />
&nbsp; https://www.physics.hu-berlin.de/en/sem/software/qstem-documentation<br />
&nbsp; Examples file (SrTiO3_charged.cfg)<br />
<br />
※ Microscope parameters (tem_gb_Sigma17_4.qsc)<br />
&nbsp; High voltage: 200 [kV]<br />
&nbsp; Spherical Aberr. C3(=Cs): Speherical abberation in mm<br />
&nbsp; C5: C_5 abberation in mm (Usually, 0)<br />
&nbsp; Cc: Chromatic abberation in mm<br />
&nbsp; Convergence angle (=alpha): Illumination angle in mrad<br />
&nbsp; dE: energy spread in eV (FWHM)<br />
&nbsp; &nbsp; LaB6熱電子放出型電子銃: 1 - 2 eV程度<br />
&nbsp; &nbsp; ショットキー型電界放射電子銃(Schottky-FEG): 0.60 - 0.70 eV程度<br />
&nbsp; &nbsp; 冷陰極型電界放射電子銃(Cold-FEG): 0.30 - 0.35 eV程度<br />
&nbsp; &nbsp; (https://www.toray-research.co.jp/technical-info/analysis/form/for_007.html)<br />
&nbsp; Source Size (diameter): % source size in A (Usually, 0)<br />
&nbsp; &nbsp; source sizeはtutorialに[Display Results]で変更できると書かれているので0でよいと思われる<br />
&nbsp; &nbsp; LaB6熱電子放出型電子銃: 1 nm程度 (10 A)<br />
&nbsp; &nbsp; 電界放出型電子銃: 0.2 nm程度 (2 A)<br />
&nbsp; &nbsp; 球面収差補正装置: &lt; 0.1 nm (1 A)<br />
&nbsp; beam current: beam current in pA (default: 1)<br />
&nbsp; &nbsp; LaB6熱電子放出型電子銃: 0.05 &times; 10^8 A/cm2.sr<br />
&nbsp; &nbsp; ショットキー型電界放射電子銃(Schottky-FEG): 4 &times; 10^8 A/cm2.sr<br />
&nbsp; &nbsp; 冷陰極型電界放射電子銃(Cold-FEG): 10 &times; 10^8 A/cm2.sr<br />
&nbsp; dwell time: dwell time in msec (default: 1)<br />
<br />
※ Microscope parameters<br />
&nbsp; JEM-2100 (200 kV, LaB6, High Resolution)<br />
&nbsp; &nbsp; High voltage: 200 [kV]<br />
&nbsp; &nbsp; Scherzer: -60.1 [nm]<br />
&nbsp; &nbsp; 球面収差係数 Cs(=Spherical Aberr. C3): 1.0 [mm]<br />
&nbsp; &nbsp; 色収差 Cc: 1.4 [nm]<br />
&nbsp; &nbsp; Convergence angle: 1.5 - 20 [mrad]<br />
&nbsp; &nbsp; Brightness(A/cm2sr) 0.05 [x10^8]<br />
&nbsp; &nbsp; Dwell time: 1 or 0.5 s (1000 ms or 500 ms)<br />
&nbsp; qstem V2.50の初期設定（2019年5月21日時点）に近い。<br />
&nbsp; 可能な限り装置マニュアルなどを見て使用している測定の条件に近づけてください。<br />
<br />
※ Microscope parameters (Dr. Probe)<br />
&nbsp; Gatan UltraScan 1000 with 2k x 2k pixels for 300 keV electrons<br />
&nbsp; &nbsp; High voltage: 300 [kV]<br />
&nbsp; &nbsp; 1.0 &nbsp;! [mrad] illumination cone half-angle (Convergence angle: 1.0 [mrad])<br />
&nbsp; &nbsp; 0.0 &nbsp;! [mrad] inner detection angle&nbsp;<br />
&nbsp; &nbsp; 20.0 ! [mrad] outer detection angle<br />
&nbsp; &nbsp; 0.05 ! [nm] geometrical source size (HWHM)&nbsp;<br />
&nbsp; &nbsp; 3.00 ! [nm] focus spread<br />
&nbsp; &nbsp; 2.0 &nbsp;! relative focus spread kernel width<br />
&nbsp; &nbsp; 7 &nbsp; &nbsp;! focus spread kernel samples<br />
&nbsp; &nbsp; -----<br />
&nbsp; &nbsp; 1, 3.5 ! [switch, nm] focus-spread<br />
&nbsp; &nbsp; 1, 0.5 ! [switch, mrad] semi-convergence<br />
&nbsp; &nbsp; 1, 0.02, 0.02, 0. ! [model, nm, nm, deg] vibration envelope &nbsp;<br />
&nbsp; &nbsp; 1, 4.2, 0. ! [ID, nm, nm] aberration coefficients ID=1: C1<br />
&nbsp; &nbsp; 5, -15000., 0. ! [ID, nm, nm] aberration coefficients ID=5: C3<br />
&nbsp; &nbsp; 250. ! [mrad] image objective aperture<br />
&nbsp; &nbsp; 0., 0. ! [mrad] image objective aperture center&nbsp;<br />
<br />
※ 5次球面収差 (fifth-order spherical aberration)<br />
&nbsp; 幸いなことに、二段6極子とそれらを繋ぐ転送レンズを備えた3次の球面収差補正装置を用いると、C5の値を可変にすることができるので、C5 = 0にすることができる。(https://www.jeol.co.jp/words/emterms/search_result.html?keyword=spherical%20aberration)※ Aberration-Corrected Imaging in Transmission Electron Microscopy: An Introduction Second Edition, p334<br />
&nbsp; Cn (https://books.google.co.jp/books?id=Gsw7DQAAQBAJ&amp;pg=PA338#v=onepage&amp;q&amp;f=false)<br />
※ JEM-2100FはField emission型なのでディフォルトの5 [x10^8]でよい<br />
&nbsp; Handbook of Advanced Ceramics: Materials, Applications, Processing, and Properties<br />
※ (linux) QSTEM/stem3/debug_data<br />
※ (win) Examples<br />
※ Modelの軸の単位はÅ<br />
<br />
※ defocusとthicknessを変えたimageを並べて実験結果と比較してみたりする。Amorph: や Forcal spread, Vibration も実験の像に近くなるように変えてみるのもよい勉強になる<br />
※ TDSをonにすると原子を動かした像を計算する。原子を動かしたくない場合はTDS offにする。最初はTDSをoffにして（チェックを外して）計算してみるのもよい。STEMの定量シミュレーションの場合はTDS onが求められる<br />
※ Nzを変えて計算する厚みを変える。試料の厚さが例えば数10nm以上になれば、多重散乱が起こり、散乱波の位相は運動学的理論での位相からずれてくる<br />
※ Dr. Probeだと0.005 nm/pixelにしているので 0.05 Å程度となるように1024 x 1024 pixelsにしてみるのもよいだろう<br />
※ Examples を見てみると、TEMやCBEDではdetectorの設定はしなくてよいようである<br />
※ カーボンや有機材料はノックオンダメージの回避のために加速電圧80 kV程度が用いられる (https://www.toray-research.co.jp/technical-info/analysis/form/for_007.html)<br />
------------------------------------------------------------------------------<br />
■ QSTEM Tutorial<br />
<br />
[1] QSTEM Tutorial on Simulating(HA)ADF/BF-STEM images<br />
&nbsp; https://www.physics.hu-berlin.de/en/sem/software/files/qstem_tutorial.pdf<br />
[2] Enter TEM parameters<br />
&nbsp; https://www.physics.hu-berlin.de/en/sem/software/files/dudeck09_imagesim_tutorial.pdf<br />
[3] Introduction to the Theory of Image Simulation in TEM&nbsp;<br />
&nbsp; https://www.physics.hu-berlin.de/en/sem/software/files/koch12_emc2012_imagesimulation_theory.pdf<br />
[4] Documentation<br />
&nbsp; https://www.physics.hu-berlin.de/en/sem/software/qstem-documentation<br />
[5] Quantitative Scanning Transmission Electron Microscopy<br />
&nbsp; https://www.mrl.ucsb.edu/~stemmer/main_pdfs/STEM%20Tutorial.pdf<br />
[6] QSTEM online user Manual<br />
&nbsp; https://nanohub.org/resources/21480/download/QSTEM_online_user_Manual.pdf<br />
------------------------------------------------------------------------------<br />
■ tips<br />
<br />
◇ Output (on the bottom right side)<br />
・Slices between outputs<br />
&nbsp; [Thickness (in wave_XX_0.img)] = [Slice thickness (on Slicing)] * [Slices between qoutputs: (on Output)]<br />
&nbsp; [Thickness (in wave_XX_1.img)] = [Thickness (in wave_XX_0.img)] * 2<br />
&nbsp; [Thickness (in wave_XX_2.img)] = [Thickness (in wave_XX_0.img)] * 3<br />
・Folder: [folder name]<br />
<br />
◇ Sample tilt<br />
1. Ncells &gt; Sample tilt: X: 5, Y: 5, Z: 0 [deg] &gt; Update View&nbsp;<br />
2. Box &gt; Update View<br />
<br />
◇ TDS<br />
&nbsp; TDS runs = avgRuns<br />
&nbsp; wave_[number of TDS runs - 1]_[number of slice (thickness)].img<br />
&nbsp; Keep TDS on = TDS runs: [check] TDS (on Microscope paramters)<br />
&nbsp; Turn TDS off = TDS runs: [uncheck] TDS (on Microscope paramters)<br />
<br />
◇ *.cfg (solid solution, e.g. Sr0.7Ca0.3TiO3)<br />
----------<br />
Number of particles = 6 &nbsp; &nbsp;# Number of atoms per unit cell<br />
A = 1.0 Angstrom &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Length unit of unit cell basis vectors<br />
H0(1,1) = 3.905 A &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# X-component of first lattice vector (e.g. &lsquo;a&rsquo;)<br />
H0(1,2) = 0 A &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Y-component of first lattice vector<br />
H0(1,3) = 0 A &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Z-component of first lattice vector<br />
H0(2,1) = 0 A &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# X-component of second lattice vector<br />
H0(2,2) = 3.905 A &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Y-component of second lattice vector<br />
H0(2,3) = 0 A &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Z-component of second lattice vector<br />
H0(3,1) = 0 A &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# X-component of third lattice vector<br />
H0(3,2) = 0 A &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Y-component of third lattice vector<br />
H0(3,3) = 3.905 A &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Z-component of third lattice vector<br />
.NO_VELOCITY. &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Keep this line if you do not want to do MD with this config.<br />
entry_count = 6 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Set this to 3 if you only define coordinates, 4, if you include the Debye-Waller factor, 5, if you include occupancy, or 6 if you also include the ionic charge.<br />
76 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # atomic weight of first atom species<br />
Sr &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Chemical symbol of first atom species<br />
0 0 0 0.6214 0.7 2.0 &nbsp; &nbsp; &nbsp; # x y z (fract. coordinates) DW-factor occupancy charge<br />
40 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # atomic weight of first atom species<br />
Ca &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Chemical symbol of first atom species<br />
0 0 0 0.5000 0.3 2.0 &nbsp; &nbsp; &nbsp; # x y z (fract. coordinates) DW-factor occupancy charge<br />
44 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # atomic weight of second atom species<br />
Ti &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Chemical symbol of second atom species<br />
0.5 0.5 0.5 0.4390 1.0 4.0 # x y z DW-factor occupancy charge<br />
16<br />
O<br />
0 0.5 0.5 0.7323 1.0 -2.0 &nbsp;# x y z DW-factor occupancy charge of the 5th atom (oxygen)<br />
0.5 0 0.5 0.7323 1.0 -2.0 &nbsp;<br />
0.5 0.5 0 0.7323 1.0 -2.0 &nbsp;<br />
----------<br />
※ DW-factor<br />
&nbsp; DW-factor: B=8*pi^2*&lt;u^2&gt; (on *.cfg file)<br />
&nbsp; (Note: the exact definition: DWf=exp(-B*s^2))<br />
&nbsp; s: the scattering angle<br />
&nbsp; &lt;u^2&gt;: the mean of the squared displacements<br />
&nbsp; B_element = B_Si * m_Si/m_element, where m_Si = 28 and B_Si = 0.45.&nbsp;<br />
&nbsp; B_element = 0.45 * 28 / m_element = 12.6 / m_element<br />
&nbsp; QSTEM default setting: B = 0.5 (for all other elements, except Si, Au, Cu and C) , see &quot;stemutil.cpp&quot;<br />
※ Specifying the ionic charge only makes some sense for TEM simulations and should have no effect on HAADF-STEM images<br />
※ other example<br />
&nbsp; Examples\SrTiO3_charged.cfg<br />
※ *.cif &gt; VESTA &gt; *.xtl &gt; Convert2CFG &gt; *.cfg &gt; change [Number of particles, entry_count = 5 (or 6), occupancy] &gt; add [atomic weight, Chemical symbol, x y z (fract. coordinates) DW-factor occupancy (or charge))]<br />
<br />
◇ stemutil.cpp<br />
-----<br />
&nbsp; &nbsp; &nbsp; * We also need the Debye-Waller factor B=8*pi^2*avg(u^2), which is<br />
&nbsp; &nbsp; &nbsp; * expected to be stored in the last parameter in fparams<br />
&nbsp; &nbsp; &nbsp; * ReadFeTable will assign a default value of 0.5 as the Debye-Waller<br />
&nbsp; &nbsp; &nbsp; * factor, but one may want to change that by setting this last parameter&nbsp;<br />
&nbsp; &nbsp; &nbsp; * manally before running this routine.<br />
-----<br />
&nbsp; &nbsp;if (scatFlag == WEICK_KOHL) {<br />
&nbsp; &nbsp; &nbsp;printf(&quot;Reading Weickenmeier &amp; Kohl parameters from %s\n&quot;,fileName);<br />
&nbsp; &nbsp; &nbsp;na = 2*( nl + ng );&nbsp;&nbsp; &nbsp;/* number of params to fit */<br />
&nbsp; &nbsp; &nbsp;fparams = double2D( NZMAX+1, na+1, &quot;fparams&quot; );<br />
&nbsp; &nbsp; &nbsp;n = 0;<br />
&nbsp; &nbsp; &nbsp;<br />
&nbsp; &nbsp; &nbsp;for( zi=NZMIN; zi&lt;=NZMAX; zi++) {<br />
&nbsp; &nbsp; &nbsp; &nbsp;<br />
&nbsp; &nbsp; &nbsp; &nbsp;/* define some (random) debye waller factors */<br />
&nbsp; &nbsp; &nbsp; &nbsp;if (zi == 14)<br />
&nbsp;&nbsp; &nbsp; fparams[zi][na] = 0.45; /* &nbsp;for Si */<br />
&nbsp; &nbsp; &nbsp; &nbsp;else if (zi == 79)<br />
&nbsp;&nbsp; &nbsp; fparams[zi][na] = 0.186; &nbsp;/* for Au */<br />
&nbsp; &nbsp; &nbsp; &nbsp;else if (zi == 29)<br />
&nbsp;&nbsp; &nbsp; fparams[zi][na] = 0.21; &nbsp;/* for Cu (liquid N2) */<br />
&nbsp; &nbsp; &nbsp; &nbsp;else<br />
&nbsp;&nbsp; &nbsp; fparams[zi][na] = 0.5; &nbsp;/* for all other elements */<br />
-----<br />
&nbsp; &nbsp;else { &nbsp;/* DOYLE_TURNER */<br />
&nbsp; &nbsp; &nbsp;printf(&quot;Reading Doyle &amp; Turner parameters from %s\n&quot;,fileName);<br />
&nbsp; &nbsp; &nbsp;fparams = double2D( NZMAX+1, NPDTMAX+1, &quot;fparams&quot; );<br />
&nbsp; &nbsp; &nbsp;n = 0;<br />
&nbsp; &nbsp; &nbsp;for( zi=NZMIN; zi&lt;=NZMAX; zi++) {<br />
&nbsp; &nbsp; &nbsp; &nbsp;/* define some (random) debye waller factors */<br />
&nbsp; &nbsp; &nbsp; &nbsp;if (zi == 14)<br />
&nbsp;&nbsp; &nbsp; fparams[zi][NPDTMAX] = 0.45; /* &nbsp;for Si */<br />
&nbsp; &nbsp; &nbsp; &nbsp;else if (zi == 79)<br />
&nbsp;&nbsp; &nbsp; fparams[zi][NPDTMAX] = 0.186; &nbsp;/* for Au */<br />
&nbsp; &nbsp; &nbsp; &nbsp;else if (zi == 6)<br />
&nbsp;&nbsp; &nbsp; fparams[zi][NPDTMAX] = 0.4; &nbsp;/* for C */<br />
&nbsp; &nbsp; &nbsp; &nbsp;else<br />
&nbsp;&nbsp; &nbsp; fparams[zi][NPDTMAX] = 0.5; &nbsp;/* for all other elements */<br />
&nbsp; &nbsp; &nbsp; &nbsp;/* &nbsp; &nbsp; printf(&quot;Using Debye-Waller Factor DW=%f for Z=%d\n&quot;,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;fparams[zi][NPDTMAX],zi);<br />
&nbsp; &nbsp; &nbsp; &nbsp;*/<br />
-----<br />
------------------------------------------------------------------------------<br />
■ References<br />
<br />
[1] QSTEM Tutorial on Simulating(HA)ADF/BF-STEM images<br />
&nbsp; https://www.physics.hu-berlin.de/en/sem/software/files/qstem_tutorial.pdf<br />
[2] Enter TEM parameters<br />
&nbsp; https://www.physics.hu-berlin.de/en/sem/software/files/dudeck09_imagesim_tutorial.pdf<br />
[3] Documentation<br />
&nbsp; https://www.physics.hu-berlin.de/en/sem/software/qstem-documentation<br />
[4] Quantitative Scanning Transmission Electron Microscopy<br />
&nbsp; https://www.mrl.ucsb.edu/~stemmer/main_pdfs/STEM%20Tutorial.pdf<br />
[5] QSTEM online user Manual<br />
&nbsp; https://nanohub.org/resources/21480/download/QSTEM_online_user_Manual.pdf<br />
[6] 電子顕微鏡解析&nbsp;<br />
&nbsp; https://www.r-ccs.riken.jp/r-ccssite/wp-content/uploads/2018/06/8ce9efad77134c7f18a338b8c7b36e66.pdf<br />
[7] Scanning Transmission Electron Microscopy in Materials Sciences<br />
&nbsp; http://berlinem.org/wp-content/uploads/2017/09/Werner_Autumn-School-2017.pdf<br />
[8] TEM and STEM<br />
&nbsp; https://groups.google.com/forum/#!topic/qstem/f83x88-KHp0<br />
&nbsp; The STEM images are all called detector#1_#2.img, where the first number is the number of the detector as you have defined it, and the second number is the thickness (the highest number refers to the full specimen thickness). &nbsp;The files mulswav_#1_#2.img are the wave functions that correspond to each of the probe positions for the last TDS run that you have done. &nbsp;Depending on your save level you may also find the TDS-averaded diffraction patterns in that folde. &nbsp;These are best displayed on a log scale, while a linear scale should be selected for images and wave functions.<br />
&nbsp; The TEM simulation does not really produce an image, what what you are expected to use are the wave functions. &nbsp;From those you can then compute different images using the button &lsquo;Simulate images from wave&rsquo; in qstem, or by running the program imageSim.<br />
&nbsp; The wave functions produced in TEM mode should be called wave_#1.img, or wave_#1_#2.img, in case you did not turn off TDS. &nbsp;<br />
[9] Electron Microscopy School, Belgrade, April 2011&nbsp;<br />
&nbsp; http://www.nanotechftm.tmf.bg.ac.rs/images/stories/dokumenti/lecture_book_em_school/saso%20sturm.pdf<br />
------------------------------------------------------------------------------<br />
■ Appendix<br />
<br />
□ PyQSTEM (Ubuntu 18.04 LST (64 bit))<br />
(https://github.com/jacobjma/PyQSTEM)<br />
<br />
◇ Install<br />
1. sudo apt-get install libfftw3-dev libfftw3-single3<br />
&nbsp; sudo apt install python-pip<br />
&nbsp; pip install numpy scipy matplotlib ase<br />
&nbsp; pip install cython jupyter scikit-image<br />
2. git clone https://github.com/jacobjma/PyQSTEM.git<br />
&nbsp; cd PyQSTEM<br />
&nbsp; sudo python setup.py install<br />
<br />
◇ Usage<br />
&nbsp; import qstem<br />
[1] PyQSTEM<br />
&nbsp; https://pyqstem.readthedocs.io/en/latest/readme.html<br />
------------------------------------------------------------------------------<br />
■ QSTEM (ubuntu 18.04 LTS (64 bit))<br />
<br />
□ Matlab runtime<br />
(https://jp.mathworks.com/products/compiler/matlab-runtime.html)<br />
・R2019a (9.6) 64-bit (Linux)<br />
&nbsp; MATLAB_Runtime_R2019a_Update_1_glnxa64.zip<br />
1. mkdir matlab_runtime<br />
2. cd matlab_runtime<br />
3. unzip MATLAB_Runtime_R2019a_Update_1_glnxa64.zip<br />
4. sudo ./install<br />
5. All [Next&gt;] and [yes]<br />
6. [Next&gt;]<br />
7. [Finish]<br />
[1] https://jp.mathworks.com/help/compiler/install-the-matlab-runtime.html<br />
[2] https://groups.google.com/forum/#!topic/qstem/bDYeypq_AeI<br />
&nbsp; For this you simply need to change the line 22 in file readCFG_qstem from &ldquo;if (1)&rdquo; to &ldquo;if(0)&rdquo;.<br />
<br />
◇ qstem (gui) (failed)<br />
1. tar zxvf qstem.tar.gz<br />
2. cd for_redistribution_files_only<br />
3. export PATH=$PATH:$HOME/QSTEM/bin<br />
4. ./run_qstem.sh /usr/local/MATLAB/MATLAB_Runtime/v96<br />
<br />
◇ Matlab<br />
・matlab_R2019a_glnxa64.zip<br />
1. mkdir matlab_R2019a<br />
2. cd matlab_R2019a<br />
3. unzip matlab_R2019a_glnxa64.zip<br />
4. sudo ./install<br />
5. [check] Create symbolic links to MATLAB scripts in:<br />
&nbsp; /usr/local/bin<br />
6. [Next&gt;]<br />
<br />
◇ qstem (compiling by matlab) (failed)<br />
0. cd $HOME/QSTEM/GUI_Matlab<br />
&nbsp; gedit qstem.m<br />
&nbsp; ----before (636 Line)<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case {&#39;PCWIN&#39;,&#39;PCWIN64&#39;}<br />
&nbsp; ----after<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case {&#39;PCWIN&#39;,&#39;PCWIN64&#39;,&#39;GLNXA64&#39;}<br />
&nbsp; ----<br />
1. matlab<br />
2. mcc -e qstem.m<br />
※ mcc -m qstem.mでも可能<br />
&nbsp; qstem, run_qstem.shなどが得られる<br />
<br />
□ Qt (failed)<br />
0. sudo apt-get install python3-pyside<br />
&nbsp; sudo apt install pyside-tools<br />
1. cd GUI_Qt<br />
2. qmake -project<br />
&nbsp; (*.pro)<br />
3. qmake<br />
&nbsp; (Makefile)<br />
4. make<br />
※ LINK = g++ -nostartfiles (failed)<br />
※ pyside-uic ui_tester.py -o ui_tester.ui (failed)<br />
&nbsp; pyside-uic uiFuncs.py -o uiFuncs.ui (failed)<br />
------------------------------------------------------------------------------<br />
■ SrCoO2.5<br />
(cif: https://materials.springer.com/isp/crystallographic/docs/sd_1627093)<br />
<br />
300 kV, Cs=C3=0<br />
Nz:18 &nbsp;(t = about 10 nm), sub-slab: 40<br />
Nz:55 &nbsp;(t = about 30 nm), sub-slab: 120<br />
Nz:92 &nbsp;(t = about 50 nm), sub-slab: 200<br />
Nz:129 (t = about 70 nm), sub-slab: 280<br />
Nz:165 (t = about 90 nm), sub-slab: 360<br />
<br />
300 kV, Cs=C3=0<br />
Nz:165 (t = about 90 nm), sub-slab: 360<br />
&nbsp; 3, 11, 19, 27, 35 sliceでの結果と上記は像がやはり異なるようだ。<br />
<br />
[1] Scanning Transmission Electron Microscopy in Materials Sciences<br />
&nbsp; http://berlinem.org/wp-content/uploads/2017/09/Werner_Autumn-School-2017.pdf<br />
&nbsp; P.9のHREM(TEM Image)と比較してみたが、完全には一致しないが、変化の傾向は一致する。ただし、&Delta;f=0 nmのみ。その他は像のコントラストがほとんど表示されない。<br />
------------------------------------------------------------------------------<br />
■ QSTEM (Ubuntu 18.04 LTS (64 bit))<br />
<br />
□ Usage<br />
1. ~/QSTEM/bin/stem3 tem_gb_Sigma17_4.qsc<br />
&nbsp; (~/QSTEM/bin/stem3 tem_gb_Sigma17_4.qsc &gt; qstem.log)<br />
2. ./gb_Sigma17<br />
3. (you can get image data) wave.img<br />
<br />
※ Example data (from windows)<br />
1. cd ~/QSTEM<br />
2. cp -r /mnt/c/Users/*/AppData/Local/qstem/Examples ./<br />
3. sed -i &#39;s/\r//g&#39; *<br />
&nbsp; (sudo apt install nkf)<br />
&nbsp; (nkf -Lu --in-place *)<br />
<br />
□ read gb_Sigma17_Proj.img<br />
0. pip install numpy<br />
&nbsp; pip install pillow<br />
1. cp gb_Sigma17_Proj.img &nbsp;test.img<br />
2. gedit read.py<br />
-----<br />
from PIL import Image<br />
import numpy as np<br />
import struct<br />
#import matplotlib.pyplot as plt<br />
<br />
fid = open(&quot;test.img&quot;,&quot;rb&quot;)<br />
<br />
# int data<br />
header_size = struct.unpack(&quot;i&quot;,fid.read(4))<br />
print &quot;header size: &quot;, header_size[0]<br />
<br />
paramSize = struct.unpack(&quot;i&quot;,fid.read(4))<br />
print &quot;parameter size: &quot;, paramSize[0]<br />
<br />
commentSize = struct.unpack(&quot;i&quot;,fid.read(4))<br />
print &quot;comment size: &quot;, commentSize[0]<br />
<br />
Nx = struct.unpack(&quot;i&quot;,fid.read(4))<br />
print &quot;Nx: number of pixels in x-direction, &quot;, Nx[0]<br />
<br />
Ny = struct.unpack(&quot;i&quot;,fid.read(4))<br />
print &quot;Ny: number of pixels in y-direction, &quot;, Ny[0]<br />
<br />
complexFlag = struct.unpack(&quot;i&quot;,fid.read(4))<br />
print &quot;Flag: complex(1) or real(0): &quot;, complexFlag[0]<br />
<br />
dataSize = struct.unpack(&quot;i&quot;,fid.read(4))<br />
print &quot;Data size (byte unit): &quot;, dataSize[0]<br />
<br />
version = struct.unpack(&quot;i&quot;,fid.read(4))<br />
print &quot;version: &quot;,version[0]<br />
<br />
# double data<br />
<br />
t = struct.unpack(&quot;d&quot;,fid.read(8))<br />
print &quot;sample thickness or defocus: &quot;, t[0]<br />
<br />
dx = struct.unpack(&quot;d&quot;,fid.read(8))<br />
print &quot;dx: pixel size along x-direction, &quot;, dx[0], &quot; [Angstrom]&quot;<br />
<br />
dy = struct.unpack(&quot;d&quot;,fid.read(8))<br />
print &quot;dy: pixel size along y-direction, &quot;, dy[0], &quot; [Angstrom]&quot;<br />
<br />
# other data<br />
<br />
for i in range(0,paramSize[0]):<br />
&nbsp; auxilliary_data = struct.unpack(&quot;d&quot;,fid.read(8))<br />
&nbsp; print auxilliary_data[0]<br />
<br />
comment = []<br />
for i in xrange(0,commentSize[0]):<br />
&nbsp; comment.append(struct.unpack(&quot;c&quot;,fid.read(1))[0])<br />
print &quot;comment&quot;<br />
print comment<br />
<br />
# image data<br />
<br />
fod = open(&quot;test.raw&quot;,&quot;wb&quot;)<br />
<br />
actual_data = [[0 for i in range(Nx[0])] for j in range(Ny[0])]<br />
for i in xrange(0,Nx[0]):<br />
&nbsp; for j in xrange(0,Ny[0]):<br />
&nbsp; &nbsp; actual_data[i][j] = struct.unpack(&quot;f&quot;,fid.read(dataSize[0]))[0]<br />
&nbsp; &nbsp; #<br />
&nbsp; &nbsp; #data = fid.read(dataSize[0])<br />
&nbsp; &nbsp; #fod.write(data)<br />
<br />
data = np.array(actual_data,dtype=&quot;float32&quot;)<br />
#print data.dtype<br />
#print data.ndim<br />
#print data.shape<br />
<br />
#-----matplotlib-----<br />
#plt.imshow(data)<br />
#plt.show()<br />
<br />
#-----PIL-----<br />
new_data = (((data - np.min(data)) / (np.max(data) - np.min(data))) * 255).astype(np.uint8)<br />
pil_img = Image.fromarray(new_data)<br />
pil_img.show()<br />
#new_pil_img = pil_img.convert(&quot;L&quot;)<br />
#new_pil_img.show()<br />
#new_pil_img.save(&quot;test.png&quot;)<br />
<br />
fid.close()<br />
fod.close()<br />
-----<br />
3. sed -i &#39;s/\r//g&#39; read.py<br />
&nbsp; (sudo apt install nkf)<br />
&nbsp; (nkf -Lu --in-place read.py)<br />
4. chmod +x read.py<br />
5. python read.py<br />
(※ od wave.img | more)<br />
------------------------------------------------------------------------------<br />
■ PyQSTEM (Ubuntu 18.04 LTS (64 bit))<br />
(https://github.com/jacobjma/PyQSTEM)<br />
<br />
□ Install<br />
(https://github.com/QSTEM/QSTEM)<br />
0. sudo apt-get install libfftw3-dev libfftw3-single3<br />
&nbsp; pip install numpy scipy matplotlib ase --user<br />
&nbsp; pip install cython jupyter scikit-image --user<br />
1. git clone https://github.com/jacobjma/PyQSTEM.git<br />
&nbsp; cd PyQSTEM<br />
&nbsp; sudo python setup.py install<br />
<br />
□ Test<br />
1. cd ~/PyQSTEM/test<br />
2. python test_tem.py<br />
<br />
□ examples<br />
------------------------------------------------------------------------------