potfit (https://www.potfit.net/wiki/doku.php)<br />
------------------------------------------------------------------------------<br />
■ potfit (need &quot;intel MKL&quot;) (ubuntu 18.04 LTS (64 bit) (on Windows 10 (64 bit)))<br />
(https://www.potfit.net/wiki/doku.php)<br />
<br />
◇ run_isolated_atom<br />
1. gedit run_isolated_atom<br />
-----<br />
#! /bin/csh -f<br />
<br />
echo -n &quot;&quot; &gt; energy_data_for_isolated_atom<br />
<br />
set element_list = (H He Li Be B C N O F Ne Na Mg Al Si P S Cl Ar K Ca Sc Ti V Cr Mn Fe Co Ni Cu Zn Ga Ge As Se Br Kr Rb Sr Y Zr Nb Mo Tc Ru Rh Pd Ag Cd In Sn Sb Te I Xe Cs Ba La Ce Pr Nd Pm Sm Eu Gd Tb Dy Ho Er Tm Yb Lu Hf Ta W Re Os Ir Pt Au Hg Tl Pb Bi Po At Rn Fr Ra Ac Th Pa U Np Pu Am Cm Bk Cf Es Fm Md No Lr Rf Df Sg Bh Hs Mt Ds Rg Cn Nh Fl Mc Lv Ts Og)<br />
<br />
set mass_list = (1.00794 4.00260 6.941 9.01218 10.81 12.01 14.007 16.00 18.9984 20.180 22.99 24.305 26.98 28.1 30.97 32.1 35.45 39.95 39.10 40.08 44.955912 47.867 50.9415 51.9961 54.938045 55.845 58.933195 58.6934 63.546 65.38 69.723 72.63 74.92160 78.96 79.904 83.798 85.4678 87.62 88.90585 91.224 92.90638 95.96 98 101.07 102.90550 106.42 107.8682 112.411 114.818 118.710 121.760 127.60 126.90447 131.293 132.9054519 137.33 138.90547 140.116 140.90765 144.242 145 150.36 151.964 157.25 158.92535 162.500 164.93032 167.259 168.93421 173.054 174.9668 178.49 180.94788 183.84 186.207 190.23 192.217 195.084 196.966569 200.59 204.3833 207.2 208.98040 209 210 222 223 226 227 232.0381 231.03588 238.02891 237 244 243 247 247 251 252 257 258 259 262 261.11 268 271 270 269 278 281 281 285 286 289 289 293 294 294)<br />
<br />
set upf_list = `ls *.UPF`<br />
foreach upf_name (${upf_list})<br />
&nbsp; set element_name = `echo ${upf_name} | sed &#39;s/\..*//g&#39;`<br />
&nbsp; #<br />
&nbsp; set count = 1<br />
&nbsp; foreach atom ($element_list)<br />
&nbsp; &nbsp; if (&quot;${atom}&quot; == &quot;${element_name}&quot;) then<br />
&nbsp; &nbsp; &nbsp; set mass = `echo $mass_list[$count] | awk &#39;{printf(&quot;%9.5f&quot;,$1)}&#39;`<br />
&nbsp; &nbsp; &nbsp; echo &quot;${atom}:${mass}&quot;<br />
&nbsp; &nbsp; endif<br />
&nbsp; &nbsp; @ count += 1<br />
&nbsp; end<br />
&nbsp; #<br />
cat &lt;&lt; EOF &gt; isolated_atom.in<br />
&amp;CONTROL<br />
&nbsp; calculation &nbsp;= &#39;scf&#39;,<br />
&nbsp; prefix &nbsp;= &#39;${element_name}&#39;<br />
&nbsp; outdir &nbsp;= &#39;./work/${element_name}/&#39;<br />
&nbsp; pseudo_dir = &#39;./&#39; ,<br />
/<br />
&amp;SYSTEM<br />
&nbsp; ibrav=1,<br />
&nbsp; celldm(1)=20.0,<br />
&nbsp; nat=1,<br />
&nbsp; ntyp=1,<br />
&nbsp; nosym=.true.,<br />
&nbsp; occupations = &#39;smearing&#39; ,<br />
&nbsp; degauss &nbsp;= 0.02 ,<br />
&nbsp; smearing = &#39;mp&#39;,<br />
&nbsp; exxdiv_treatment = &#39;gygi-baldereschi&#39; ,<br />
&nbsp; x_gamma_extrapolation = .true. ,<br />
/<br />
&amp;ELECTRONS<br />
&nbsp; mixing_beta=0.35,<br />
&nbsp; conv_thr=1.0E-8,<br />
/<br />
ATOMIC_SPECIES<br />
${element_name} ${mass} ${upf_name}<br />
ATOMIC_POSITIONS alat<br />
${element_name} 0.0 0.0 0.0<br />
K_POINTS automatic<br />
1 1 1 &nbsp;0 0 0<br />
EOF<br />
&nbsp; #<br />
&nbsp; mpirun -np 4 $HOME/q-e-qe-*/bin/pw.x &lt; isolated_atom.in | tee isolated_atom.out<br />
&nbsp; #<br />
&nbsp; set TOTEN_Ry = `grep &quot; &nbsp;total energy &nbsp;&quot; isolated_atom.out | tail -1 | sed &#39;s/.*=//g&#39; | sed &#39;s/Ry//g&#39;`<br />
&nbsp; set TOTEN = `echo &quot;${TOTEN_Ry}*13.6058&quot; | bc -l | awk &#39;{printf &quot;%15.10f&quot;,$0}&#39;`<br />
&nbsp; echo &quot;----------eV/atom for isolated atom----------&quot;<br />
&nbsp; echo &quot;${element_name}:${TOTEN} eV: ${upf_name}&quot;<br />
&nbsp; echo &quot;${element_name} ${TOTEN} eV: ${upf_name}&quot; &gt;&gt; energy_data_for_isolated_atom<br />
end<br />
-----<br />
2. sed -i &#39;s/\r//g&#39; run_isolated_atom<br />
&nbsp; (sudo apt install nkf)<br />
&nbsp; (nkf -Lu --in-place run_isolated_atom)<br />
3. chmod +x run_isolated_atom<br />
4. mv run_isolated_atom ~/potfit/util<br />
5. mkdir work<br />
6. ~/potfit/util/run_isolated_atom<br />
(you can get &quot;energy_data_for_isolated_atom&quot;)<br />
◇ Usage<br />
A1. cd ~/PSLibrary<br />
&nbsp; (set potential files)<br />
A2. mkdir work<br />
A3. ~/potfit/util/run_isolated_atom<br />
A4. cp energy_data_for_isolated_atom ~/potfit/util/energy_data_for_isolated_atom<br />
<br />
◇ pwscf2force<br />
1. gedit pwscf2force<br />
-----<br />
#! /bin/csh -f<br />
#<br />
set nx = $1<br />
set ny = $2<br />
set nz = $3<br />
#<br />
echo -n &quot;&quot; &gt; tmp.xyzf<br />
cp *.*.out tmp.out<br />
#<br />
set element_list = (H He Li Be B C N O F Ne Na Mg Al Si P S Cl Ar K Ca Sc Ti V Cr Mn Fe Co Ni Cu Zn Ga Ge As Se Br Kr Rb Sr Y Zr Nb Mo Tc Ru Rh Pd Ag Cd In Sn Sb Te I Xe Cs Ba La Ce Pr Nd Pm Sm Eu Gd Tb Dy Ho Er Tm Yb Lu Hf Ta W Re Os Ir Pt Au Hg Tl Pb Bi Po At Rn Fr Ra Ac Th Pa U Np Pu Am Cm Bk Cf Es Fm Md No Lr Rf Df Sg Bh Hs Mt Ds Rg Cn Nh Fl Mc Lv Ts Og)<br />
#<br />
if (-f tmp.cp.in) then<br />
&nbsp; set upf_list = `grep .UPF tmp.cp.in | awk &#39;{printf &quot;%s &quot;,$3}&#39;`<br />
&nbsp; set CP_flag &nbsp;= 1<br />
&nbsp; set MD_flag &nbsp;= 0<br />
&nbsp; set SCF_flag = 0<br />
endif<br />
if (-f tmp.md.in) then<br />
&nbsp; set upf_list = `grep .UPF tmp.md.in | awk &#39;{printf &quot;%s &quot;,$3}&#39;`<br />
&nbsp; set CP_flag &nbsp;= 0<br />
&nbsp; set MD_flag &nbsp;= 1<br />
&nbsp; set SCF_flag = 0<br />
endif<br />
if (-f tmp.scf.in) then<br />
&nbsp; set upf_list = `grep .UPF tmp.scf.in | awk &#39;{printf &quot;%s &quot;,$3}&#39;`<br />
&nbsp; set CP_flag &nbsp;= 0<br />
&nbsp; set MD_flag &nbsp;= 0<br />
&nbsp; set SCF_flag = 1<br />
endif<br />
#<br />
if (&quot;${CP_flag}&quot; == &quot;1&quot;) then<br />
&nbsp; set num_atoms = 0<br />
&nbsp; set num_atoms_list = `awk &#39;{if($1==&quot;Species&quot; &amp;&amp; $3==&quot;atoms&quot;){print $5}}&#39; tmp.out`<br />
&nbsp; foreach num_atoms_part ($num_atoms_list)<br />
&nbsp; &nbsp; set num_atoms = `echo &quot;${num_atoms} + ${num_atoms_part}&quot; | bc -l`<br />
&nbsp; end<br />
&nbsp; echo &quot;#N ${num_atoms} 1&quot;<br />
&nbsp; set num_atom_type = `grep &quot;Specie:&quot; tmp.out | tail -1 | awk &#39;{print $2}&#39;`<br />
&nbsp; #<br />
&nbsp; set element = &quot;&quot;<br />
&nbsp; set count = 1<br />
&nbsp; foreach atom ($element_list)<br />
&nbsp; &nbsp; set num = `grep -c -i &quot; &nbsp;${atom} &nbsp;&quot; tmp.out`<br />
&nbsp; &nbsp; if (${num} &gt; 0) then<br />
&nbsp; &nbsp; &nbsp; set element = `echo ${element}&quot; &quot;${atom}`<br />
&nbsp; &nbsp; endif<br />
&nbsp; &nbsp; @ count += 1<br />
&nbsp; end<br />
else<br />
&nbsp; # SCF or MD calculation<br />
&nbsp; set num_atoms = `awk &#39;{if($1==&quot;number&quot; &amp;&amp; $3==&quot;atoms/cell&quot;){printf &quot;%d&quot;,$5}}&#39; tmp.out`<br />
&nbsp; echo &quot;#N ${num_atoms} 1&quot;<br />
&nbsp; set num_atom_type = `awk &#39;{if($1==&quot;number&quot; &amp;&amp; $4==&quot;types&quot;){printf &quot;%d&quot;,$6}}&#39; tmp.out`<br />
&nbsp; #grep &quot;PseudoPot.&quot; *.*.out<br />
&nbsp; set element = `awk &#39;{if($1==&quot;PseudoPot.&quot;){printf &quot;%s &quot;,$5}}&#39; tmp.out`<br />
endif<br />
echo &quot;#C ${element}&quot;<br />
#<br />
if (&quot;${CP_flag}&quot; == &quot;1&quot;) then<br />
&nbsp; echo &quot;## force file generated from file *.cp.out config 1 &quot;<br />
&nbsp; set alat = `awk &#39;{if($1==&quot; alat &quot;){printf &quot;%13.8f&quot;,$3*0.52917}}&#39; tmp.out`<br />
&nbsp; set a1 = `awk &#39;{if($1==&quot;a1&quot;){printf &quot; %13.8f %13.8f %13.8f&quot;,$3*0.52917,$4*0.52917,$5*0.52917}}&#39; tmp.out`<br />
&nbsp; set a2 = `awk &#39;{if($1==&quot;a2&quot;){printf &quot; %13.8f %13.8f %13.8f&quot;,$3*0.52917,$4*0.52917,$5*0.52917}}&#39; tmp.out`<br />
&nbsp; set a3 = `awk &#39;{if($1==&quot;a3&quot;){printf &quot; %13.8f %13.8f %13.8f&quot;,$3*0.52917,$4*0.52917,$5*0.52917}}&#39; tmp.out`<br />
else<br />
&nbsp; echo &quot;## force file generated from file *.md.out or *.scf.out config 1 &quot;<br />
&nbsp; set alat = `awk &#39;{if($1==&quot;lattice&quot; &amp;&amp; $2==&quot;parameter&quot;){printf &quot;%13.8f&quot;,$5*0.52917}}&#39; tmp.out`<br />
&nbsp; set a1 = `awk -v alat=${alat} &#39;{if($1==&quot;a(1)&quot;){printf &quot; %13.8f %13.8f %13.8f&quot;,$4*alat,$5*alat,$6*alat}}&#39; tmp.out`<br />
&nbsp; set a2 = `awk -v alat=${alat} &#39;{if($1==&quot;a(2)&quot;){printf &quot; %13.8f %13.8f %13.8f&quot;,$4*alat,$5*alat,$6*alat}}&#39; tmp.out`<br />
&nbsp; set a3 = `awk -v alat=${alat} &#39;{if($1==&quot;a(3)&quot;){printf &quot; %13.8f %13.8f %13.8f&quot;,$4*alat,$5*alat,$6*alat}}&#39; tmp.out`<br />
endif<br />
echo &quot;#X ${a1}&quot;<br />
echo &quot;#Y ${a2}&quot;<br />
echo &quot;#Z ${a3}&quot;<br />
#<br />
echo &quot;#W 1.000000&quot;<br />
#<br />
if (&quot;${CP_flag}&quot; == &quot;1&quot;) then<br />
&nbsp; set ETOT_eV = `grep &quot; &nbsp;total energy = &quot; tmp.out | sed &#39;s/.*=//g&#39; | &nbsp;awk &#39;{printf &quot;%15.10f&quot;,$1*13.6058*2}&#39;`<br />
else<br />
&nbsp; set ETOT_Ry = `grep &quot; &nbsp;total energy &nbsp;&quot; tmp.out | tail -1 | sed &#39;s/.*=//g&#39; | sed &#39;s/Ry//g&#39;`<br />
&nbsp; set ETOT_eV = `echo &quot;${ETOT_Ry}*13.6058&quot; | bc -l | awk &#39;{printf &quot;%15.10f&quot;,$0}&#39;`<br />
endif<br />
set TE_ISO = 0.0<br />
foreach atom (${element})<br />
&nbsp; #<br />
&nbsp; if (&quot;${CP_flag}&quot; == &quot;1&quot;) then<br />
&nbsp; &nbsp; set positions_start_line = `grep -n &quot;ATOMIC_POSITIONS&quot; tmp.out | sed &#39;s/:.*//g&#39; | head -n 1`<br />
&nbsp; &nbsp; set num_atom = `awk -v psl=${positions_start_line} -v na=${num_atoms} &#39;(psl&lt;NR &amp;&amp; NR&lt;=psl+na){printf &quot;%s \n&quot;,$0}&#39; tmp.out | grep -c &quot; &nbsp;${atom} &nbsp;&quot;`<br />
&nbsp; endif<br />
&nbsp; #<br />
&nbsp; if (&quot;${MD_flag}&quot; == &quot;1&quot;) then<br />
&nbsp; &nbsp; set positions_start_line = `grep -n &quot;ATOMIC_POSITIONS&quot; tmp.out | tail -1 | sed &#39;s/:.*//g&#39;`<br />
&nbsp; &nbsp; set num_atom = `awk -v psl=${positions_start_line} -v na=${num_atoms} &#39;(psl&lt;NR &amp;&amp; NR&lt;=psl+na){printf &quot;%s \n&quot;,$1}&#39; tmp.out | grep -c &quot;${atom} &quot;`<br />
&nbsp; endif<br />
&nbsp; #<br />
&nbsp; if (&quot;${SCF_flag}&quot; == &quot;1&quot;) then<br />
&nbsp; &nbsp; set positions_start_line = `grep -n &quot;positions&quot; tmp.out | sed &#39;s/:.*//g&#39; | head -n 1`<br />
&nbsp; &nbsp; set num_atom = `awk -v psl=${positions_start_line} -v na=${num_atoms} &#39;(psl&lt;NR &amp;&amp; NR&lt;=psl+na){printf &quot;%s \n&quot;,$0}&#39; tmp.out | grep -c &quot; ${atom} &quot;`<br />
&nbsp; endif<br />
&nbsp; #<br />
&nbsp; foreach upf_name (${upf_list})<br />
&nbsp; &nbsp; set AE_ISO = `awk -v atom=${atom} -v na=${num_atom} -v upf=${upf_name} &#39;{if($1==atom &amp;&amp; $4==upf){printf &quot;%15.10f&quot;,$2*na}}&#39; energy_data_for_isolated_atom`<br />
&nbsp; end<br />
&nbsp; set TE_ISO = `echo &quot;${TE_ISO}+${AE_ISO}&quot; | bc -l | awk &#39;{printf &quot;%15.10f&quot;,$0}&#39;`<br />
end<br />
set coh_eng = `echo &quot;(${ETOT_eV} - ${TE_ISO})/${num_atoms}&quot; | bc -l | awk &#39;{printf &quot;%15.10f&quot;,$0}&#39;`<br />
echo &quot;#E ${coh_eng}&quot;<br />
#<br />
if (&quot;${CP_flag}&quot; == &quot;1&quot;) then<br />
&nbsp; set stress_line = `awk &#39;{if($1==&quot;Total&quot; &amp;&amp; $2==&quot;stress&quot;){print NR}}&#39; tmp.out`<br />
&nbsp; set stress_xx = `awk -v sl=${stress_line} &#39;NR==(sl+1){printf &quot;%12.8f&quot;,$1/160.21766208}&#39; tmp.out`<br />
&nbsp; set stress_xy = `awk -v sl=${stress_line} &#39;NR==(sl+1){printf &quot;%12.8f&quot;,$2/160.21766208}&#39; tmp.out`<br />
&nbsp; set stress_xz = `awk -v sl=${stress_line} &#39;NR==(sl+1){printf &quot;%12.8f&quot;,$3/160.21766208}&#39; tmp.out`<br />
&nbsp; set stress_yy = `awk -v sl=${stress_line} &#39;NR==(sl+2){printf &quot;%12.8f&quot;,$2/160.21766208}&#39; tmp.out`<br />
&nbsp; set stress_yz = `awk -v sl=${stress_line} &#39;NR==(sl+2){printf &quot;%12.8f&quot;,$3/160.21766208}&#39; tmp.out`<br />
&nbsp; set stress_zz = `awk -v sl=${stress_line} &#39;NR==(sl+3){printf &quot;%12.8f&quot;,$3/160.21766208}&#39; tmp.out`<br />
else<br />
&nbsp; #set stress_line = `awk &#39;{if($1==&quot;total&quot; &amp;&amp; $2==&quot;stress&quot;){print NR}}&#39; tmp.out`<br />
&nbsp; #set stress_line = `grep &quot;(Ry\/bohr\*\*3)&quot; tmp.out | sed &#39;s/:.*//g&#39;`<br />
&nbsp; set stress_line = &nbsp;`grep -n &quot;total &nbsp; stress&quot; tmp.out | tail -1 | sed &#39;s/:.*//g&#39;`<br />
&nbsp; set stress_xx = `awk -v sl=${stress_line} &#39;NR==(sl+1){printf &quot;%12.8f&quot;,$1*0.01089137}&#39; tmp.out`<br />
&nbsp; set stress_xy = `awk -v sl=${stress_line} &#39;NR==(sl+1){printf &quot;%12.8f&quot;,$2*0.01089137}&#39; tmp.out`<br />
&nbsp; set stress_xz = `awk -v sl=${stress_line} &#39;NR==(sl+1){printf &quot;%12.8f&quot;,$3*0.01089137}&#39; tmp.out`<br />
&nbsp; set stress_yy = `awk -v sl=${stress_line} &#39;NR==(sl+2){printf &quot;%12.8f&quot;,$2*0.01089137}&#39; tmp.out`<br />
&nbsp; set stress_yz = `awk -v sl=${stress_line} &#39;NR==(sl+2){printf &quot;%12.8f&quot;,$3*0.01089137}&#39; tmp.out`<br />
&nbsp; set stress_zz = `awk -v sl=${stress_line} &#39;NR==(sl+3){printf &quot;%12.8f&quot;,$3*0.01089137}&#39; tmp.out`<br />
endif<br />
echo &quot;#S ${stress_xx} ${stress_yy} ${stress_zz} ${stress_xy} ${stress_yz} ${stress_xz}&quot;<br />
#<br />
echo &quot;#F&quot;<br />
#<br />
if (&quot;${CP_flag}&quot; == &quot;1&quot;) then<br />
&nbsp; set positions_start_line = `grep -n &quot;ATOMIC_POSITIONS&quot; tmp.out | sed &#39;s/:.*//g&#39; | head -n 1`<br />
endif<br />
if (&quot;${MD_flag}&quot; == &quot;1&quot;) then<br />
&nbsp; set positions_start_line = `grep -n &quot;ATOMIC_POSITIONS&quot; tmp.out | tail -1 | sed &#39;s/:.*//g&#39;`<br />
endif<br />
if (&quot;${SCF_flag}&quot; == &quot;1&quot;) then<br />
&nbsp; set positions_start_line = `grep -n &quot;positions&quot; tmp.out | sed &#39;s/:.*//g&#39; | head -n 1`<br />
endif<br />
#<br />
if (&quot;${CP_flag}&quot; == &quot;1&quot;) then<br />
&nbsp; set force_start_line = `grep -n &quot;Forces&quot; tmp.out | sed &#39;s/:.*//g&#39; | head -n 1`<br />
else<br />
&nbsp; #echo $positions_start_line<br />
&nbsp; #grep -c &quot;force =&quot; tmp.out<br />
&nbsp; #set force_end_line = `grep -n &quot;force =&quot; tmp.out | sed &#39;s/:.*//g&#39; | tail -2`<br />
&nbsp; set force_start_line_md = `grep -n &quot;Forces acting on atoms&quot; tmp.out | tail -1 | sed &#39;s/:.*//g&#39;`<br />
&nbsp; set force_start_line = `echo &quot;${force_start_line_md} + 2&quot; | bc`<br />
endif<br />
#<br />
set i = 1<br />
while($i &lt;= ${num_atoms})<br />
&nbsp; #<br />
&nbsp; if (&quot;${CP_flag}&quot; == &quot;1&quot;) then<br />
&nbsp; &nbsp; set atom_type = `awk -v fsl=${force_start_line} -v ni=$i &#39;NR==(fsl+ni){printf &quot;%s \n&quot;,$1}&#39; tmp.out`<br />
&nbsp; &nbsp; set position = `awk -v psl=${positions_start_line} -v ni=$i -v alat=${alat} &#39;NR==(psl+ni){printf &quot; %12.8f %12.8f %12.8f \n&quot;,$2*0.52917,$3*0.52917,$4*0.52917}&#39; tmp.out`<br />
&nbsp; &nbsp; set force = `awk -v fsl=${force_start_line} -v ni=$i &#39;NR==(fsl+ni){printf &quot; %12.8f %12.8f %12.8f \n&quot;,$2/51.421,$3/51.421,$4/51.421}&#39; tmp.out`<br />
&nbsp; endif<br />
&nbsp; #<br />
&nbsp; if (&quot;${MD_flag}&quot; == &quot;1&quot;) then<br />
&nbsp; &nbsp; set position = `awk -v psl=${positions_start_line} -v ni=$i -v alat=${alat} -v nx=${nx} -v ny=${ny} -v nz=${nz} &#39;NR==(psl+ni){printf &quot; %12.8f %12.8f %12.8f \n&quot;,$2*alat*nx,$3*alat*ny,$4*alat*nz}&#39; tmp.out`<br />
&nbsp; &nbsp; set force = `awk -v fsl=${force_start_line} -v ni=$i &#39;NR==(fsl+ni-1){printf &quot; %12.8f %12.8f %12.8f \n&quot;,$7*25.711,$8*25.711,$9*25.711}&#39; tmp.out`<br />
&nbsp; &nbsp; set atom_type = `awk -v fsl=${force_start_line} -v ni=$i &#39;NR==(fsl+ni-1){printf &quot;%d&quot;,($4-1)}&#39; tmp.out`<br />
&nbsp; endif<br />
&nbsp; #<br />
&nbsp; if (&quot;${SCF_flag}&quot; == &quot;1&quot;) then<br />
&nbsp; &nbsp; set position = `awk -v psl=${positions_start_line} -v ni=$i -v alat=${alat} &#39;NR==(psl+ni){printf &quot; %12.8f %12.8f %12.8f \n&quot;,$7*alat,$8*alat,$9*alat}&#39; tmp.out`<br />
&nbsp; &nbsp; set force = `awk -v fsl=${force_start_line} -v ni=$i &#39;NR==(fsl+ni-1){printf &quot; %12.8f %12.8f %12.8f \n&quot;,$7*25.711,$8*25.711,$9*25.711}&#39; tmp.out`<br />
&nbsp; &nbsp; set atom_type = `awk -v fsl=${force_start_line} -v ni=$i &#39;NR==(fsl+ni-1){printf &quot;%d&quot;,($4-1)}&#39; tmp.out`<br />
&nbsp; endif<br />
&nbsp; #<br />
&nbsp; echo &quot;$atom_type &nbsp;$position &nbsp;$force&quot; &gt;&gt; tmp.xyzf<br />
&nbsp; @ i = $i + 1<br />
end<br />
#<br />
set i = 0<br />
if (&quot;${CP_flag}&quot; == &quot;1&quot;) then<br />
&nbsp; foreach atom (${element})<br />
&nbsp; &nbsp; awk -v atom=$atom -v ni=$i &#39;{if($1==atom){printf &quot;%d &nbsp;%12.8f %12.8f %12.8f &nbsp;%12.8f %12.8f %12.8f \n&quot;,ni,$2,$3,$4,$5,$6,$7}}&#39; tmp.xyzf<br />
&nbsp; &nbsp; @ i += 1<br />
&nbsp; end<br />
else<br />
&nbsp; while($i &lt; ${num_atom_type})<br />
&nbsp; &nbsp; awk -v ni=$i &#39;{if($1==ni){printf &quot;%s \n&quot;,$0}}&#39; tmp.xyzf<br />
&nbsp; &nbsp; @ i = $i + 1<br />
&nbsp; end<br />
endif<br />
#<br />
rm -f -r tmp.xyzf<br />
<br />
# unit<br />
# PWscf, force: Ry/au, stress: Ry/bohr^3<br />
# &nbsp;(force : tprnfor = .true. or relax, md, vc-md)<br />
# &nbsp;(stress: tstress = .true. or vc-md, vc-relax)<br />
# VASP , TOTAL-FORCE: eV/Angstrom, stress: eV<br />
<br />
# conversion (http://greif.geo.berkeley.edu/~driver/conversions.html)<br />
# (https://courses.physics.illinois.edu/mse404ela/sp2018/6.DFT-walkthrough.html)<br />
# 1 Ry/au = 1 Ry/bohr = 25.711 eV/Angstrom<br />
# 1 Ry/bohr^3 = 0.01089137 eV/Angstrom^3<br />
<br />
# PWscf: cohesive energy = eV/atom(crystal) - eV/atom(isolated)<br />
-----<br />
2. sed -i &#39;s/\r//g&#39; pwscf2force<br />
&nbsp; (sudo apt install nkf)<br />
&nbsp; (nkf -Lu --in-place pwscf2force)<br />
3. chmod +x pwscf2force<br />
4. mv pwscf2force ~/potfit/util<br />
5. ~/potfit/util/pwscf2force<br />
(Note: &quot;pwscf2force&quot; needs &quot;*.scf.out&quot; and &quot;energy_data_for_isolated_atom&quot;)<br />
<br />
◇ correct_config<br />
1. gedit correct_config<br />
-----<br />
#! /bin/csh -f<br />
<br />
set filename = $1<br />
cp ${filename}.config tmp.config<br />
cp ${filename}.config ${filename}_origin.config<br />
#<br />
set C_Line_list = `awk &#39;{if($1==&quot;#C&quot;){print NR}}&#39; tmp.config`<br />
#<br />
set old_len = 1<br />
foreach C_Line (${C_Line_list})<br />
&nbsp; echo &quot;#C Line: &quot;${C_Line}<br />
&nbsp; set new_len = `awk -v cl=${C_Line} &#39;{if(NR==cl){print length($0)}}&#39; tmp.config`<br />
&nbsp; if ($new_len &gt; $old_len) then<br />
&nbsp; &nbsp; @ old_len = $new_len<br />
&nbsp; &nbsp; set ref_C_Line = ${C_Line}<br />
&nbsp; endif<br />
end<br />
set ref_c = `awk -v rcl=${ref_C_Line} &#39;{if(NR==rcl){print $0}}&#39; tmp.config`<br />
echo &quot;Setting #C data: &quot;${ref_c}<br />
set end_line_plus2 = `awk &#39;END{print NR+2}&#39; tmp.config`<br />
set new_C_Line_list = `echo &quot;${C_Line_list} ${end_line_plus2}&quot;`<br />
#<br />
cp tmp.config new_tmp.config<br />
set count = 1<br />
set nex_count = 2<br />
foreach C_Line (${C_Line_list})<br />
&nbsp; set new_c = `awk -v cl=${C_Line} &#39;{if(NR==cl){print $0}}&#39; tmp.config`<br />
&nbsp; echo &quot;--------------------&quot;<br />
&nbsp; echo &quot;Line: &quot;$C_Line<br />
&nbsp; if (&quot;$new_c&quot; != &quot;$ref_c&quot;) then<br />
&nbsp; &nbsp; set num_position = `awk -v cl=${C_Line} &#39;{if(NR==cl-1){printf &quot;%d&quot;,$2}}&#39; tmp.config`<br />
&nbsp; &nbsp; echo &quot;number of position: &quot;${num_position}<br />
&nbsp; &nbsp; set i = -1<br />
&nbsp; &nbsp; foreach ref_element ($ref_c)<br />
&nbsp; &nbsp; &nbsp; set j = -1<br />
&nbsp; &nbsp; &nbsp; foreach element ($new_c)<br />
&nbsp; &nbsp; &nbsp; &nbsp; if (&quot;$ref_element&quot; == &quot;$element&quot; &amp;&amp; &quot;$ref_element&quot; != &quot;#C&quot;) then<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo $element&quot;: old: &quot;$j&quot;, new: &quot;$i<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @ next_count = $count + 1<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; awk -v np=${num_position} -v el=$new_C_Line_list[$next_count] -v nj=$j -v ni=$i &#39;{if((el-2-np)&lt;NR &amp;&amp; NR &lt;=(el-2) &amp;&amp; $1==nj){printf &quot;Newnum%-d &nbsp;%11.5f %11.5f %11.5f &nbsp;%11.5f %11.5f %11.5f\n&quot;,ni,$2,$3,$4,$5,$6,$7}else{print $0}}&#39; tmp.config &gt; new_tmp.config<br />
&nbsp; &nbsp; &nbsp; &nbsp; endif<br />
&nbsp; &nbsp; &nbsp; &nbsp; cp new_tmp.config tmp.config<br />
&nbsp; &nbsp; &nbsp; &nbsp; @ j = $j + 1<br />
&nbsp; &nbsp; &nbsp; end<br />
&nbsp; &nbsp; &nbsp; @ i = $i + 1<br />
&nbsp; &nbsp; end<br />
&nbsp; endif<br />
&nbsp; @ count = $count + 1<br />
end<br />
#<br />
foreach C_Line (${C_Line_list})<br />
&nbsp; awk -v cl=${C_Line} -v refc=&quot;${ref_c}&quot; &#39;{if(NR==cl){printf &quot;%s\n&quot;,refc}else{print $0}}&#39; tmp.config &gt; new_tmp.config<br />
&nbsp; cp new_tmp.config tmp.config<br />
end<br />
#<br />
sed -i &quot;s/Newnum//g&quot; tmp.config<br />
mv tmp.config ${filename}.config<br />
#<br />
rm -f -r new_tmp.config<br />
-----<br />
2. sed -i &#39;s/\r//g&#39; correct_config<br />
&nbsp; (sudo apt install nkf)<br />
&nbsp; (nkf -Lu --in-place correct_config)<br />
3. chmod +x correct_config<br />
4. cp correct_config ~/potfit/util<br />
5. correct_config Mg_H<br />
&nbsp; (e.g., Mg_H.config)<br />
<br />
◇ run_pwscf_potfit_m<br />
1. gedit run_pwscf_potfit_m<br />
-----<br />
#! /bin/csh -f<br />
<br />
set num_core_pwscf = 4<br />
set num_core_potfit = $4 # less than number of data in config<br />
<br />
set filename = $1<br />
set total_num_elements = $2<br />
set potential_type = $3<br />
set max_num_move = $4<br />
set x = $5<br />
set cif2cell_other_option = $6<br />
<br />
echo -n &quot;&quot; &gt; ${filename}.config<br />
echo -n &quot;&quot; &gt; ${filename}.pot<br />
echo -n &quot;&quot; &gt; param_file<br />
<br />
set cif_list = `ls *.cif`<br />
foreach cif_name (${cif_list})<br />
<br />
&nbsp; set cif_folder_name = `echo $cif_name:r`<br />
<br />
&nbsp; set i = 1<br />
&nbsp; while($i &lt;= ${max_num_move})<br />
&nbsp; &nbsp; set scale = `echo &quot;0.98 + 0.02/((${max_num_move}+1)/2)*$i&quot; | bc -l | awk &#39;{printf &quot;%5.3f&quot;,$0}&#39;`<br />
&nbsp; &nbsp; foreach vector (a b c)<br />
&nbsp; &nbsp; &nbsp; rm -f -r ${cif_folder_name}_${vector}${scale}<br />
&nbsp; &nbsp; &nbsp; mkdir ${cif_folder_name}_${vector}${scale}<br />
&nbsp; &nbsp; &nbsp; cd ./${cif_folder_name}_${vector}${scale}<br />
&nbsp; &nbsp; &nbsp; cp ../${cif_name} ./<br />
&nbsp; &nbsp; &nbsp; cif2cell -p pwscf --pwscf-pseudo-PSLibrary-libdr=$HOME/PSLibrary --pwscf-bin-dir=$HOME/q-e-qe-\*/bin --setup-all --k-resolution=0.48 --pwscf-spin=no --pwscf-run-type=scf --pwscf-force=yes --pwscf-stress=yes -f ${cif_name} --supercell=&quot;[$x,$x,$x]&quot; ${cif2cell_other_option}<br />
<br />
&nbsp; &nbsp; &nbsp; #sed -i &#39;2i tstress = .true. ,&#39; ${cif_folder_name}.scf.in # cif2cell-1.2.39<br />
&nbsp; &nbsp; &nbsp; #sed -i &#39;2i tprnfor = .true. ,&#39; ${cif_folder_name}.scf.in # cif2cell-1.2.39<br />
<br />
&nbsp; &nbsp; &nbsp; cp ${cif_folder_name}.scf.in tmp.scf.in<br />
<br />
&nbsp; &nbsp; &nbsp; set cell_param_line = `grep -n &quot;CELL_PARAMETERS&quot; tmp.scf.in | sed -e &#39;s/:.*//g&#39;`<br />
&nbsp; &nbsp; &nbsp; if (&quot;${vector}&quot; == &quot;a&quot;) then<br />
&nbsp; &nbsp; &nbsp; &nbsp; awk -v cpl=${cell_param_line} -v scale=${scale} &#39;{if(NR==(cpl+1)){printf &quot; %19.15f %19.15f %19.15f \n&quot;,$1*scale,$2*scale,$3*scale}else{printf &quot;%s \n&quot;,$0}}&#39; tmp.scf.in &gt; ${cif_folder_name}.scf.in<br />
&nbsp; &nbsp; &nbsp; else if (&quot;${vector}&quot; == &quot;b&quot;) then<br />
&nbsp; &nbsp; &nbsp; &nbsp; awk -v cpl=${cell_param_line} -v scale=${scale} &#39;{if(NR==(cpl+2)){printf &quot; %19.15f %19.15f %19.15f \n&quot;,$1*scale,$2*scale,$3*scale}else{printf &quot;%s \n&quot;,$0}}&#39; tmp.scf.in &gt; ${cif_folder_name}.scf.in<br />
&nbsp; &nbsp; &nbsp; else if (&quot;${vector}&quot; == &quot;b&quot;) then<br />
&nbsp; &nbsp; &nbsp; &nbsp; awk -v cpl=${cell_param_line} -v scale=${scale} &#39;{if(NR==(cpl+3)){printf &quot; %19.15f %19.15f %19.15f \n&quot;,$1*scale,$2*scale,$3*scale}else{printf &quot;%s \n&quot;,$0}}&#39; tmp.scf.in &gt; ${cif_folder_name}.scf.in<br />
&nbsp; &nbsp; &nbsp; endif<br />
<br />
&nbsp; &nbsp; &nbsp; mpirun -np ${num_core_pwscf} $HOME/q-e-qe-*/bin/pw.x &lt; ${cif_folder_name}.scf.in | tee ${cif_folder_name}.scf.out<br />
<br />
&nbsp; &nbsp; &nbsp; cp $HOME/PSLibrary/energy_data_for_isolated_atom ./<br />
&nbsp; &nbsp; &nbsp; $HOME/potfit/util/pwscf2force $x $x $x | tee ${cif_folder_name}_${vector}${scale}.config<br />
&nbsp; &nbsp; &nbsp; cat ${cif_folder_name}_${vector}${scale}.config &gt;&gt; ../${filename}.config<br />
<br />
&nbsp; &nbsp; &nbsp; cd ..<br />
&nbsp; &nbsp; end<br />
&nbsp; &nbsp; @ i = $i + 1<br />
&nbsp; end<br />
end<br />
<br />
if (&quot;${total_num_elements}&quot; == &quot;1&quot;) then<br />
&nbsp; if (&quot;${potential_type}&quot; == &quot;eam&quot;) then<br />
&nbsp; &nbsp; makeapot -g -n 1 -i eam -f &quot;morse_sc,csw2_sc,bjs&quot; | tee ${filename}.pot<br />
&nbsp; else if (&quot;${potential_type}&quot; == &quot;adp&quot;) then<br />
&nbsp; &nbsp; makeapot -g -n 1 -i adp -f &quot;eopp_sc,csw2_sc,bjs,2*csw2_sc&quot; | tee ${filename}.pot<br />
&nbsp; #else if (&quot;${potential_type}&quot; == &quot;stiweb&quot;) then<br />
&nbsp; # &nbsp;makeapot -g -n 1 -i stiweb | tee ${filename}.pot<br />
&nbsp; #else if (&quot;${potential_type}&quot; == &quot;tersoff&quot;) then<br />
&nbsp; # &nbsp;makeapot -g -n 1 -i tersoff | tee ${filename}.pot<br />
&nbsp; endif<br />
else if (&quot;${total_num_elements}&quot; == &quot;2&quot;) then<br />
&nbsp; if (&quot;${potential_type}&quot; == &quot;eam&quot;) then<br />
&nbsp; &nbsp; makeapot -g -n 2 -i eam -f &quot;3*morse_sc,2*csw2_sc,2*bjs&quot; | tee ${filename}.pot<br />
&nbsp; else if (&quot;${potential_type}&quot; == &quot;adp&quot;) then<br />
&nbsp; &nbsp; makeapot -g -n 2 -i adp -f &quot;3*eopp_sc,2*csw2_sc,2*bjs,6*csw2_sc&quot; | tee ${filename}.pot<br />
&nbsp; #else if (&quot;${potential_type}&quot; == &quot;stiweb&quot;) then<br />
&nbsp; # &nbsp;makeapot -g -n 2 -i stiweb | tee ${filename}.pot<br />
&nbsp; #else if (&quot;${potential_type}&quot; == &quot;tersoff&quot;) then<br />
&nbsp; # &nbsp;makeapot -g -n 2 -i tersoff | tee ${filename}.pot<br />
&nbsp; endif<br />
else if (&quot;${total_num_elements}&quot; == &quot;3&quot;) then<br />
&nbsp; if (&quot;${potential_type}&quot; == &quot;eam&quot;) then<br />
&nbsp; &nbsp; makeapot -g -n 3 -i eam -f &quot;6*morse,3*csw2,3*bjs&quot; | tee ${filename}.pot<br />
&nbsp; else if (&quot;${potential_type}&quot; == &quot;adp&quot;) then<br />
&nbsp; &nbsp; makeapot -g -n 3 -i adp -f &quot;6*eopp_sc,3*csw2_sc,3*bjs,12*csw2_sc&quot; | tee ${filename}.pot<br />
&nbsp; #else if (&quot;${potential_type}&quot; == &quot;stiweb&quot;) then<br />
&nbsp; # &nbsp;makeapot -g -n 3 -i stiweb | tee ${filename}.pot<br />
&nbsp; #else if (&quot;${potential_type}&quot; == &quot;tersoff&quot;) then<br />
&nbsp; # &nbsp;makeapot -g -n 3 -i tersoff | tee ${filename}.pot<br />
&nbsp; endif<br />
endif<br />
<br />
potfit_setup -c ${filename}.config -p ${filename}.pot -s ${filename} | tee param_file<br />
$HOME/potfit/util/correct_config ${filename}<br />
if (&quot;${num_core_potfit}&quot; == &quot;1&quot;) then<br />
&nbsp; potfit_apot_${potential_type}_mkl_stress param_file<br />
else<br />
&nbsp; mpirun -np ${num_core_potfit} potfit_apot_${potential_type}_mkl_mpi_stress param_file<br />
endif<br />
-----<br />
2. sed -i &#39;s/\r//g&#39; run_pwscf_potfit_m<br />
&nbsp; (sudo apt install nkf)<br />
&nbsp; (nkf -Lu --in-place run_pwscf_potfit_m)<br />
3. chmod +x run_pwscf_potfit_m<br />
4. export OMP_NUM_THREADS=1<br />
5. ./run_pwscf_potfit_m Al 1 eam 1 3 --no-reduce<br />
&nbsp; (e.g., Al, 1 element, EAM potential, 1 point, supecell 3x3x3, --no-reduce)<br />
&nbsp; or<br />
&nbsp; ./run_pwscf_potfit_m Al 1 eam 5 3 --no-reduce<br />
&nbsp; (e.g., Al, 1 element, EAM potential, 5 point, supecell 3x3x3, --no-reduce)<br />
&nbsp; or<br />
&nbsp; ./run_pwscf_potfit_m Mg_H 2 eam 3 2<br />
&nbsp; (e.g., Mg_H, 2 element, EAM potential, 3 point, supecell 2x2x2)<br />
&nbsp; or<br />
&nbsp; ./run_pwscf_potfit_m Mg_H 2 adp 3 2<br />
&nbsp; (e.g., Mg_H, 2 element, ADP potential, 3 point, supecell 2x2x2)<br />
&nbsp; or<br />
&nbsp; ./run_pwscf_potfit_m Mg_Ni_H 3 eam 5 1<br />
&nbsp; (e.g., Mg_Ni_H, 3 element, EAM potential, 5 point, supecell 1x1x1)<br />
&nbsp; or<br />
&nbsp; ./run_pwscf_potfit_m Mg_Ni_H 3 adp 7 1<br />
&nbsp; (e.g., Mg_Ni_H, 3 element, ADP potential, 7 point, supecell 1x1x1)<br />
<br />
◇ run_pwscf_md_potfit_m<br />
1. gedit run_pwscf_md_potfit_m<br />
-----<br />
#! /bin/csh -f<br />
<br />
set num_core_pwscf = 4<br />
set num_core_potfit = $4 # less than number of data in config<br />
<br />
set filename = $1<br />
set total_num_elements = $2<br />
set potential_type = $3<br />
set max_num_move = $4<br />
set x = $5<br />
set temperature_K = $6<br />
<br />
echo -n &quot;&quot; &gt; ${filename}.config<br />
echo -n &quot;&quot; &gt; ${filename}.pot<br />
echo -n &quot;&quot; &gt; param_file<br />
<br />
set cif_list = `ls *.cif`<br />
foreach cif_name (${cif_list})<br />
<br />
&nbsp; set cif_folder_name = `echo $cif_name:r`<br />
<br />
&nbsp; set i = 1<br />
&nbsp; while($i &lt;= ${max_num_move})<br />
&nbsp; &nbsp; set scale = `echo &quot;0.98 + 0.02/((${max_num_move}+1)/2)*$i&quot; | bc -l | awk &#39;{printf &quot;%5.3f&quot;,$0}&#39;`<br />
&nbsp; &nbsp; foreach vector (a b c)<br />
&nbsp; &nbsp; &nbsp; rm -f -r ${cif_folder_name}_${vector}${scale}<br />
&nbsp; &nbsp; &nbsp; mkdir ${cif_folder_name}_${vector}${scale}<br />
&nbsp; &nbsp; &nbsp; cd ./${cif_folder_name}_${vector}${scale}<br />
&nbsp; &nbsp; &nbsp; cp ../${cif_name} ./<br />
&nbsp; &nbsp; &nbsp; cif2cell -p pwscf --pwscf-pseudo-PSLibrary-libdr=$HOME/PSLibrary --pwscf-bin-dir=$HOME/q-e-qe-\*/bin --setup-all --k-resolution=0.48 --pwscf-spin=no --pwscf-stress=yes --pwscf-run-type=md -f ${cif_name} --no-reduce --supercell=&quot;[$x,$x,$x]&quot; --pwscf-temperature=${temperature_K}<br />
<br />
&nbsp; &nbsp; &nbsp; # cif2cell-1.2.39 (not recommend it)<br />
&nbsp; &nbsp; &nbsp; #sed -i &#39;2i tstress = .true. ,&#39; ${cif_folder_name}.md.in<br />
&nbsp; &nbsp; &nbsp; #sed -i &#39;2i tprnfor = .true. ,&#39; ${cif_folder_name}.md.in<br />
<br />
&nbsp; &nbsp; &nbsp; # cif2cell-1.2.40 and cif2cell-1.2.41 version (not recommend them)<br />
&nbsp; &nbsp; &nbsp; #set cell_param_line = `grep -n &quot;CELL_PARAMETERS&quot; ${cif_folder_name}.md.in | sed -e &#39;s/:.*//g&#39;`<br />
&nbsp; &nbsp; &nbsp; #awk -v split_line=${cell_param_line} &#39;NR&lt;split_line{print $0}&#39; ${cif_folder_name}.md.in &gt; tmp.md.in<br />
&nbsp; &nbsp; &nbsp; #echo &quot;&amp;IONS&quot; &gt;&gt; tmp.md.in<br />
&nbsp; &nbsp; &nbsp; #echo &quot; &nbsp;tempw = ${temperature_K} ,&quot; &gt;&gt; tmp.md.in<br />
&nbsp; &nbsp; &nbsp; #echo &quot;/&quot; &nbsp;&gt;&gt; tmp.md.in<br />
&nbsp; &nbsp; &nbsp; #awk -v split_line=${cell_param_line} &#39;NR&gt;=split_line{print $0}&#39; ${cif_folder_name}.md.in &gt;&gt; tmp.md.in<br />
<br />
&nbsp; &nbsp; &nbsp; # &gt;= cif2cell-1.2.42 version<br />
&nbsp; &nbsp; &nbsp; cp ${cif_folder_name}.md.in tmp.md.in<br />
<br />
&nbsp; &nbsp; &nbsp; set cell_param_line = `grep -n &quot;CELL_PARAMETERS&quot; tmp.md.in | sed -e &#39;s/:.*//g&#39;`<br />
<br />
&nbsp; &nbsp; &nbsp; if (&quot;${vector}&quot; == &quot;a&quot;) then<br />
&nbsp; &nbsp; &nbsp; &nbsp; awk -v cpl=${cell_param_line} -v scale=${scale} &#39;{if(NR==(cpl+1)){printf &quot; %19.15f %19.15f %19.15f \n&quot;,$1*scale,$2*scale,$3*scale}else{printf &quot;%s \n&quot;,$0}}&#39; tmp.md.in &gt; ${cif_folder_name}.md.in<br />
&nbsp; &nbsp; &nbsp; else if (&quot;${vector}&quot; == &quot;b&quot;) then<br />
&nbsp; &nbsp; &nbsp; &nbsp; awk -v cpl=${cell_param_line} -v scale=${scale} &#39;{if(NR==(cpl+2)){printf &quot; %19.15f %19.15f %19.15f \n&quot;,$1*scale,$2*scale,$3*scale}else{printf &quot;%s \n&quot;,$0}}&#39; tmp.md.in &gt; ${cif_folder_name}.md.in<br />
&nbsp; &nbsp; &nbsp; else if (&quot;${vector}&quot; == &quot;c&quot;) then<br />
&nbsp; &nbsp; &nbsp; &nbsp; awk -v cpl=${cell_param_line} -v scale=${scale} &#39;{if(NR==(cpl+3)){printf &quot; %19.15f %19.15f %19.15f \n&quot;,$1*scale,$2*scale,$3*scale}else{printf &quot;%s \n&quot;,$0}}&#39; tmp.md.in &gt; ${cif_folder_name}.md.in<br />
&nbsp; &nbsp; &nbsp; endif<br />
<br />
&nbsp; &nbsp; &nbsp; mpirun -np ${num_core_pwscf} $HOME/q-e-qe-*/bin/pw.x &lt; ${cif_folder_name}.md.in | tee ${cif_folder_name}.md.out<br />
<br />
&nbsp; &nbsp; &nbsp; cp $HOME/PSLibrary/energy_data_for_isolated_atom ./<br />
&nbsp; &nbsp; &nbsp; $HOME/potfit/util/pwscf2force $x $x $x | tee ${cif_folder_name}_${vector}${scale}.config<br />
&nbsp; &nbsp; &nbsp; cat ${cif_folder_name}_${vector}${scale}.config &gt;&gt; ../${filename}.config<br />
<br />
&nbsp; &nbsp; &nbsp; cd ..<br />
&nbsp; &nbsp; end<br />
&nbsp; &nbsp; @ i = $i + 1<br />
&nbsp; end<br />
end<br />
<br />
if (&quot;${total_num_elements}&quot; == &quot;1&quot;) then<br />
&nbsp; if (&quot;${potential_type}&quot; == &quot;eam&quot;) then<br />
&nbsp; &nbsp; makeapot -g -n 1 -i eam -f &quot;morse_sc,csw2_sc,bjs&quot; | tee ${filename}.pot<br />
&nbsp; else if (&quot;${potential_type}&quot; == &quot;adp&quot;) then<br />
&nbsp; &nbsp; makeapot -g -n 1 -i adp -f &quot;eopp_sc,csw2_sc,bjs,2*csw2_sc&quot; | tee ${filename}.pot<br />
&nbsp; #else if (&quot;${potential_type}&quot; == &quot;stiweb&quot;) then<br />
&nbsp; # &nbsp;makeapot -g -n 1 -i stiweb | tee ${filename}.pot<br />
&nbsp; #else if (&quot;${potential_type}&quot; == &quot;tersoff&quot;) then<br />
&nbsp; # &nbsp;makeapot -g -n 1 -i tersoff | tee ${filename}.pot<br />
&nbsp; endif<br />
else if (&quot;${total_num_elements}&quot; == &quot;2&quot;) then<br />
&nbsp; if (&quot;${potential_type}&quot; == &quot;eam&quot;) then<br />
&nbsp; &nbsp; makeapot -g -n 2 -i eam -f &quot;3*morse_sc,2*csw2_sc,2*bjs&quot; | tee ${filename}.pot<br />
&nbsp; else if (&quot;${potential_type}&quot; == &quot;adp&quot;) then<br />
&nbsp; &nbsp; makeapot -g -n 2 -i adp -f &quot;3*eopp_sc,2*csw2_sc,2*bjs,6*csw2_sc&quot; | tee ${filename}.pot<br />
&nbsp; #else if (&quot;${potential_type}&quot; == &quot;stiweb&quot;) then<br />
&nbsp; # &nbsp;makeapot -g -n 2 -i stiweb | tee ${filename}.pot<br />
&nbsp; #else if (&quot;${potential_type}&quot; == &quot;tersoff&quot;) then<br />
&nbsp; # &nbsp;makeapot -g -n 2 -i tersoff | tee ${filename}.pot<br />
&nbsp; endif<br />
else if (&quot;${total_num_elements}&quot; == &quot;3&quot;) then<br />
&nbsp; if (&quot;${potential_type}&quot; == &quot;eam&quot;) then<br />
&nbsp; &nbsp; makeapot -g -n 3 -i eam -f &quot;6*morse,3*csw2,3*bjs&quot; | tee ${filename}.pot<br />
&nbsp; else if (&quot;${potential_type}&quot; == &quot;adp&quot;) then<br />
&nbsp; &nbsp; makeapot -g -n 3 -i adp -f &quot;6*eopp_sc,3*csw2_sc,3*bjs,12*csw2_sc&quot; | tee ${filename}.pot<br />
&nbsp; #else if (&quot;${potential_type}&quot; == &quot;stiweb&quot;) then<br />
&nbsp; # &nbsp;makeapot -g -n 3 -i stiweb | tee ${filename}.pot<br />
&nbsp; #else if (&quot;${potential_type}&quot; == &quot;tersoff&quot;) then<br />
&nbsp; # &nbsp;makeapot -g -n 3 -i tersoff | tee ${filename}.pot<br />
&nbsp; endif<br />
endif<br />
<br />
potfit_setup -c ${filename}.config -p ${filename}.pot -s ${filename} | tee param_file<br />
$HOME/potfit/util/correct_config ${filename}<br />
if (&quot;${num_core_potfit}&quot; == &quot;1&quot;) then<br />
&nbsp; potfit_apot_${potential_type}_mkl_stress param_file<br />
else<br />
&nbsp; mpirun -np ${num_core_potfit} potfit_apot_${potential_type}_mkl_mpi_stress param_file<br />
endif<br />
-----<br />
2. sed -i &#39;s/\r//g&#39; run_pwscf_md_potfit_m<br />
&nbsp; (sudo apt install nkf)<br />
&nbsp; (nkf -Lu --in-place run_pwscf_md_potfit_m)<br />
3. chmod +x run_pwscf_md_potfit_m<br />
4. export OMP_NUM_THREADS=1<br />
5. ./run_pwscf_md_potfit_m Al 1 eam 1 3 298<br />
&nbsp; (e.g., Al, 1 element, EAM potential, 1 point, supercell 3x3x3, 298 K)<br />
&nbsp; or<br />
&nbsp; ./run_pwscf_md_potfit_m Al 1 eam 3 3 298<br />
&nbsp; (e.g., Al, 1 element, EAM potential, 3 point, supercell 3x3x3, 298 K)<br />
&nbsp; or<br />
&nbsp; ./run_pwscf_md_potfit_m Mg_H 2 eam 1 1 298<br />
&nbsp; (e.g., Mg_H, 2 element, EAM potential, 1 point, supercell 1x1x1, 298 K)<br />
&nbsp; or<br />
&nbsp; ./run_pwscf_md_potfit_m Mg_H 2 adp 1 1 298<br />
&nbsp; (e.g., Mg_H, 2 element, ADP potential, 1 point, supercell 1x1x1, 298 K)<br />
&nbsp; or<br />
&nbsp; ./run_pwscf_md_potfit_m Mg_Ni_H 3 eam 3 1 298<br />
&nbsp; (e.g., Mg_Ni_H, 3 element, EAM potential, 3 point, supercell 1x1x1, 298 K)<br />
&nbsp; or<br />
&nbsp; ./run_pwscf_md_potfit_m Mg_Ni_H 3 adp 3 1 298<br />
&nbsp; (e.g., Mg_Ni_H, 3 element, ADP potential, 3 point, supercell 1x1x1, 298 K)<br />
<br />
※ PWscf (*.*.out) &gt; potfit &gt; making EAM or ADP potentials &gt; lammps<br />
※ https://software.intel.com/en-us/mkl (from 2015/Aug/31))<br />
&nbsp; Intel MKL は 2015年8月31日から無償で利用できるようになった。OpenBLASやNetlib, ACMLが利用できない場合は特に助かる。AMDのCPUの場合はOpenBLASの選択はいまだに外せない？<br />
※ keyword &quot;write_lammps 1&quot; output &quot;pair&quot;, &quot;sw&quot;, &quot;tersoff&quot;, &quot;eam&quot; or &quot;adp&quot;<br />
&nbsp; see http://www.cmsm.iis.u-tokyo.ac.jp/documents/ポテンシャル関数について_2018_01.pdf (Japanese)<br />
[8] Potentials generated with potfit (https://www.potfit.net/wiki/doku.php?id=potentials:main) では準結晶のAl-Mn-PdやAl-Co-Niの例もあって驚く。準結晶に対してEAMで論文が出ているのは嬉しい。SiO2やAl2O3, MgOはdipoleで作られて検討されている。<br />
------------------------------------------------------------------------------<br />
■ References<br />
<br />
[1] 原子間ポテンシャルについて<br />
&nbsp; http://www.cmsm.iis.u-tokyo.ac.jp/documents/ポテンシャル関数について_2018_01.pdf<br />
[2] 解析的に求めたEAMポテンシャルの力の実装<br />
[3] 固体系における原子間ポテンシャルパラメータ最適化ソフトウェアの開発<br />
&nbsp; https://www.jstage.jst.go.jp/article/kikaia/77/783/77_783_2026/_pdf/-char/ja<br />
[4] 分子動力学法における原子間ポテンシャルパラメー タの最適化<br />
[5] アモルファス金属に対する経験的原子間ポテンシャルの適用性評価&nbsp;<br />
&nbsp; http://www.fml.t.u-tokyo.ac.jp/img/graduation-thesis/2006m_nikkuni.pdf<br />
[6] CFDEMproject/LAMMPS<br />
&nbsp; https://github.com/CFDEMproject/LAMMPS/tree/master/tools/eam_database<br />
[7] NIST (Interatomic Potentials Repository)<br />
&nbsp; https://www.ctcms.nist.gov/potentials/system/Pt/<br />
[8] lammps / potentials / W_zhou.eam.alloy<br />
&nbsp; https://github.com/lammps/lammps/blob/master/potentials/W_zhou.eam.alloy<br />
[9] Zhou X. W., R. A. Johnson, and H. N. G. Wadley, Phys. Rev. B. 69, 144113 (2004)<br />
[10] &nbsp;X. W. Zhou, H. N. G. Wadley, R. A. Johnson, D. J. Larson, N. Tabat, A. Cerezo, A. K. Petford-Long, G. D. W. Smith, P. H. Clifton, R. L. Martens, and T. F. Kelly, Acta Mater. 49, 4005 (2001).<br />
[11] &nbsp;H. N. G. Wadley, X. Zhou, R. A. Johnson, and M. Neurock, Prog. Mater. Sci. 46, 329 (2001).<br />
[12] [9.8. eam database tool] and [9.9. eam generate tool]<br />
&nbsp; http://www.afs.enea.it/software/lammps/doc17/html/Section_tools.html<br />
------------------------------------------------------------------------------<br />
■ appendix<br />
<br />
◇ pslibrary<br />
(https://dalcorso.github.io/pslibrary/)<br />
0. cp ~/q-e-qe-*<br />
&nbsp; make ld1<br />
&nbsp; cd ~<br />
1. mkdir PSLibrary<br />
2. cd PSLibrary<br />
3. wget https://people.sissa.it/dalcorso/pslibrary/pslibrary.1.0.0.tar.gz<br />
4. tar zxvf pslibrary.1.0.0.tar.gz<br />
5. cd pslibrary.1.0.0<br />
6. gedit QE_path<br />
-----<br />
#!/bin/bash<br />
<br />
PWDIR=$HOME/q-e-qe-*<br />
-----<br />
7. ./make_all_ps<br />
8. cd pbe<br />
9. cd PSEUDOPOTENTIALS<br />
(10. cp *.UPF ~/PSLibrary/)<br />
(11. cd ~/PSLibrary)<br />
(12. mkdir work)<br />
(13. ./run_isolated_atom)<br />
<br />
(output force and stress)<br />
◇ run_pwscf<br />
1. gedit run_pwscf<br />
-----<br />
#! /bin/csh -f<br />
<br />
set cif_list = `ls *.cif`<br />
foreach cif_name (${cif_list})<br />
<br />
&nbsp; set cif_folder_name = `echo $cif_name:r`<br />
&nbsp; echo -n &quot;&quot; &gt; ${cif_folder_name}-DFT<br />
<br />
&nbsp; set i = 1<br />
&nbsp; while($i &lt;= $1)<br />
&nbsp; &nbsp; set scale = `echo &quot;0.98 + 0.02/(($1+1)/2)*$i&quot; | bc -l | awk &#39;{printf &quot;%5.3f&quot;,$0}&#39;`<br />
&nbsp; &nbsp; rm -f -r ${cif_folder_name}_${scale}<br />
&nbsp; &nbsp; mkdir ${cif_folder_name}_${scale}<br />
&nbsp; &nbsp; cd ./${cif_folder_name}_${scale}<br />
&nbsp; &nbsp; cp ../${cif_name} ./<br />
&nbsp; &nbsp; cif2cell -p pwscf --pwscf-pseudo-PSLibrary-libdr=$HOME/PSLibrary --pwscf-bin-dir=$HOME/q-e-qe-\*/bin --setup-all --k-resolution=0.48 --pwscf-spin=no --pwscf-run-type=scf -f ${cif_name}<br />
<br />
&nbsp; &nbsp; sed -i &#39;2i tstress = .true. ,&#39; ${cif_folder_name}.scf.in<br />
&nbsp; &nbsp; sed -i &#39;2i tprnfor = .true. ,&#39; ${cif_folder_name}.scf.in<br />
<br />
&nbsp; &nbsp; cp ${cif_folder_name}.scf.in tmp.scf.in<br />
<br />
&nbsp; &nbsp; set A_line = `grep -n &quot;A =&quot; tmp.scf.in | sed -e &#39;s/:.*//g&#39;`<br />
&nbsp; &nbsp; set A = `awk -v A_line=${A_line} &#39;NR==A_line{printf &quot;%9.5f&quot;,$3}&#39; tmp.scf.in`<br />
&nbsp; &nbsp; awk -v A_line=${A_line} -v scale=${scale} &#39;{if(NR==A_line){printf &quot; &nbsp; A = %9.5f \n&quot;,$3*scale}else{printf &quot;%s \n&quot;,$0}}&#39; tmp.scf.in &gt; ${cif_folder_name}.scf.in<br />
&nbsp; &nbsp; #set cell_param_line = `grep -n &quot;CELL_PARAMETERS&quot; tmp.scf.in | sed -e &#39;s/:.*//g&#39;`<br />
&nbsp; &nbsp; #awk -v cpl=${cell_param_line} -v scale=${scale} &#39;{if(cpl&lt;NR &amp;&amp; NR&lt;cpl+4){printf &quot; %19.15f %19.15f %19.15f \n&quot;,$1*scale,$2*scale,$3*scale}else{printf &quot;%s \n&quot;,$0}}&#39; &gt; ${cif_folder_name}.scf.in<br />
&nbsp; &nbsp; set LA = `echo &quot;${A}*${scale}*0.52918&quot; | bc -l | awk &#39;{printf &quot;%15.10f&quot;,$0}&#39;`<br />
<br />
&nbsp; &nbsp; mpirun -np 4 $HOME/q-e-qe-*/bin/pw.x &lt; ${cif_folder_name}.scf.in | tee ${cif_folder_name}.scf.out<br />
<br />
&nbsp; &nbsp; set TOTEN_Ry = `grep &quot; &nbsp;total energy &nbsp;&quot; ${cif_folder_name}.scf.out | tail -1 | sed &#39;s/.*=//g&#39; | sed &#39;s/Ry//g&#39;`<br />
&nbsp; &nbsp; set TOTEN = `echo &quot;${TOTEN_Ry}*13.6058&quot; | bc -l | awk &#39;{printf &quot;%15.10f&quot;,$0}&#39;`<br />
<br />
&nbsp; &nbsp; cd ..<br />
&nbsp; &nbsp; echo &quot;${LA} ${TOTEN}&quot; &gt;&gt; ${cif_folder_name}-DFT<br />
<br />
&nbsp; &nbsp; @ i = $i + 1<br />
&nbsp; end<br />
&nbsp; echo &quot;----------&quot;<br />
&nbsp; echo ${cif_folder_name}-DFT<br />
&nbsp; echo &quot;lattice constant A (Angstrom) | total energy (eV)&quot;<br />
&nbsp; cat ${cif_folder_name}-DFT<br />
end<br />
-----<br />
2. sed -i &#39;s/\r//g&#39; run_pwscf<br />
&nbsp; (sudo apt install nkf)<br />
&nbsp; (nkf -Lu --in-place run_pwscf)<br />
3. chmod +x run_pwscf<br />
4. ./run_pwscf 3<br />
&nbsp; (need odd number)<br />
&nbsp; (e.g., 3 point output)<br />
------------------------------------------------------------------------------<br />
&nbsp;