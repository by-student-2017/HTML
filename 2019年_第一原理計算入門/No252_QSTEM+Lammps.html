QSTEM (https://lammps.sandia.gov/)<br />
------------------------------------------------------------------------------<br />
Å° QSTEM (Ubuntu 18.04 LTS (64 bit)) (cfg file)<br />
<br />
Å† cfg_qsc2lmp_data<br />
1. gedit cfg_qsc2lmp_data<br />
---------<br />
#! /bin/csh -f<br />
set filename = $1<br />
cp ${filename}.cfg tmp.cfg<br />
echo &quot;#title: ${filename}.cfg &quot; &gt; tmp.data<br />
echo &quot; &quot; &gt;&gt; tmp.data<br />
awk -v n=1 &#39;NR==1{printf &quot;%d atoms \n&quot;,($5)*n}&#39; tmp.cfg &gt;&gt; tmp.data<br />
#<br />
set element_list = (H He Li Be B C N O F Ne Na Mg Al Si P S Cl Ar K Ca Sc Ti V Cr Mn Fe Co Ni Cu Zn Ga Ge As Se Br Kr Rb Sr Y Zr Nb Mo Tc Ru Rh Pd Ag Cd In Sn Sb Te I Xe Cs Ba La Ce Pr Nd Pm Sm Eu Gd Tb Dy Ho Er Tm Yb Lu Hf Ta W Re Os Ir Pt Au Hg Tl Pb Bi Po At Rn Fr Ra Ac Th Pa U Np Pu Am Cm Bk Cf Es Fm Md No Lr Rf Df Sg Bh Hs Mt Ds Rg Cn Nh Fl Mc Lv Ts Og)<br />
#<br />
set mass_list = (1.00794 4.00260 6.941 9.01218 10.81 12.0107 14.007 16.00 18.9984 20.180 22.99 24.305 26.98 28.1 30.97 32.1 35.45 39.95 39.10 40.08 44.955912 47.867 50.9415 51.9961 54.938045 55.845 58.933195 58.6934 63.546 65.38 69.723 72.63 74.92160 78.96 79.904 83.798 85.4678 87.62 88.90585 91.224 92.90638 95.96 98 101.07 102.90550 106.42 107.8682 112.411 114.818 118.710 121.760 127.60 126.90447 131.293 132.9054519 137.33 138.90547 140.116 140.90765 144.242 145 150.36 151.964 157.25 158.92535 162.500 164.93032 167.259 168.93421 173.054 174.9668 178.49 180.94788 183.84 186.207 190.23 192.217 195.084 196.966569 200.59 204.3833 207.2 208.98040 209 210 222 223 226 227 232.0381 231.03588 238.02891 237 244 243 247 247 251 252 257 258 259 262 261.11 268 271 270 269 278 281 281 285 286 289 289 293 294 294)<br />
#<br />
set element_flag = (0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0)<br />
#<br />
set i = 1<br />
set j = 1<br />
foreach atom ($element_list)<br />
&nbsp; set element_flag[$i] = `tail -n +13 tmp.cfg | grep -e ${atom} -n | sed -e &#39;s/:.*//g&#39;`<br />
&nbsp; if ($element_flag[$i] &gt; 0) then<br />
&nbsp; &nbsp; @ j += 1<br />
&nbsp; endif<br />
&nbsp; @ i += 1<br />
end<br />
@ j += -1<br />
set max_atom_types = $j<br />
echo ${max_atom_types}&quot; atom types&quot; &gt;&gt; tmp.data<br />
echo &quot; &quot; &gt;&gt; tmp.data<br />
#<br />
set lattice_unit = `awk &#39;NR==2{print $3}&#39; tmp.cfg`<br />
set La = `awk -v n=${lattice_unit} &#39;NR==3{printf &quot;%10.6f&quot;,($3)*n}&#39; tmp.cfg`<br />
set Lb = `awk -v n=${lattice_unit} &#39;NR==7{printf &quot;%10.6f&quot;,($3)*n}&#39; tmp.cfg`<br />
set Lc = `awk -v n=${lattice_unit} &#39;NR==11{printf &quot;%10.6f&quot;,($3)*n}&#39; tmp.cfg`<br />
awk -v a=${La} &#39;NR==3{printf &quot;0.0 %10.6f xlo xhi \n&quot;,a}&#39; tmp.cfg &gt;&gt; tmp.data<br />
awk -v b=${Lb} &#39;NR==7{printf &quot;0.0 %10.6f ylo yhi \n&quot;,b}&#39; tmp.cfg &gt;&gt; tmp.data<br />
awk -v c=${Lc} &#39;NR==11{printf &quot;0.0 %10.6f zlo zhi \n&quot;,c}&#39; tmp.cfg &gt;&gt; tmp.data<br />
echo &quot; &quot; &gt;&gt; tmp.data<br />
#<br />
echo &quot;Masses &quot; &gt;&gt; tmp.data<br />
echo &quot; &quot; &gt;&gt; tmp.data<br />
set i = 1<br />
set j = 1<br />
foreach atom ($element_list)<br />
&nbsp; set element_flag[$i] = `tail -n +13 tmp.cfg | grep -e ${atom} -n | sed -e &#39;s/:.*//g&#39;`<br />
&nbsp; if ($element_flag[$i] &gt; 0) then<br />
&nbsp; &nbsp; echo $j&quot; &quot;$mass_list[$i]&quot; # &quot;${atom} &gt;&gt; tmp.data<br />
&nbsp; &nbsp; @ j += 1<br />
&nbsp; endif<br />
&nbsp; @ i += 1<br />
end<br />
echo &quot; &quot; &gt;&gt; tmp.data<br />
#<br />
echo &quot;Atoms &quot; &gt;&gt; tmp.data<br />
echo &quot; &quot; &gt;&gt; tmp.data<br />
set i = 1<br />
set j = 0<br />
set start_line = 13<br />
set element = &quot;H&quot;<br />
foreach atom ($element_list)<br />
&nbsp; if ($element_flag[$i] &gt; 0) then<br />
&nbsp; &nbsp; set end_line = `echo $element_flag[$i]&quot;+10&quot; | bc -l`<br />
&nbsp; &nbsp; if ($j &gt;= 1) then<br />
&nbsp; &nbsp; &nbsp; echo $j&quot; &quot;$element&quot; &quot;$start_line&quot; &quot;$end_line<br />
&nbsp; &nbsp; &nbsp; awk -v sln=$start_line -v eln=$end_line -v no=$j -v a=$La -v b=$Lb -v c=$Lc &#39;(NR&gt;=sln &amp;&amp; NR&lt;=eln){printf &quot;%d %d %8.6f %8.6f %8.6f \n&quot;,(NR-15-(no-1)*2),no,($1-int($1))*a,($2-int($2))*b,($3-int($3))*c}&#39; tmp.cfg &gt;&gt; tmp.data<br />
&nbsp; &nbsp; endif<br />
&nbsp; &nbsp; @ j += 1<br />
&nbsp; &nbsp; set start_line = `echo $end_line&quot;+3&quot; | bc -l`<br />
&nbsp; &nbsp; set element = $atom<br />
&nbsp; endif<br />
&nbsp; @ i += 1<br />
end<br />
set end_line = `awk &#39;END{print NR}&#39; tmp.cfg`<br />
echo $j&quot; &quot;$element&quot; &quot;$start_line&quot; &quot;$end_line<br />
awk -v sln=$start_line -v eln=$end_line -v no=$j -v a=$La -v b=$Lb -v c=$Lc &#39;(NR&gt;=sln &amp;&amp; NR&lt;=eln){printf &quot;%d %d %8.6f %8.6f %8.6f \n&quot;,(NR-15-(no-1)*2),no,($1-int($1))*a,($2-int($2))*b,($3-int($3))*c}&#39; tmp.cfg &gt;&gt; tmp.data<br />
echo &quot; &quot; &gt;&gt; tmp.data<br />
#<br />
mv tmp.data ${filename}.data<br />
rm -f -r tmp.cfg<br />
#<br />
# data<br />
#set rev_mass_list = (294 294 293 289 289 286 285 281 281 278 269 270 271 268 261.11 262 259 258 257 252 251 247 247 243 244 237 238.02891 231.03588 232.0381 227 226 223 222 210 209 208.98040 207.2 204.3833 200.59 196.966569 195.084 192.217 190.23 186.207 183.84 180.94788 178.49 174.9668 173.054 168.93421 167.259 164.93032 162.500 158.92535 157.25 151.964 150.36 145 144.242 140.90765 140.116 138.90547 137.33 132.9054519 131.293 126.90447 127.60 121.760 118.710 114.818 112.411 107.8682 106.42 102.90550 101.07 98 95.96 92.90638 91.224 88.90585 87.62 85.4678 83.798 79.904 78.96 74.92160 72.63 69.723 65.38 63.546 58.6934 58.933195 55.845 54.938045 51.9961 50.9415 47.867 44.955912 40.08 39.10 39.95 35.45 32.1 30.97 28.1 26.98 24.305 22.99 20.180 18.9984 16.00 14.007 12.01 10.81 9.01218 6.941 4.00260 1.00794)<br />
#<br />
#set rev_element_list = (Og Ts Lv Mc Fl Nh Cn Rg Ds Mt Hs Bh Sg Df Rf Lr No Md Fm Es Cf Bk Cm Am Pu Np U Pa Th Ac Ra Fr Rn At Po Bi Pb Tl Hg Au Pt Ir Os Re W Ta Hf Lu Yb Tm Er Ho Dy Tb Gd Eu Sm Pm Nd Pr Ce La Ba Cs Xe I Te Sb Sn In Cd Ag Pd Rh Ru Tc Mo Nb Zr Y Sr Rb Kr Br Se As Ge Ga Zn Cu Ni Co Fe Mn Cr V Ti Sc Ca K Ar Cl S P Si Al Mg Na Ne F O N C B Be Li He H)<br />
#<br />
---------<br />
2. sed -i &#39;s/\r//g&#39; cfg_qsc2lmp_data<br />
&nbsp; (sudo apt install nkf)<br />
&nbsp; (nkf -Lu --in-place cfg_qsc2lmp_data)<br />
3. chmod +x cfg_qsc2lmp_data<br />
4. ./cfg_qsc2lmp_data case<br />
Å¶ e.g., case.cfg<br />
<br />
Å† lammps input file&nbsp;<br />
0. mkdir cfg<br />
1. gedit in.lmp<br />
---------<br />
clear<br />
# ----- Structure settings -----<br />
units metal<br />
atom_style atomic<br />
dimension &nbsp;3<br />
boundary &nbsp; p p p<br />
read_data &nbsp;msc30.data<br />
replicate &nbsp;1 1 1<br />
<br />
mass 1 &nbsp;1.0080 # H<br />
mass 2 12.0110 # C<br />
<br />
# ----- Potential settings -----<br />
pair_style airebo 3.0 1 1<br />
pair_coeff * * CH.airebo H C<br />
<br />
# ----- Relax calculation (0 K) -----<br />
thermo_style custom step etotal temp lx vol press atoms<br />
thermo 100<br />
fix f1 all box/relax iso 0.0<br />
minimize 1.0e-10 0.0 1000 10000<br />
unfix f1<br />
<br />
# output setting<br />
dump &nbsp; &nbsp; &nbsp; &nbsp;d1 all cfg 100 cfg/run.*.cfg mass type xs ys zs id type<br />
dump_modify d1 element H C<br />
<br />
velocity all create 10.0 139466 dist gaussian<br />
fix f1 all nvt temp 10.0 298.0 0.01<br />
run 1000<br />
unfix f1<br />
<br />
# output setting<br />
dump &nbsp; &nbsp; &nbsp; &nbsp;fqstem all cfg 1 case.*.cfg mass type xs ys zs # qstem cfg format<br />
dump_modify fqstem element H C<br />
run 1<br />
<br />
write_data out.data<br />
---------<br />
<br />
Å† lammps input file (fix lattice constant case)<br />
0. mkdir cfg<br />
1. gedit in.lmp<br />
---------<br />
clear<br />
# ----- Structure settings -----<br />
units metal<br />
atom_style atomic<br />
dimension &nbsp;3<br />
boundary &nbsp; p p p<br />
read_data &nbsp;case.data<br />
replicate &nbsp;1 1 1<br />
<br />
mass 1 &nbsp;1.0080 # H<br />
mass 2 12.0110 # C<br />
<br />
# ----- Potential settings -----<br />
pair_style airebo 3.0 1 1<br />
pair_coeff * * CH.airebo H C<br />
<br />
# ----- Relax calculation (0 K) -----<br />
thermo_style custom step etotal temp lx vol press atoms<br />
thermo 100<br />
#fix f1 all box/relax iso 0.0<br />
minimize 1.0e-10 0.0 1000 1000<br />
#unfix f1<br />
<br />
# output setting<br />
dump &nbsp; &nbsp; &nbsp; &nbsp;d1 all cfg 100 cfg/run.*.cfg mass type xs ys zs id type<br />
dump_modify d1 element H C<br />
<br />
velocity all create 10.0 139466 dist gaussian<br />
fix f1 all nvt temp 10.0 298.0 0.01<br />
run 1000<br />
<br />
# output setting<br />
dump &nbsp; &nbsp; &nbsp; &nbsp;fqstem all cfg 1 case.*.cfg mass type xs ys zs # qstem cfg format<br />
dump_modify fqstem element H C<br />
run 1<br />
<br />
write_data out.data<br />
---------<br />
<br />
Å† lmp_cfg2cfg_qsc (from dump file)<br />
1. gedit lmp_cfg2cfg_qsc<br />
---------<br />
#! /bin/csh -f<br />
set filename = $1<br />
cp ${filename}.cfg tmp.cfg<br />
#<br />
set x = `awk &#39;{if($1 == &quot;H0(1,1)&quot;){print $3 }}&#39; tmp.cfg`<br />
set y = `awk &#39;{if($1 == &quot;H0(2,2)&quot;){print $3 }}&#39; tmp.cfg`<br />
set z = `awk &#39;{if($1 == &quot;H0(3,3)&quot;){print $3 }}&#39; tmp.cfg`<br />
#<br />
sed -n &#39;1,12p&#39; tmp.cfg &gt; tmp_final.cfg<br />
tail -n +14 tmp.cfg &gt; tmp1.xyz<br />
echo &quot;entry_count = 5&quot; &gt;&gt; tmp_final.cfg<br />
#<br />
set element_list = (H He Li Be B C N O F Ne Na Mg Al Si P S Cl Ar K Ca Sc Ti V Cr Mn Fe Co Ni Cu Zn Ga Ge As Se Br Kr Rb Sr Y Zr Nb Mo Tc Ru Rh Pd Ag Cd In Sn Sb Te I Xe Cs Ba La Ce Pr Nd Pm Sm Eu Gd Tb Dy Ho Er Tm Yb Lu Hf Ta W Re Os Ir Pt Au Hg Tl Pb Bi Po At Rn Fr Ra Ac Th Pa U Np Pu Am Cm Bk Cf Es Fm Md No Lr Rf Df Sg Bh Hs Mt Ds Rg Cn Nh Fl Mc Lv Ts Og)<br />
#<br />
set mass_list = (1.00794 4.00260 6.941 9.01218 10.81 12.01 14.007 16.00 18.9984 20.180 22.99 24.305 26.98 28.1 30.97 32.1 35.45 39.95 39.10 40.08 44.955912 47.867 50.9415 51.9961 54.938045 55.845 58.933195 58.6934 63.546 65.38 69.723 72.63 74.92160 78.96 79.904 83.798 85.4678 87.62 88.90585 91.224 92.90638 95.96 98 101.07 102.90550 106.42 107.8682 112.411 114.818 118.710 121.760 127.60 126.90447 131.293 132.9054519 137.33 138.90547 140.116 140.90765 144.242 145 150.36 151.964 157.25 158.92535 162.500 164.93032 167.259 168.93421 173.054 174.9668 178.49 180.94788 183.84 186.207 190.23 192.217 195.084 196.966569 200.59 204.3833 207.2 208.98040 209 210 222 223 226 227 232.0381 231.03588 238.02891 237 244 243 247 247 251 252 257 258 259 262 261.11 268 271 270 269 278 281 281 285 286 289 289 293 294 294)<br />
#<br />
set ion_charge_list = (1.0 0.0 1.0 2.0 0.0 0.0 -3.0 -2.0 -1.0 0.0 1.0 2.0 3.0 0.0 -3.0 -2.0 -1.0 0.0 1.0 2.0 3.0 4.0 3.0 3.0 2.0 3.0 2.0 2.0 2.0 2.0 3.0 4.0 -3.0 -2.0 -1.0 0.0 1.0 2.0 3.0 4.0 5.0 6.0 7.0 3.0 3.0 2.0 1.0 2.0 3.0 4.0 3.0 -2.0 -1.0 0.0 1.0 2.0 3.0 3.0 3.0 3.0 3.0 3.0 3.0 3.0 3.0 3.0 3.0 3.0 3.0 3.0 3.0 4.0 5.0 6.0 7.0 4.0 4.0 4.0 3.0 2.0 1.0 2.0 3.0 2.0 1.0 0.0 1.0 2.0 3.0 4.0 5.0 6.0 5.0 4.0 3.0 3.0 3.0 3.0 3.0 3.0 2.0 2.0 3.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0)<br />
# https://www.sciencegeek.net/tables/PT_ions.pdf<br />
#<br />
set count = 1<br />
foreach atom ($element_list)<br />
&nbsp; set num = `grep -c -i ${atom} tmp1.xyz`<br />
&nbsp; if (${num} &gt; 0) then<br />
&nbsp; &nbsp; #echo ${num}<br />
&nbsp; &nbsp; #echo ${count}<br />
&nbsp; &nbsp; set mass = `echo $mass_list[$count] | awk &#39;{printf(&quot;%d&quot;,$1+0.5)}&#39;`<br />
&nbsp; &nbsp; echo ${mass} &gt;&gt; tmp_final.cfg<br />
&nbsp; &nbsp; echo ${atom} &gt;&gt; tmp_final.cfg<br />
&nbsp; &nbsp; grep -A 1 ${atom} tmp1.xyz | sed -e &quot;s/${atom}.*//g&quot; -e &#39;s/--//g&#39; | sed &#39;/^$/d&#39; &gt; tmp2.xyz<br />
&nbsp; &nbsp; awk -v mass=${mass} &#39;{printf &quot;%12.6f %12.6f %12.6f %12.6f &nbsp; &nbsp;1.000000 \n&quot;, $1, $2, $3,((0.45*28)/mass)}&#39; tmp2.xyz &gt;&gt; tmp_final.cfg<br />
&nbsp; &nbsp; endif<br />
&nbsp; endif<br />
&nbsp; @ count += 1<br />
end<br />
#<br />
rm -f -r tmp1.xyz tmp2.xyz<br />
mv tmp_final.cfg ${filename}.cfg<br />
#<br />
# calculate number of slices<br />
set thickness = ${z}<br />
#<br />
set slices = `echo ${thickness} | awk &#39;{printf(&quot;%d&quot;,$1/2.0+0.5)}&#39;`<br />
set slice_thickness = `echo &quot;${thickness} ${slices}&quot; | awk &#39;{printf(&quot;%f&quot;,$1/$2)}&#39;`<br />
#echo ${thickness}<br />
#echo ${slices}<br />
#<br />
if (&quot;$2&quot; == &quot;-kv&quot;) then<br />
&nbsp; set v0 = `echo $3 | awk &#39;{printf(&quot;%11.6f&quot;,$1)}&#39;`<br />
else if (&quot;$3&quot; == &quot;-kv&quot;) then<br />
&nbsp; set v0 = `echo $4 | awk &#39;{printf(&quot;%11.6f&quot;,$1)}&#39;`<br />
else if (&quot;$4&quot; == &quot;-kv&quot;) then<br />
&nbsp; set v0 = `echo $5 | awk &#39;{printf(&quot;%11.6f&quot;,$1)}&#39;`<br />
else if (&quot;$5&quot; == &quot;-kv&quot;) then<br />
&nbsp; set v0 = `echo $6 | awk &#39;{printf(&quot;%11.6f&quot;,$1)}&#39;`<br />
else if (&quot;$6&quot; == &quot;-kv&quot;) then<br />
&nbsp; set v0 = `echo $7 | awk &#39;{printf(&quot;%11.6f&quot;,$1)}&#39;`<br />
else if (&quot;$7&quot; == &quot;-kv&quot;) then<br />
&nbsp; set v0 = `echo $8 | awk &#39;{printf(&quot;%11.6f&quot;,$1)}&#39;`<br />
else if (&quot;$8&quot; == &quot;-kv&quot;) then<br />
&nbsp; set v0 = `echo $9 | awk &#39;{printf(&quot;%11.6f&quot;,$1)}&#39;`<br />
else<br />
&nbsp; set v0 = 200.000000<br />
endif<br />
set lambda = `echo ${v0} | awk &#39;{printf(&quot;%12.10f&quot;,12.26/10.0/(($1*10^3*(1+0.9788*10^-3*$1))^(1/2)))}&#39;`<br />
set defocus = `echo ${lambda} | awk &#39;{printf(&quot;%f&quot;,-1.2*(1.0*$1)^(1/2)*1000)}&#39;`<br />
#echo ${lambda}<br />
#echo ${defocus}<br />
set resolutionX = `echo ${x} | awk &#39;{printf(&quot;%f&quot;,$1/256)}&#39;`<br />
set resolutionY = `echo ${y} | awk &#39;{printf(&quot;%f&quot;,$1/256)}&#39;`<br />
#<br />
if (&quot;$2&quot; == &quot;-autoz&quot; || &quot;$3&quot; == &quot;-autoz&quot; || &quot;$4&quot; == &quot;-autoz&quot; || &quot;$5&quot; == &quot;-autoz&quot; || &quot;$6&quot; == &quot;-autoz&quot; || &quot;$7&quot; == &quot;-autoz&quot; || &quot;$8&quot; == &quot;-autoz&quot; || &quot;$9&quot; == &quot;-autoz&quot; || &quot;${10}&quot; == &quot;-autoz&quot;) then<br />
&nbsp; set zOffset = `echo ${slice_thickness} | awk &#39;{printf(&quot;%f&quot;,$1/2)}&#39;`<br />
else<br />
&nbsp; set zOffset = 0.000000<br />
endif<br />
<br />
if (&quot;$2&quot; == &quot;-lab6&quot; || &quot;$3&quot; == &quot;-lab6&quot; || &quot;$4&quot; == &quot;-lab6&quot; || &quot;$5&quot; == &quot;-lab6&quot; || &quot;$6&quot; == &quot;-lab6&quot; || &quot;$7&quot; == &quot;-lab6&quot; || &quot;$8&quot; == &quot;-lab6&quot; || &quot;$9&quot; == &quot;-lab6&quot; || &quot;${10}&quot; == &quot;-lab6&quot;) then<br />
&nbsp; set dVV = `echo ${v0} | awk &#39;{printf(&quot;%f&quot;,1.5/($1*1000))}&#39;`<br />
&nbsp; set Cs &nbsp;= 1.00000<br />
&nbsp; set Cc &nbsp;= 1.400000<br />
&nbsp; set alpha = 15.0 # 1.5 - 20 [mrad]<br />
&nbsp; set Source_Size = 10<br />
&nbsp; set beam_current = 20<br />
else if (&quot;$2&quot; == &quot;-fe&quot; || &quot;$3&quot; == &quot;-fe&quot; || &quot;$4&quot; == &quot;-fe&quot; || &quot;$5&quot; == &quot;-fe&quot; || &quot;$6&quot; == &quot;-fe&quot; || &quot;$7&quot; == &quot;-fe&quot; || &quot;$8&quot; == &quot;-fe&quot; || &quot;$9&quot; == &quot;-fe&quot; || &quot;${10}&quot; == &quot;-fe&quot;) then<br />
&nbsp; set dVV = `echo ${v0} | awk &#39;{printf(&quot;%f&quot;,0.65/($1*1000))}&#39;`<br />
&nbsp; set Cs &nbsp;= 1.00000<br />
&nbsp; set Cc &nbsp;= 1.400000<br />
&nbsp; set alpha = 1.5 # 1.5 - 20 [mrad]<br />
&nbsp; set Source_Size = 2<br />
&nbsp; set beam_current = 20<br />
else if (&quot;$2&quot; == &quot;-arm&quot; || &quot;$3&quot; == &quot;-arm&quot; || &quot;$4&quot; == &quot;-arm&quot; || &quot;$5&quot; == &quot;-arm&quot; || &quot;$6&quot; == &quot;-arm&quot; || &quot;$7&quot; == &quot;-arm&quot; || &quot;$8&quot; == &quot;-arm&quot; || &quot;$9&quot; == &quot;-arm&quot; || &quot;${10}&quot; == &quot;-arm&quot;) then<br />
&nbsp; set dVV = `echo ${v0} | awk &#39;{printf(&quot;%f&quot;,0.325/($1*1000))}&#39;`<br />
&nbsp; set Cs &nbsp;= 1.00000<br />
&nbsp; set Cc &nbsp;= 1.400000<br />
&nbsp; set alpha = 1.5 # 1.5 - 20 [mrad]<br />
&nbsp; set Source_Size = 1<br />
&nbsp; set beam_current = 20<br />
else<br />
&nbsp; set dVV = 0.000003<br />
&nbsp; set Cs &nbsp;= 1.00000<br />
&nbsp; set Cc &nbsp;= 1.000000<br />
&nbsp; set alpha = 1.5 # 1.5 - 20 [mrad]<br />
&nbsp; set Source_Size = 0<br />
&nbsp; set beam_current = 1<br />
endif<br />
<br />
if (&quot;$2&quot; == &quot;-tds&quot; || &quot;$3&quot; == &quot;-tds&quot; || &quot;$4&quot; == &quot;-tds&quot; || &quot;$5&quot; == &quot;-tds&quot; || &quot;$6&quot; == &quot;-tds&quot; || &quot;$7&quot; == &quot;-tds&quot; || &quot;$8&quot; == &quot;-tds&quot; || &quot;$9&quot; == &quot;-tds&quot; || &quot;${10}&quot; == &quot;-tds&quot;) then<br />
&nbsp; set tds = &quot;yes&quot;<br />
else<br />
&nbsp; set tds = &quot;no&quot;<br />
endif<br />
<br />
cat &lt;&lt; EOF &gt; tem.qsc<br />
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%<br />
% STEM configuration file generated by qstem<br />
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%<br />
<br />
mode: TEM<br />
print level: 4 &nbsp;% indicates how much information in output<br />
save level: &nbsp;3 &nbsp;% indicates how much information shall be saved<br />
filename: ${filename}.cfg<br />
resolutionX: &nbsp;${resolutionX}<br />
resolutionY: &nbsp;${resolutionY}<br />
NCELLX: 1<br />
NCELLY: 1<br />
NCELLZ: 1<br />
v0: ${v0} &nbsp;% beam energy<br />
tds: ${tds} % do NOT include thermal diffuse scattering<br />
temperature: 298.000000 % temperature in Kelvin<br />
slice-thickness: ${slice_thickness} &nbsp;% slice thckness in A<br />
slices: ${slices} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; % number of different slices per slab in z-direction<br />
center slices: no &nbsp; &nbsp; &nbsp; % do not center slices<br />
slices between outputs: 10 &nbsp;% give intermediate results after every 8 slices<br />
xOffset: &nbsp;0.000000 &nbsp; &nbsp; &nbsp;% slize x-position offset in cartesian coords<br />
yOffset: &nbsp;0.000000 &nbsp; &nbsp; &nbsp;% slize y-position offset in cartesian coords<br />
zOffset: &nbsp;${zOffset} &nbsp; &nbsp; &nbsp;% slize z-position offset in cartesian coords<br />
periodicXY: no &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;% not periodic in x- and y-direction<br />
periodicZ: no &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; % not periodic in z-direction<br />
<br />
% Geometrical properties<br />
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%<br />
<br />
Crystal tilt X: 0.000000 &nbsp; &nbsp; &nbsp; &nbsp;% tilt in rad<br />
Crystal tilt Y: 0.000000<br />
Crystal tilt Z: 0.000000<br />
Beam tilt X: 0.0 &nbsp; &nbsp; &nbsp; &nbsp;% beam tilt in mrad<br />
Beam tilt Y: 0.0<br />
Tilt back: no<br />
<br />
% TEM imaging parameters<br />
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%<br />
<br />
nx: 256 &nbsp; &nbsp; &nbsp; &nbsp; % array size used for probe<br />
ny: 256 &nbsp; &nbsp; &nbsp; &nbsp; % ny = nx, if not specified<br />
Cs: ${Cs} &nbsp; &nbsp; &nbsp; % Speherical abberation in mm<br />
C5: 0.000000 &nbsp; &nbsp;% C_5 abberation in mm<br />
Cc: ${Cc} &nbsp; &nbsp; &nbsp; % Chromatic abberation in mm<br />
dV/V: ${dVV} &nbsp; &nbsp;% energy spread in eV (FWHM)<br />
alpha: ${alpha} &nbsp;% Illumination angle in mrad<br />
defocus: ${defocus}<br />
astigmatism: 0.000000<br />
astigmatism angle: 0.000000<br />
<br />
<br />
Source Size (diameter): ${Source_Size} &nbsp;% source size in A<br />
beam current: ${beam_current} &nbsp; &nbsp; &nbsp; &nbsp;% beam current in pA (default: 1)<br />
dwell time: 1000 &nbsp; &nbsp; &nbsp; &nbsp;% dwell time in msec (default: 1) (GUI 1.6021773e-4)<br />
smooth: yes &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; % smoothen edge of probe in rec. space<br />
gaussian: no<br />
% Parameters for potential calculation<br />
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%<br />
<br />
potential3D: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;yes &nbsp;% use 3D or 2D potential (3D realistically simulates z-motion of atoms)<br />
atom radius: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5.0 &nbsp; &nbsp; &nbsp; % radius used for calculation of proj potential V_proj(r)<br />
plot V(r)*r: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;no &nbsp; &nbsp; &nbsp; &nbsp;% will create a plot for V_proj(r)*r vs. r &nbsp;for all slices and 1st atom<br />
bandlimit f_trans: &nbsp; &nbsp;no &nbsp; &nbsp; &nbsp; &nbsp;% indicate whether to band limit transmission function or not<br />
save potential: &nbsp; &nbsp; &nbsp; no &nbsp; &nbsp; &nbsp; &nbsp;% whether we want to save the projected potential in files<br />
save projected potential: &nbsp; &nbsp; &nbsp; yes &nbsp; &nbsp; % whether we want to save the total projected potential<br />
one time integration: yes &nbsp;% calculate V_proj once and then copy (much faster)<br />
Display Gamma: 0 &nbsp; &nbsp; % Gamma value for image scaling (0 = logarithmic)<br />
Folder: &quot;${filename}&quot;<br />
Runs for averaging: 30 &nbsp;% averaging over 30 images for TDS simulation<br />
Structure Factors: WK<br />
show Probe: no &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;% displays a graph of the crosssection of the inc. e-beam<br />
propagation progress interval: 10 % show progress every N_prop_prog beam positions<br />
potential progress interval: 1000 % show progress every N_pot_prog atoms<br />
update Web: no &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;% put results on web page<br />
Pendelloesung plot: no &nbsp;% flag indicates whether to store Pendeloesung plot<br />
sequence: 1 1<br />
EOF<br />
---------<br />
2. sed -i &#39;s/\r//g&#39; lmp_cfg2cfg_qsc<br />
&nbsp; (sudo apt install nkf)<br />
&nbsp; (nkf -Lu --in-place lmp_cfg2cfg_qsc)<br />
3. chmod +x lmp_cfg2cfg_qsc<br />
4. ./lmp_cfg2cfg_qsc case<br />
Å¶ e.g., case.cfg<br />
<br />
Å† fit tem image<br />
1. gedit fit_tem.py<br />
---------<br />
from PIL import Image<br />
import numpy as np<br />
import struct<br />
import random<br />
import commands<br />
<br />
# ----- input parameters ----- start -----<br />
mixing_para = 0.05<br />
max_move_atom_init = 1.0 # Angstrom unit<br />
max_move_atom_low_limit = 0.01 # Angstrom unit<br />
max_move_atom_high_limit = 1.5 # Angstrom unit<br />
<br />
exchange_ratio = 0.001 # exhange element A for element B<br />
<br />
dif_value_limit = 0.7 # exp(0.7) = 2.01<br />
e_atom_limit = 1.1 # evaluate move atom<br />
<br />
cycle_limit = 1.0e-8<br />
reset_value = cycle_limit*1000<br />
<br />
e_ran_low_limit = 0.995 # =&gt; not adopt new position<br />
dif_value_factor = ((256/2)/2)**2<br />
<br />
file_name = &quot;tmp.cfg&quot;<br />
reference_image_file = &quot;reference.png&quot;<br />
im = np.array(Image.open(reference_image_file).convert(&#39;L&#39;),&#39;f&#39;)<br />
# ----- input parameters ----- end -----<br />
commands.getoutput(&quot;cp &quot;+file_name+&quot; tmp.cfg&quot;)<br />
<br />
# ----- auto reading ----- start -----<br />
La = commands.getoutput(&quot;awk &#39;NR==3{printf \&quot;%12.6f \&quot;, $3}&#39; &quot;+file_name)<br />
print &quot;lattice constant a: &quot;, La, &quot; Angstrom&quot;<br />
move_percent = max_move_atom_init / float(La) # [%/100] unit<br />
move_percent_low_limit = max_move_atom_low_limit / float(La) # [%/100] unit<br />
move_percent_high_limit = max_move_atom_high_limit / float(La) # [%/100] unit<br />
# -----<br />
total_char_line = commands.getoutput(&quot;grep -c [A-Za-z] &quot;+file_name)<br />
total_num_char_line = int(total_char_line) - 13<br />
print &quot;total number of elements: &quot;, total_num_char_line<br />
# -----<br />
total_cfg_line = commands.getoutput(&quot;awk &#39;END{print NR}&#39; &quot;+file_name)<br />
total_num_cfg_line = int(total_cfg_line) - 13 - total_num_char_line*2<br />
print &quot;total number of atoms: &quot;, total_num_cfg_line<br />
total_number_of_atoms = total_num_cfg_line<br />
# -----<br />
num_char_line = []<br />
number_of_atoms_temp = []<br />
for i in range(total_num_char_line):<br />
&nbsp; char_line = commands.getoutput(&quot;grep -n [A-Za-z] &quot;+file_name+&quot; | sed -e &#39;s/:.*//g&#39; | sed -ne &#39;&quot;+str(14+i)+&quot;p&#39; &nbsp;| sed -r -e &#39;:loop;N;b loop;s/\\n/ /g&#39; -e &#39;s/ +/ /g&#39;&quot;)<br />
&nbsp; num_char_line.append(int(char_line))<br />
&nbsp; number_of_atoms_temp.append(int(char_line)-13-(i+1)*2)<br />
number_of_atoms_temp.append(total_number_of_atoms)<br />
print &quot;boundary: &quot;, number_of_atoms_temp<br />
# ----- auto reading ----- end -----<br />
<br />
def dif2sum(new_data,reference_data):<br />
&nbsp; return np.sum((new_data - reference_data)**2)<br />
<br />
old_value = float((256-1)^2*2 + (256-1)^2*(256*256-2))<br />
new_value = float((256-128)^2*256*256)<br />
dif_value = (new_value-old_value)/old_value * dif_value_factor<br />
n_ran = 16<br />
e_atom = np.ones(total_number_of_atoms)<br />
start_flag = 1<br />
while (abs(dif_value) &gt; cycle_limit):<br />
&nbsp; commands.getoutput(&quot;cp tmp.cfg case.cfg&quot;)<br />
&nbsp; #<br />
&nbsp; n_ran = n_ran - 15<br />
&nbsp; j = 0<br />
&nbsp; for i in range(1,total_num_char_line):<br />
&nbsp; &nbsp; if (n_ran &gt; (number_of_atoms_temp[i]+2*i)):<br />
&nbsp; &nbsp; &nbsp; j = i<br />
&nbsp; n_ran = n_ran - 2*j<br />
&nbsp; #<br />
&nbsp; e_atom[n_ran] = e_atom[n_ran]*(1.0-mixing_para) + e_atom[n_ran]*np.exp(-dif_value)*mixing_para<br />
&nbsp; if (e_atom[n_ran] &gt;= e_atom_limit):<br />
&nbsp; &nbsp; e_atom[n_ran] = e_atom_limit<br />
&nbsp; &nbsp; print &quot;----- reset e_atom&quot;, e_atom[n_ran]<br />
&nbsp; print &quot;----- move atom number and e_atom parameter value: &quot;, n_ran, e_atom[n_ran]<br />
&nbsp; e_ran = random.uniform(e_ran_low_limit,1.0)<br />
&nbsp; n_ran = random.randrange(1,total_number_of_atoms)<br />
&nbsp; e_atom_ran = random.uniform(0.0,1.0)<br />
&nbsp; while (e_atom[n_ran] &lt; e_atom_ran):<br />
&nbsp; &nbsp; n_ran = random.randrange(1,total_number_of_atoms)<br />
&nbsp; print &quot; &quot;<br />
&nbsp; print &quot;----- new move atom number:&quot;, n_ran<br />
&nbsp; move_percent = move_percent*(1.0-mixing_para) + move_percent*e_atom[n_ran]*mixing_para<br />
&nbsp; if (move_percent &lt;= move_percent_low_limit):<br />
&nbsp; &nbsp; move_percent == move_percent_low_limit<br />
&nbsp; &nbsp; print &quot;reset move_percent (low limit)&quot;, move_percent_low_limit<br />
&nbsp; if (move_percent &gt;= move_percent_high_limit):<br />
&nbsp; &nbsp; move_percent == move_percent_high_limit<br />
&nbsp; &nbsp; print &quot;reset move_percent (high limit)&quot;, move_percent_high_limit<br />
&nbsp; print &quot;----- moving limit (x,y,z), (1/La) unit: &quot;, move_percent<br />
&nbsp; x_ran = random.uniform(-move_percent,move_percent)<br />
&nbsp; y_ran = random.uniform(-move_percent,move_percent)<br />
&nbsp; z_ran = random.uniform(-move_percent,move_percent)<br />
&nbsp; #<br />
&nbsp; n_ran = n_ran + 15<br />
&nbsp; j = 0<br />
&nbsp; for i in range(1,total_num_char_line):<br />
&nbsp; &nbsp; if (n_ran &gt; (15+number_of_atoms_temp[i])):<br />
&nbsp; &nbsp; &nbsp; j = i<br />
&nbsp; n_ran = n_ran + 2*j<br />
&nbsp; #<br />
&nbsp; ex_ran = random.uniform(0.0,1.0)<br />
&nbsp; if (exchange_ratio &gt;= ex_ran):<br />
&nbsp; &nbsp; ex_area_ran1 = 0<br />
&nbsp; &nbsp; ex_area_ran2 = 0<br />
&nbsp; &nbsp; while (ex_area_ran1 == ex_area_ran2):<br />
&nbsp; &nbsp; &nbsp; ex_area_ran1 = random.randrange(0,total_num_char_line)<br />
&nbsp; &nbsp; &nbsp; ex_area_ran2 = random.randrange(0,total_num_char_line)<br />
&nbsp; &nbsp; print &quot;exchange area 1: &quot;, ex_area_ran1<br />
&nbsp; &nbsp; print &quot;exchange area 2: &quot;, ex_area_ran2<br />
&nbsp; &nbsp; ex_at1_ran = random.randrange(number_of_atoms_temp[ex_area_ran1]+1,number_of_atoms_temp[ex_area_ran1+1]) + 15 + 2*ex_area_ran1<br />
&nbsp; &nbsp; ex_at2_ran = random.randrange(number_of_atoms_temp[ex_area_ran2]+1,number_of_atoms_temp[ex_area_ran2+1]) + 15 + 2*ex_area_ran2<br />
&nbsp; &nbsp; print &quot;----- exchange (x y z) in &quot;,ex_at1_ran,&quot; line for &quot;,ex_at2_ran<br />
&nbsp; &nbsp; print &quot;before&quot;<br />
&nbsp; &nbsp; char_ex_at1 = &nbsp;commands.getoutput(&quot;sed -n &quot;+str(ex_at1_ran)+&quot;p case.cfg&quot;)<br />
&nbsp; &nbsp; print char_ex_at1<br />
&nbsp; &nbsp; char_ex_at2 = &nbsp;commands.getoutput(&quot;sed -n &quot;+str(ex_at2_ran)+&quot;p case.cfg&quot;)<br />
&nbsp; &nbsp; print char_ex_at2<br />
&nbsp; &nbsp; print &quot;after&quot;<br />
&nbsp; &nbsp; new_char_ex_at1 = char_ex_at2[0:38] + &quot; &quot; + char_ex_at1[39:len(char_ex_at1)]<br />
&nbsp; &nbsp; new_char_ex_at2 = char_ex_at1[0:38] + &quot; &quot; + char_ex_at2[39:]<br />
&nbsp; &nbsp; print new_char_ex_at1<br />
&nbsp; &nbsp; print new_char_ex_at2<br />
&nbsp; &nbsp; replace1 = commands.getoutput(&quot;sed -i -e &#39;s/&quot;+str(char_ex_at1)+&quot;/&quot;+str(new_char_ex_at1)+&quot;/g&#39; case.cfg&quot;)<br />
&nbsp; &nbsp; replace2 = commands.getoutput(&quot;sed -i -e &#39;s/&quot;+str(char_ex_at2)+&quot;/&quot;+str(new_char_ex_at2)+&quot;/g&#39; case.cfg&quot;)<br />
&nbsp; #<br />
&nbsp; print &quot;----- replace parameter in cfg file -----&quot;<br />
&nbsp; print str(n_ran), &quot;line&quot;<br />
&nbsp; char_old = &nbsp;commands.getoutput(&quot;sed -n &quot;+str(n_ran)+&quot;p case.cfg&quot;)<br />
&nbsp; print char_old<br />
&nbsp; #<br />
&nbsp; new_x_char = commands.getoutput(&quot;awk &#39;NR==&quot;+str(n_ran)+&quot;{printf \&quot;%12.6f \&quot;, ($1+&quot;+str(x_ran)+&quot;-int($1+&quot;+str(x_ran)+&quot;))}&#39; case.cfg&quot;)<br />
&nbsp; if (float(new_x_char) &lt; 0):<br />
&nbsp; &nbsp; new_x = float(new_x_char) + 1.0<br />
&nbsp; else:<br />
&nbsp; &nbsp; new_x = float(new_x_char)<br />
&nbsp; new_y_char = commands.getoutput(&quot;awk &#39;NR==&quot;+str(n_ran)+&quot;{printf \&quot;%12.6f \&quot;, ($2+&quot;+str(y_ran)+&quot;-int($2+&quot;+str(y_ran)+&quot;))}&#39; case.cfg&quot;)<br />
&nbsp; if (float(new_y_char) &lt; 0):<br />
&nbsp; &nbsp; new_y = float(new_y_char) + 1.0<br />
&nbsp; else:<br />
&nbsp; &nbsp; new_y = float(new_y_char)<br />
&nbsp; new_z_char = commands.getoutput(&quot;awk &#39;NR==&quot;+str(n_ran)+&quot;{printf \&quot;%12.6f \&quot;, ($3+&quot;+str(z_ran)+&quot;-int($3+&quot;+str(z_ran)+&quot;))}&#39; case.cfg&quot;)<br />
&nbsp; if (float(new_z_char) &lt; 0):<br />
&nbsp; &nbsp; new_z = float(new_z_char) + 1.0<br />
&nbsp; else:<br />
&nbsp; &nbsp; new_z = float(new_z_char)<br />
&nbsp; #<br />
&nbsp; char_new = commands.getoutput(&quot;awk &#39;NR==&quot;+str(n_ran)+&quot;{printf \&quot;%12.6f %12.6f %12.6f %12.6f %12.6f \\n\&quot;, &quot;+str(new_x)+&quot;, &quot;+str(new_y)+&quot;, &quot;+str(new_z)+&quot;, $4, $5}&#39; case.cfg&quot;)<br />
&nbsp; print char_new<br />
&nbsp; #<br />
&nbsp; replace = commands.getoutput(&quot;sed -i -e &#39;s/&quot;+str(char_old)+&quot;/&quot;+str(char_new)+&quot;/g&#39; case.cfg&quot;)<br />
&nbsp; #print replace<br />
&nbsp; print &quot;----- qstem calculation -----&quot;<br />
&nbsp; run = commands.getoutput(&quot;$HOME/QSTEM/bin/stem3 tem.qsc&quot;)<br />
&nbsp; #print run<br />
&nbsp; copy = commands.getoutput(&quot;cp -f ./case/case_Proj.img case.img&quot;)<br />
&nbsp; #print copy<br />
&nbsp; # ----------------------------------------------------<br />
&nbsp; print &quot;----- comparing calc image and exp -----&quot;<br />
&nbsp; fid = open(&quot;case.img&quot;,&quot;rb&quot;)<br />
&nbsp; # int data<br />
&nbsp; header_size = struct.unpack(&quot;i&quot;,fid.read(4))<br />
&nbsp; #print &quot;header size: &quot;, header_size[0]<br />
&nbsp; #<br />
&nbsp; paramSize = struct.unpack(&quot;i&quot;,fid.read(4))<br />
&nbsp; #print &quot;parameter size: &quot;, paramSize[0]<br />
&nbsp; #<br />
&nbsp; commentSize = struct.unpack(&quot;i&quot;,fid.read(4))<br />
&nbsp; #print &quot;comment size: &quot;, commentSize[0]<br />
&nbsp; #<br />
&nbsp; Nx = struct.unpack(&quot;i&quot;,fid.read(4))<br />
&nbsp; #print &quot;Nx: number of pixels in x-direction, &quot;, Nx[0]<br />
&nbsp; #<br />
&nbsp; Ny = struct.unpack(&quot;i&quot;,fid.read(4))<br />
&nbsp; #print &quot;Ny: number of pixels in y-direction, &quot;, Ny[0]<br />
&nbsp; #<br />
&nbsp; complexFlag = struct.unpack(&quot;i&quot;,fid.read(4))<br />
&nbsp; #print &quot;Flag: complex(1) or real(0): &quot;, complexFlag[0]<br />
&nbsp; #<br />
&nbsp; dataSize = struct.unpack(&quot;i&quot;,fid.read(4))<br />
&nbsp; #print &quot;Data size (byte unit): &quot;, dataSize[0]<br />
&nbsp; #<br />
&nbsp; version = struct.unpack(&quot;i&quot;,fid.read(4))<br />
&nbsp; #print &quot;version: &quot;,version[0]<br />
&nbsp; #<br />
&nbsp; # double data<br />
&nbsp; t = struct.unpack(&quot;d&quot;,fid.read(8))<br />
&nbsp; #print &quot;sample thickness or defocus: &quot;, t[0]<br />
&nbsp; #<br />
&nbsp; dx = struct.unpack(&quot;d&quot;,fid.read(8))<br />
&nbsp; #print &quot;dx: pixel size along x-direction, &quot;, dx[0], &quot; [Angstrom]&quot;<br />
&nbsp; #<br />
&nbsp; dy = struct.unpack(&quot;d&quot;,fid.read(8))<br />
&nbsp; #print &quot;dy: pixel size along y-direction, &quot;, dy[0], &quot; [Angstrom]&quot;<br />
&nbsp; #<br />
&nbsp; # other data<br />
&nbsp; for i in range(0,paramSize[0]):<br />
&nbsp; &nbsp; auxilliary_data = struct.unpack(&quot;d&quot;,fid.read(8))<br />
&nbsp; &nbsp; print auxilliary_data[0]<br />
&nbsp; #<br />
&nbsp; comment = []<br />
&nbsp; for i in xrange(0,commentSize[0]):<br />
&nbsp; &nbsp; comment.append(struct.unpack(&quot;c&quot;,fid.read(1))[0])<br />
&nbsp; #print &quot;comment&quot;<br />
&nbsp; #print comment<br />
&nbsp; #<br />
&nbsp; # image data<br />
&nbsp; #fod = open(&quot;case.raw&quot;,&quot;wb&quot;)<br />
&nbsp; actual_data = [[0 for i in range(Nx[0])] for j in range(Ny[0])]<br />
&nbsp; for i in xrange(0,Nx[0]):<br />
&nbsp; &nbsp; for j in xrange(0,Ny[0]):<br />
&nbsp; &nbsp; &nbsp; actual_data[i][j] = struct.unpack(&quot;f&quot;,fid.read(dataSize[0]))[0]<br />
&nbsp; &nbsp; &nbsp; #<br />
&nbsp; &nbsp; &nbsp; #data = fid.read(dataSize[0])<br />
&nbsp; &nbsp; &nbsp; #fod.write(data)<br />
&nbsp; #<br />
&nbsp; data = np.array(actual_data,dtype=&quot;float32&quot;)<br />
&nbsp; #print data.dtype<br />
&nbsp; #print data.ndim<br />
&nbsp; #print data.shape<br />
&nbsp; #<br />
&nbsp; #-----matplotlib-----<br />
&nbsp; #plt.imshow(data)<br />
&nbsp; #plt.show()<br />
&nbsp; #<br />
&nbsp; #-----PIL-----<br />
&nbsp; new_data = (255 - ((data - np.min(data)) / (np.max(data) - np.min(data))) * 255).astype(np.uint8)<br />
&nbsp; pil_img = Image.fromarray(new_data)<br />
&nbsp; #pil_img.show()<br />
&nbsp; #new_pil_img = pil_img.convert(&quot;L&quot;)<br />
&nbsp; #new_pil_img.show()<br />
&nbsp; #new_pil_img.save(&quot;case.png&quot;)<br />
&nbsp; #<br />
&nbsp; fid.close()<br />
&nbsp; #fod.close()<br />
&nbsp; # ----------------------------------------------------<br />
&nbsp; #<br />
&nbsp; new_value = dif2sum(new_data,im)<br />
&nbsp; print &quot;----- new value: &quot;, new_value<br />
&nbsp; print &quot;----- old value: &quot;, old_value<br />
&nbsp; dif_value = (new_value-old_value)/old_value * dif_value_factor<br />
&nbsp; print &quot;----- dif value: &quot;, dif_value<br />
&nbsp; if (dif_value == 0.0 or dif_value &gt;= dif_value_limit):<br />
&nbsp; &nbsp; dif_value = reset_value<br />
&nbsp; &nbsp; print &quot;----- if value = 0, reset value and exp(-reset): &quot;, dif_value, np.exp(-dif_value)<br />
&nbsp; &nbsp; reset_flag = 1<br />
&nbsp; else:<br />
&nbsp; &nbsp; print &quot;----- value and exp(-value): &quot;, dif_value, np.exp(-dif_value)<br />
&nbsp; &nbsp; reset_flag = 0<br />
&nbsp; print &quot;----- e_ran value:&quot;, e_ran<br />
&nbsp; if (np.exp(-dif_value) &gt;= e_ran and reset_flag == 0):<br />
&nbsp; &nbsp; print &quot;----- adopt new position -----&quot;<br />
&nbsp; &nbsp; commands.getoutput(&quot;cp case.cfg tmp.cfg&quot;)<br />
&nbsp; &nbsp; old_value = new_value<br />
&nbsp; else:<br />
&nbsp; &nbsp; print &quot;----- not adopt new position -----&quot;<br />
&nbsp; if (start_flag == 1):<br />
&nbsp; &nbsp; old_value = new_value<br />
&nbsp; &nbsp; start_flag = 0<br />
---------<br />
2. sed -i &#39;s/\r//g&#39; fit_tem.py<br />
&nbsp; (sudo apt install nkf)<br />
&nbsp; (nkf -Lu --in-place fit_tem.py)<br />
3. chmod +x fit_tem.py<br />
4. python fit_tem.py<br />
5. python plot_tem.py<br />
Å¶ e.g.,&nbsp;<br />
&nbsp; tmp.cfg, 80 kV<br />
&nbsp; exp file: reference.png<br />
<br />
Å† QSTEM + Lammps (dump file)<br />
0. mkdir cfg<br />
1. gedit run_qstem_lammps<br />
---------<br />
#! /bin/csh -f<br />
<br />
set filename = $1<br />
set No = 1<br />
set MaxNo = $2<br />
while ($No &lt;= $MaxNo)<br />
<br />
&nbsp; ./lmp_cfg2cfg_qsc ${filename} -kv 80 -lab6<br />
&nbsp; cp case.cfg tmp.cfg<br />
&nbsp; python fit_tem.py<br />
&nbsp; ./cfg_qsc2lmp_data ${filename}<br />
&nbsp; rm -f -r cfg<br />
&nbsp; rm -f -r ${filename}.*.cfg<br />
&nbsp; mkdir cfg<br />
&nbsp; lammps &lt; in.lmp<br />
&nbsp; cp `find case.*.cfg | tail -1` ../${filename}.cfg<br />
<br />
&nbsp; @ No = $No + 1<br />
end<br />
---------<br />
2. sed -i &#39;s/\r//g&#39; run_qstem_lammps<br />
&nbsp; (sudo apt install nkf)<br />
&nbsp; (nkf -Lu --in-place run_qstem_lammps)<br />
3. chmod +x run_qstem_lammps<br />
4. ./run_qstem_lammps case 1000<br />
Å¶ case.data, 1000 cycle<br />
Å¶ &quot;for i in range(50000):&quot; in fit_tem.py<br />
Å¶ restart method<br />
1. cp tmp.cfg case.cfg&nbsp;<br />
2. ./cfg_qsc2lmp_data case<br />
3. rm -f -r cfg<br />
4. rm -f -r case.*.cfg<br />
5. mkdir cfg<br />
6. lammps &lt; in.lmp<br />
7. cp `find case.*.cfg | tail -1` case.cfg<br />
8. ./run_qstem_lammps case 1000<br />
<br />
Å† QSTEM + Lammps (start cif file) (no check)<br />
0. mkdir cfg<br />
1. gedit run_qstem_lammps<br />
---------<br />
#! /bin/csh -f<br />
<br />
./cif2cfg_qsc case 80 -lab6<br />
cp case.cfg tmp.cfg<br />
python fit_tem.py<br />
./cfg_qsc2lmp_data case<br />
rm -f -r cfg<br />
mkdir cfg<br />
lammps &lt; in.lmp<br />
cp `find case.*.cfg | tail -1` case.cfg<br />
rm -f -r case.*.cfg<br />
<br />
set No = 2<br />
set MaxNo = $2<br />
while ($No &lt;= $MaxNo)<br />
<br />
&nbsp; ./lmp_cfg2cfg_qsc case -kv 80 -lab6<br />
&nbsp; cp case.cfg tmp.cfg<br />
&nbsp; python fit_tem.py<br />
&nbsp; ./cfg_qsc2lmp_data case<br />
&nbsp; rm -f -r cfg<br />
&nbsp; rm -f -r case.*.cfg<br />
&nbsp; mkdir cfg<br />
&nbsp; lammps &lt; in.lmp<br />
&nbsp; cp `find case.*.cfg | tail -1` case.cfg<br />
<br />
&nbsp; @ No = $No + 1<br />
end<br />
---------<br />
2. sed -i &#39;s/\r//g&#39; run_qstem_lammps<br />
&nbsp; (sudo apt install nkf)<br />
&nbsp; (nkf -Lu --in-place run_qstem_lammps)<br />
3. chmod +x run_qstem_lammps<br />
4. ./run_qstem_lammps case 100<br />
Å¶ case.cif, 100 cycle<br />
Å¶ mx, my = 256 (in cif2cfg_qsc case)<br />
------------------------------------------------------------------------------<br />
Å° References<br />
<br />
[1] cif2pos.sh<br />
&nbsp; http://home.ustc.edu.cn/~lipai/scripts/vasp_scripts/bash_cif2pos.html<br />
[2] cif2vasp<br />
&nbsp; https://github.com/danmichaelo/cif2vasp<br />
[3] cif2pos.py<br />
&nbsp; https://code.google.com/archive/p/abinitotools/downloads<br />
[4] Chemistry tools tutorials/scripts<br />
&nbsp; https://kbsezginel.github.io/chem-tools-tutorials/openbabel<br />
------------------------------------------------------------------------------<br />
Å° other method (from write_data) (no check)<br />
<br />
Å† lmp_data2cfg_qsc (from write_data)<br />
1. gedit lmp_data2cfg_qsc_v2<br />
---------<br />
#! /bin/csh -f<br />
set filename = $1<br />
cp ${filename}.data tmp.data<br />
#<br />
awk &#39;{if(($1 ~/^[0-9]+$/) &amp;&amp; ($2 ~/^[0-9]+$/)){printf &quot;%d %12.6f %12.6f %12.6f \n&quot;,$2, $3, $4, $5}}&#39; tmp.data &gt;&gt; tmp.xyz<br />
#<br />
awk &nbsp;&#39;{if($2==&quot;atoms&quot;){print &quot;Number of particles = &quot; $1}}&#39; tmp.data &gt;&gt; tmp.cfg<br />
echo &quot;A = 1.0 Angstrom&quot; &nbsp;&gt;&gt; tmp.cfg<br />
#<br />
#set num_of_atoms = `awk &#39;{if( ($2 == &quot;atom&quot;) &amp;&amp; ($3 == &quot;types&quot;)){print $1 }}&#39; tmp.data`<br />
set x = `awk &#39;{if($3 == &quot;xlo&quot;){print $2 }}&#39; tmp.data`<br />
set y = `awk &#39;{if($3 == &quot;ylo&quot;){print $2 }}&#39; tmp.data`<br />
set z = `awk &#39;{if($3 == &quot;zlo&quot;){print $2 }}&#39; tmp.data`<br />
#<br />
echo &quot;H0(1,1) = ${x}&quot; &gt;&gt; tmp.cfg<br />
echo &quot;H0(1,2) = 0.0&quot; &nbsp;&gt;&gt; tmp.cfg<br />
echo &quot;H0(1,3) = 0.0&quot; &nbsp;&gt;&gt; tmp.cfg<br />
#<br />
echo &quot;H0(2,1) = 0.0&quot; &nbsp;&gt;&gt; tmp.cfg<br />
echo &quot;H0(2,2) = ${y}&quot; &gt;&gt; tmp.cfg<br />
echo &quot;H0(2,3) = 0.0&quot; &nbsp;&gt;&gt; tmp.cfg<br />
#<br />
echo &quot;H0(3,1) = 0.0&quot; &nbsp;&gt;&gt; tmp.cfg<br />
echo &quot;H0(3,2) = 0.0&quot; &nbsp;&gt;&gt; tmp.cfg<br />
echo &quot;H0(3,3) = ${z}&quot; &gt;&gt; tmp.cfg<br />
#<br />
echo &quot;.NO_VELOCITY.&quot; &gt;&gt; tmp.cfg<br />
echo &quot;entry_count = 5&quot; &gt;&gt; tmp.cfg<br />
#<br />
set element_list = (H He Li Be B C N O F Ne Na Mg Al Si P S Cl Ar K Ca Sc Ti V Cr Mn Fe Co Ni Cu Zn Ga Ge As Se Br Kr Rb Sr Y Zr Nb Mo Tc Ru Rh Pd Ag Cd In Sn Sb Te I Xe Cs Ba La Ce Pr Nd Pm Sm Eu Gd Tb Dy Ho Er Tm Yb Lu Hf Ta W Re Os Ir Pt Au Hg Tl Pb Bi Po At Rn Fr Ra Ac Th Pa U Np Pu Am Cm Bk Cf Es Fm Md No Lr Rf Df Sg Bh Hs Mt Ds Rg Cn Nh Fl Mc Lv Ts Og)<br />
#<br />
set mass_list = (1.00794 4.00260 6.941 9.01218 10.81 12.01 14.007 16.00 18.9984 20.180 22.99 24.305 26.98 28.1 30.97 32.1 35.45 39.95 39.10 40.08 44.955912 47.867 50.9415 51.9961 54.938045 55.845 58.933195 58.6934 63.546 65.38 69.723 72.63 74.92160 78.96 79.904 83.798 85.4678 87.62 88.90585 91.224 92.90638 95.96 98 101.07 102.90550 106.42 107.8682 112.411 114.818 118.710 121.760 127.60 126.90447 131.293 132.9054519 137.33 138.90547 140.116 140.90765 144.242 145 150.36 151.964 157.25 158.92535 162.500 164.93032 167.259 168.93421 173.054 174.9668 178.49 180.94788 183.84 186.207 190.23 192.217 195.084 196.966569 200.59 204.3833 207.2 208.98040 209 210 222 223 226 227 232.0381 231.03588 238.02891 237 244 243 247 247 251 252 257 258 259 262 261.11 268 271 270 269 278 281 281 285 286 289 289 293 294 294)<br />
#<br />
set ion_charge_list = (1.0 0.0 1.0 2.0 0.0 0.0 -3.0 -2.0 -1.0 0.0 1.0 2.0 3.0 0.0 -3.0 -2.0 -1.0 0.0 1.0 2.0 3.0 4.0 3.0 3.0 2.0 3.0 2.0 2.0 2.0 2.0 3.0 4.0 -3.0 -2.0 -1.0 0.0 1.0 2.0 3.0 4.0 5.0 6.0 7.0 3.0 3.0 2.0 1.0 2.0 3.0 4.0 3.0 -2.0 -1.0 0.0 1.0 2.0 3.0 3.0 3.0 3.0 3.0 3.0 3.0 3.0 3.0 3.0 3.0 3.0 3.0 3.0 3.0 4.0 5.0 6.0 7.0 4.0 4.0 4.0 3.0 2.0 1.0 2.0 3.0 2.0 1.0 0.0 1.0 2.0 3.0 4.0 5.0 6.0 5.0 4.0 3.0 3.0 3.0 3.0 3.0 3.0 2.0 2.0 3.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0)<br />
# https://www.sciencegeek.net/tables/PT_ions.pdf<br />
#<br />
if (&quot;$2&quot; == &quot;-atom&quot;) then<br />
&nbsp; set atoms = (`echo $3 | awk &#39;{print $0}&#39;`)<br />
else if (&quot;$3&quot; == &quot;-atom&quot;) then<br />
&nbsp; set atoms = (`echo $4 | awk &#39;{print $0}&#39;`)<br />
else if (&quot;$4&quot; == &quot;-atom&quot;) then<br />
&nbsp; set atoms = (`echo $5 | awk &#39;{print $0}&#39;`)<br />
else if (&quot;$5&quot; == &quot;-atom&quot;) then<br />
&nbsp; set atoms = (`echo $6 | awk &#39;{print $0}&#39;`)<br />
else if (&quot;$6&quot; == &quot;-atom&quot;) then<br />
&nbsp; set atoms = (`echo $7 | awk &#39;{print $0}&#39;`)<br />
else if (&quot;$7&quot; == &quot;-atom&quot;) then<br />
&nbsp; set atoms = (`echo $8 | awk &#39;{print $0}&#39;`)<br />
else if (&quot;$8&quot; == &quot;-atom&quot;) then<br />
&nbsp; set atoms = (`echo $9 | awk &#39;{print $0}&#39;`)<br />
endif<br />
#<br />
set i = 1<br />
foreach natom ($atoms)<br />
&nbsp; awk -v num=${i} -v element=${atoms[${i}]} &#39;{if($1==num){print element &quot; &quot; $2 &quot; &quot; $3 &quot; &quot; $4}}&#39; tmp.xyz &gt;&gt; tmp2.xyz<br />
&nbsp; @ i += 1<br />
end<br />
#<br />
set count = 1<br />
foreach atom ($element_list)<br />
&nbsp; set num = `grep -c -i ${atom} tmp2.xyz`<br />
&nbsp; if (${num} &gt; 0) then<br />
&nbsp; &nbsp; #echo ${num}<br />
&nbsp; &nbsp; #echo ${count}<br />
&nbsp; &nbsp; set mass = `echo $mass_list[$count] | awk &#39;{printf(&quot;%d&quot;,$1+0.5)}&#39;`<br />
&nbsp; &nbsp; echo ${mass} &gt;&gt; tmp.cfg<br />
&nbsp; &nbsp; echo ${atom} &gt;&gt; tmp.cfg<br />
&nbsp; &nbsp; awk -v n=${atom} -v x=${x} -v y=${y} -v z=${z} -v mass=${mass} &#39;{if($1==n){printf &quot;%12.6f %12.6f %12.6f %12.6f &nbsp; &nbsp;1.000000 \n&quot;, $2/x, $3/y, $4/z,((0.45*28)/mass)}}&#39; tmp2.xyz &gt;&gt; tmp.cfg<br />
&nbsp; &nbsp; endif<br />
&nbsp; endif<br />
&nbsp; @ count += 1<br />
end<br />
#<br />
#rm -f -r tmp.xyz tmp2.xyz<br />
mv tmp.cfg ${filename}.cfg<br />
#<br />
# calculate number of slices<br />
set thickness = ${z}<br />
#<br />
set slices = `echo ${thickness} | awk &#39;{printf(&quot;%d&quot;,$1/2.0+0.5)}&#39;`<br />
set slice_thickness = `echo &quot;${thickness} ${slices}&quot; | awk &#39;{printf(&quot;%f&quot;,$1/$2)}&#39;`<br />
#echo ${thickness}<br />
#echo ${slices}<br />
#<br />
if (&quot;$2&quot; == &quot;-kv&quot;) then<br />
&nbsp; set v0 = `echo $3 | awk &#39;{printf(&quot;%11.6f&quot;,$1)}&#39;`<br />
else if (&quot;$3&quot; == &quot;-kv&quot;) then<br />
&nbsp; set v0 = `echo $4 | awk &#39;{printf(&quot;%11.6f&quot;,$1)}&#39;`<br />
else if (&quot;$4&quot; == &quot;-kv&quot;) then<br />
&nbsp; set v0 = `echo $5 | awk &#39;{printf(&quot;%11.6f&quot;,$1)}&#39;`<br />
else if (&quot;$5&quot; == &quot;-kv&quot;) then<br />
&nbsp; set v0 = `echo $6 | awk &#39;{printf(&quot;%11.6f&quot;,$1)}&#39;`<br />
else if (&quot;$6&quot; == &quot;-kv&quot;) then<br />
&nbsp; set v0 = `echo $7 | awk &#39;{printf(&quot;%11.6f&quot;,$1)}&#39;`<br />
else if (&quot;$7&quot; == &quot;-kv&quot;) then<br />
&nbsp; set v0 = `echo $8 | awk &#39;{printf(&quot;%11.6f&quot;,$1)}&#39;`<br />
else if (&quot;$8&quot; == &quot;-kv&quot;) then<br />
&nbsp; set v0 = `echo $9 | awk &#39;{printf(&quot;%11.6f&quot;,$1)}&#39;`<br />
else<br />
&nbsp; set v0 = 200.000000<br />
endif<br />
set lambda = `echo ${v0} | awk &#39;{printf(&quot;%12.10f&quot;,12.26/10.0/(($1*10^3*(1+0.9788*10^-3*$1))^(1/2)))}&#39;`<br />
set defocus = `echo ${lambda} | awk &#39;{printf(&quot;%f&quot;,-1.2*(1.0*$1)^(1/2)*1000)}&#39;`<br />
#echo ${lambda}<br />
#echo ${defocus}<br />
set resolutionX = `echo ${x} | awk &#39;{printf(&quot;%f&quot;,$1/512)}&#39;`<br />
set resolutionY = `echo ${y} | awk &#39;{printf(&quot;%f&quot;,$1/512)}&#39;`<br />
#<br />
if (&quot;$2&quot; == &quot;-autoz&quot; || &quot;$3&quot; == &quot;-autoz&quot; || &quot;$4&quot; == &quot;-autoz&quot; || &quot;$5&quot; == &quot;-autoz&quot; || &quot;$6&quot; == &quot;-autoz&quot; || &quot;$7&quot; == &quot;-autoz&quot; || &quot;$8&quot; == &quot;-autoz&quot; || &quot;$9&quot; == &quot;-autoz&quot; || &quot;${10}&quot; == &quot;-autoz&quot;) then<br />
&nbsp; set zOffset = `echo ${slice_thickness} | awk &#39;{printf(&quot;%f&quot;,$1/2)}&#39;`<br />
else<br />
&nbsp; set zOffset = 0.000000<br />
endif<br />
<br />
if (&quot;$2&quot; == &quot;-lab6&quot; || &quot;$3&quot; == &quot;-lab6&quot; || &quot;$4&quot; == &quot;-lab6&quot; || &quot;$5&quot; == &quot;-lab6&quot; || &quot;$6&quot; == &quot;-lab6&quot; || &quot;$7&quot; == &quot;-lab6&quot; || &quot;$8&quot; == &quot;-lab6&quot; || &quot;$9&quot; == &quot;-lab6&quot; || &quot;${10}&quot; == &quot;-lab6&quot;) then<br />
&nbsp; set dVV = `echo ${v0} | awk &#39;{printf(&quot;%f&quot;,1.5/($1*1000))}&#39;`<br />
&nbsp; set Cs &nbsp;= 1.00000<br />
&nbsp; set Cc &nbsp;= 1.400000<br />
&nbsp; set alpha = 15.0 # 1.5 - 20 [mrad]<br />
&nbsp; set Source_Size = 10<br />
&nbsp; set beam_current = 20<br />
else if (&quot;$2&quot; == &quot;-fe&quot; || &quot;$3&quot; == &quot;-fe&quot; || &quot;$4&quot; == &quot;-fe&quot; || &quot;$5&quot; == &quot;-fe&quot; || &quot;$6&quot; == &quot;-fe&quot; || &quot;$7&quot; == &quot;-fe&quot; || &quot;$8&quot; == &quot;-fe&quot; || &quot;$9&quot; == &quot;-fe&quot; || &quot;${10}&quot; == &quot;-fe&quot;) then<br />
&nbsp; set dVV = `echo ${v0} | awk &#39;{printf(&quot;%f&quot;,0.65/($1*1000))}&#39;`<br />
&nbsp; set Cs &nbsp;= 1.00000<br />
&nbsp; set Cc &nbsp;= 1.400000<br />
&nbsp; set alpha = 1.5 # 1.5 - 20 [mrad]<br />
&nbsp; set Source_Size = 2<br />
&nbsp; set beam_current = 20<br />
else if (&quot;$2&quot; == &quot;-arm&quot; || &quot;$3&quot; == &quot;-arm&quot; || &quot;$4&quot; == &quot;-arm&quot; || &quot;$5&quot; == &quot;-arm&quot; || &quot;$6&quot; == &quot;-arm&quot; || &quot;$7&quot; == &quot;-arm&quot; || &quot;$8&quot; == &quot;-arm&quot; || &quot;$9&quot; == &quot;-arm&quot; || &quot;${10}&quot; == &quot;-arm&quot;) then<br />
&nbsp; set dVV = `echo ${v0} | awk &#39;{printf(&quot;%f&quot;,0.325/($1*1000))}&#39;`<br />
&nbsp; set Cs &nbsp;= 1.00000<br />
&nbsp; set Cc &nbsp;= 1.400000<br />
&nbsp; set alpha = 1.5 # 1.5 - 20 [mrad]<br />
&nbsp; set Source_Size = 1<br />
&nbsp; set beam_current = 20<br />
else<br />
&nbsp; set dVV = 0.000003<br />
&nbsp; set Cs &nbsp;= 1.00000<br />
&nbsp; set Cc &nbsp;= 1.000000<br />
&nbsp; set alpha = 1.5 # 1.5 - 20 [mrad]<br />
&nbsp; set Source_Size = 0<br />
&nbsp; set beam_current = 1<br />
endif<br />
<br />
if (&quot;$2&quot; == &quot;-tds&quot; || &quot;$3&quot; == &quot;-tds&quot; || &quot;$4&quot; == &quot;-tds&quot; || &quot;$5&quot; == &quot;-tds&quot; || &quot;$6&quot; == &quot;-tds&quot; || &quot;$7&quot; == &quot;-tds&quot; || &quot;$8&quot; == &quot;-tds&quot; || &quot;$9&quot; == &quot;-tds&quot; || &quot;${10}&quot; == &quot;-tds&quot;) then<br />
&nbsp; set tds = &quot;yes&quot;<br />
else<br />
&nbsp; set tds = &quot;no&quot;<br />
endif<br />
<br />
cat &lt;&lt; EOF &gt; tem.qsc<br />
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%<br />
% STEM configuration file generated by qstem<br />
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%<br />
<br />
mode: TEM<br />
print level: 4 &nbsp;% indicates how much information in output<br />
save level: &nbsp;3 &nbsp;% indicates how much information shall be saved<br />
filename: ${filename}.cfg<br />
resolutionX: &nbsp;${resolutionX}<br />
resolutionY: &nbsp;${resolutionY}<br />
NCELLX: 1<br />
NCELLY: 1<br />
NCELLZ: 1<br />
v0: ${v0} &nbsp;% beam energy<br />
tds: ${tds} % do NOT include thermal diffuse scattering<br />
temperature: 298.000000 % temperature in Kelvin<br />
slice-thickness: ${slice_thickness} &nbsp;% slice thckness in A<br />
slices: ${slices} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; % number of different slices per slab in z-direction<br />
center slices: no &nbsp; &nbsp; &nbsp; % do not center slices<br />
slices between outputs: 10 &nbsp;% give intermediate results after every 8 slices<br />
xOffset: &nbsp;0.000000 &nbsp; &nbsp; &nbsp;% slize x-position offset in cartesian coords<br />
yOffset: &nbsp;0.000000 &nbsp; &nbsp; &nbsp;% slize y-position offset in cartesian coords<br />
zOffset: &nbsp;${zOffset} &nbsp; &nbsp; &nbsp;% slize z-position offset in cartesian coords<br />
periodicXY: no &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;% not periodic in x- and y-direction<br />
periodicZ: no &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; % not periodic in z-direction<br />
<br />
% Geometrical properties<br />
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%<br />
<br />
Crystal tilt X: 0.000000 &nbsp; &nbsp; &nbsp; &nbsp;% tilt in rad<br />
Crystal tilt Y: 0.000000<br />
Crystal tilt Z: 0.000000<br />
Beam tilt X: 0.0 &nbsp; &nbsp; &nbsp; &nbsp;% beam tilt in mrad<br />
Beam tilt Y: 0.0<br />
Tilt back: no<br />
<br />
% TEM imaging parameters<br />
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%<br />
<br />
nx: 512 &nbsp; &nbsp; &nbsp; &nbsp; % array size used for probe<br />
ny: 512 &nbsp; &nbsp; &nbsp; &nbsp; % ny = nx, if not specified<br />
Cs: ${Cs} &nbsp; &nbsp; &nbsp; % Speherical abberation in mm<br />
C5: 0.000000 &nbsp; &nbsp;% C_5 abberation in mm<br />
Cc: ${Cc} &nbsp; &nbsp; &nbsp; % Chromatic abberation in mm<br />
dV/V: ${dVV} &nbsp; &nbsp;% energy spread in eV (FWHM)<br />
alpha: ${alpha} &nbsp;% Illumination angle in mrad<br />
defocus: ${defocus}<br />
astigmatism: 0.000000<br />
astigmatism angle: 0.000000<br />
<br />
<br />
Source Size (diameter): ${Source_Size} &nbsp;% source size in A<br />
beam current: ${beam_current} &nbsp; &nbsp; &nbsp; &nbsp;% beam current in pA (default: 1)<br />
dwell time: 1000 &nbsp; &nbsp; &nbsp; &nbsp;% dwell time in msec (default: 1) (GUI 1.6021773e-4)<br />
smooth: yes &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; % smoothen edge of probe in rec. space<br />
gaussian: no<br />
% Parameters for potential calculation<br />
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%<br />
<br />
potential3D: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;yes &nbsp;% use 3D or 2D potential (3D realistically simulates z-motion of atoms)<br />
atom radius: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5.0 &nbsp; &nbsp; &nbsp; % radius used for calculation of proj potential V_proj(r)<br />
plot V(r)*r: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;no &nbsp; &nbsp; &nbsp; &nbsp;% will create a plot for V_proj(r)*r vs. r &nbsp;for all slices and 1st atom<br />
bandlimit f_trans: &nbsp; &nbsp;no &nbsp; &nbsp; &nbsp; &nbsp;% indicate whether to band limit transmission function or not<br />
save potential: &nbsp; &nbsp; &nbsp; no &nbsp; &nbsp; &nbsp; &nbsp;% whether we want to save the projected potential in files<br />
save projected potential: &nbsp; &nbsp; &nbsp; yes &nbsp; &nbsp; % whether we want to save the total projected potential<br />
one time integration: yes &nbsp;% calculate V_proj once and then copy (much faster)<br />
Display Gamma: 0 &nbsp; &nbsp; % Gamma value for image scaling (0 = logarithmic)<br />
Folder: &quot;${filename}&quot;<br />
Runs for averaging: 30 &nbsp;% averaging over 30 images for TDS simulation<br />
Structure Factors: WK<br />
show Probe: no &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;% displays a graph of the crosssection of the inc. e-beam<br />
propagation progress interval: 10 % show progress every N_prop_prog beam positions<br />
potential progress interval: 1000 % show progress every N_pot_prog atoms<br />
update Web: no &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;% put results on web page<br />
Pendelloesung plot: no &nbsp;% flag indicates whether to store Pendeloesung plot<br />
sequence: 1 1<br />
EOF<br />
---------<br />
2. sed -i &#39;s/\r//g&#39; lmp_data2cfg_qsc_v2<br />
&nbsp; (sudo apt install nkf)<br />
&nbsp; (nkf -Lu --in-place lmp_data2cfg_qsc_v2)<br />
3. chmod +x lmp_data2cfg_qsc_v2<br />
4. ./lmp_data2cfg_qsc_v2 case<br />
Å¶ e.g., case.cfg<br />
<br />
Å† QSTEM + Lammps (write_data)<br />
0. mkdir cfg<br />
1. gedit run_qstem_lammps<br />
---------<br />
#! /bin/csh -f<br />
<br />
set No = 1<br />
set MaxNo = $2<br />
while ($No &lt;= $MaxNo)<br />
<br />
&nbsp; ./lmp_data2cfg_qsc_v2 case -kv 80 -atom &quot;C H&quot; -lab6<br />
&nbsp; cp case.cfg tmp.cfg<br />
&nbsp; python fit_tem.py<br />
&nbsp; ./cfg_qsc2lmp_data case<br />
&nbsp; rm -f -r cfg<br />
&nbsp; rm -f -r case.*.cfg<br />
&nbsp; mkdir cfg<br />
&nbsp; lammps &lt; in.lmp<br />
&nbsp; cp `find case.*.cfg | tail -1` case.cfg<br />
<br />
&nbsp; @ No = $No + 1<br />
end<br />
---------<br />
2. sed -i &#39;s/\r//g&#39; run_qstem_lammps<br />
&nbsp; (sudo apt install nkf)<br />
&nbsp; (nkf -Lu --in-place run_qstem_lammps)<br />
3. chmod +x run_qstem_lammps<br />
4. ./run_qstem_lammps case 100<br />
Å¶ case.data, 100 cycle<br />
Å¶ &quot;for i in range(50000):&quot; in fit_tem.py<br />
<br />
Å† QSTEM + Lammps (start cif file)<br />
0. mkdir cfg<br />
1. gedit run_qstem_lammps<br />
---------<br />
#! /bin/csh -f<br />
<br />
./cif2cfg_qsc case &nbsp;80 -lab6<br />
cp case.cfg tmp.cfg<br />
python fit_tem.py<br />
./cfg_qsc2lmp_data case<br />
rm -f -r cfg<br />
mkdir cfg<br />
lammps &lt; in.lmp<br />
cp `find case.*.cfg | tail -1` case.cfg<br />
rm -f -r case.*.cfg<br />
<br />
set No = 2<br />
set MaxNo = $2<br />
while ($No &lt;= $MaxNo)<br />
<br />
&nbsp; ./lmp_data2cfg_qsc_v2 case -kv 80 -atom &quot;C H&quot; -lab6<br />
&nbsp; cp case.cfg tmp.cfg<br />
&nbsp; python fit_tem.py<br />
&nbsp; ./cfg_qsc2lmp_data case<br />
&nbsp; rm -f -r cfg<br />
&nbsp; rm -f -r case.*.cfg<br />
&nbsp; mkdir cfg<br />
&nbsp; lammps &lt; in.lmp<br />
&nbsp; cp `find case.*.cfg | tail -1` case.cfg<br />
<br />
&nbsp; @ No = $No + 1<br />
end<br />
---------<br />
2. sed -i &#39;s/\r//g&#39; run_qstem_lammps<br />
&nbsp; (sudo apt install nkf)<br />
&nbsp; (nkf -Lu --in-place run_qstem_lammps)<br />
3. chmod +x run_qstem_lammps<br />
4. ./run_qstem_lammps case 100<br />
Å¶ case.cif, 100 cycle<br />
Å¶ mx, my = 256 (in cif2cfg_qsc case)<br />
------------------------------------------------------------------------------<br />
<br />
&nbsp;